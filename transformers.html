<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Transformers - All Movies</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- HLS.js (for HLS playback in modal) -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.1/dist/hls.min.js"></script>
  <style>
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #111;
    }
    ::-webkit-scrollbar-thumb {
      background: #ffcc00;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #ffdd33;
    }

    /* Custom animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }

    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }
    .delay-3 { animation-delay: 0.3s; }
    .delay-4 { animation-delay: 0.4s; }
    .delay-5 { animation-delay: 0.5s; }

    /* Glow effect */
    .glow-effect {
      position: relative;
    }

    .glow-effect::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 204, 0, 0);
      transition: box-shadow 0.3s ease;
      pointer-events: none;
    }

    .glow-effect:hover::after {
      box-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
    }

    /* Gradient text */
    .gradient-text {
      background: linear-gradient(90deg, #ffcc00, #ff9900);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    /* Responsive adjustments */
    @media (max-width: 640px) {
      .movie-card {
        width: calc(50% - 1rem);
      }
    }

    @media (max-width: 400px) {
      .movie-card {
        width: 100%;
      }
    }

    /* --- Modal styles from Illumination (keeps modal look) --- */
    .modal-backdrop { position:fixed; inset:0; background: rgba(0,0,0,0.9); display:none; align-items:center; justify-content:center; z-index:9999; }
    .modal-backdrop.active { display:flex; }
    .modal-card { width:92%; max-width:980px; border-radius:12px; overflow:hidden; background:#0b1220; box-shadow:0 30px 80px rgba(0,0,0,0.7); }
    .player-wrapper { position:relative; padding-bottom:56.25%; height:0; background:#000; }
    .player-wrapper video, .player-wrapper iframe { position:absolute; inset:0; width:100%; height:100%; }

    .player-meta { display:flex; justify-content:space-between; gap:12px; padding:14px; color:#ddd; align-items:flex-start; }
    .player-meta .meta-left { max-width:65%; }
    .player-meta h3 { margin:0; font-size:1.125rem; }
    .player-meta p { margin:6px 0 0 0; color:#9CA3AF; font-size:0.92rem; }

    .controls-row { display:flex; gap:8px; align-items:center; }

    .btn {
      background:transparent; border:1px solid #FED141; color:#FED141;
      padding:8px 12px; border-radius:8px; cursor:pointer;
    }
    .btn:hover { background: rgba(254,209,65,0.06); }

    .hidden { display:none; }

  </style>
</head>
<body class="bg-black text-gray-100 min-h-screen">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-black bg-opacity-90 backdrop-blur-sm border-b border-yellow-600/20">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <div class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center">
          <i class="fas fa-robot text-black text-xl"></i>
        </div>
        <h1 class="text-2xl font-bold gradient-text">TRANSFORMERS</h1>
      </div>

      <div class="flex items-center space-x-4">
        <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-800 transition">
          <i class="fas fa-moon text-yellow-500"></i>
        </button>
        <button id="search-btn" class="p-2 rounded-full hover:bg-gray-800 transition">
          <i class="fas fa-search text-yellow-500"></i>
        </button>
      </div>
    </div>

    <!-- Search Bar (hidden by default) -->
    <div id="search-bar" class="hidden px-4 pb-4">
      <div class="relative">
        <input id="globalSearch" type="text" placeholder="Search movies..." 
               class="w-full bg-gray-900 border border-yellow-600/30 rounded-full py-2 px-4 pl-10 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
        <i class="fas fa-search absolute left-3 top-3 text-yellow-500"></i>
      </div>
    </div>
  </header>

<!-- Main Content -->
<main class="container mx-auto px-4 py-8">
  <!-- Hero Section -->
  <section class="mb-12 relative overflow-hidden rounded-xl aspect-video">
    <div class="absolute inset-0 bg-gradient-to-r from-black via-black/70 to-transparent z-10"></div>

    <!-- Responsive Video Wrapper -->
    <div class="absolute inset-0 overflow-hidden">
      <iframe
        class="absolute top-1/2 left-1/2 w-[120%] h-[120%] -translate-x-1/2 -translate-y-1/2"
        src="https://www.youtube.com/embed/yAu3YqQd-Bw?autoplay=1&mute=1&loop=1&playlist=yAu3YqQd-Bw&controls=0&modestbranding=1&showinfo=0"
        title="YouTube video player"
        frameborder="0"
        allow="autoplay; encrypted-media"
        allowfullscreen>
      </iframe>
    </div>

    <!-- Overlay Content -->
    <div class="absolute bottom-0 left-0 z-20 p-6 md:p-8">
      <h2 class="text-3xl md:text-5xl font-bold mb-2 gradient-text"></h2>
      <p class="text-gray-300 mb-4 max-w-lg">
        The complete collection of the Transformers live-action films. More than meets the eye.
      </p>
      <div class="flex space-x-3">
        <button class="bg-yellow-600 hover:bg-yellow-700 text-black font-semibold py-2 px-6 rounded-full transition flex items-center">
          <i class="fas fa-play mr-2"></i> Play All
        </button>
      </div>
    </div>
  </section>

    <!-- Filters -->
    <div class="flex flex-wrap items-center justify-between mb-8 gap-4">
      <div class="flex space-x-2 overflow-x-auto pb-2 scrollbar-hide">

      </div>

      <div class="flex items-center space-x-2">
        <span class="text-gray-400 text-sm">Sort by:</span>
        <select class="bg-gray-900 border border-gray-700 text-white text-sm rounded-full px-3 py-1 focus:outline-none focus:ring-1 focus:ring-yellow-500">
          <option>Release Date</option>
          <option>Chronological Order</option>
          <option>Popularity</option>
        </select>
      </div>
    </div>

    <!-- Movies Grid -->
    <section>
      <h3 class="text-xl font-semibold mb-6 flex items-center">
        <i class="fas fa-film text-yellow-500 mr-2"></i>
        Movies
      </h3>

      <div id="movies" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
        <!-- Movie cards will be inserted here by JavaScript -->
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 border-t border-gray-800 mt-12 py-8">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <div class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
              <i class="fas fa-robot text-black text-sm"></i>
            </div>
            <span class="text-xl font-bold gradient-text">TRANSFORMERS</span>
          </div>
          <p class="text-gray-400 text-sm mt-2">© Transformers Productions. All rights reserved.</p>
        </div>

        <div class="flex space-x-6">
          <a href="#" class="text-gray-400 hover:text-yellow-500 transition"><i class="fab fa-facebook-f"></i></a>
          <a href="#" class="text-gray-400 hover:text-yellow-500 transition"><i class="fab fa-twitter"></i></a>
          <a href="https://image.tmdb.org/t/p/w500/jyzrfx2WaeY60kYZpPYepSjGz4S.jpg" class="text-gray-400 hover:text-yellow-500 transition"><i class="fab fa-instagram"></i></a>
          <a href="https://www.youtube.com/channel/UCYwTAs1PRVHbq4LnCHEEicw" class="text-gray-400 hover:text-yellow-500 transition"><i class="fab fa-youtube"></i></a>
        </div>
      </div>
    </div>
  </footer>

  <!-- === REPLACED MODAL: Illumination-style modal inserted here === -->
  <div id="playbackModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true">
      <div class="player-wrapper" id="playerWrapper">
        <!-- video or iframe injected here -->
        <video id="modalVideo" controls playsinline style="width:100%;height:100%;background:#000"></video>
      </div>

      <div class="player-meta">
        <div class="meta-left">
          <h3 id="modalTitle">Title</h3>
          <p id="modalDesc" class="text-sm"></p>
        </div>
        <div class="controls-row">
          <button id="prevBtn" class="btn"><i class="fas fa-step-backward mr-2"></i>Prev</button>
          <button id="playPauseBtn" class="btn"><i class="fas fa-play mr-2"></i>Play</button>
          <button id="nextBtn" class="btn">Next<i class="fas fa-step-forward ml-2"></i></button>
          <button id="fullscreenBtn" class="btn"><i class="fas fa-expand"></i></button>
          <button id="muteBtn" class="btn"><i class="fas fa-volume-up"></i></button>
        </div>
      </div>
    </div>
  </div>

<script>
  /******************************
   * Keep existing Transformers movies array (unchanged)
   * (This file's array remains - we did NOT copy Illumination's movies array.)
   ******************************/
  const movies = [
    { 
      title: "Transformers", 
      year: 2007,
      video: "https://queenselti.me/cmjehekw/uwu.m3u8", 
      image: "https://blob.cede.ch/catalog/10260000/10260134_1_92.jpg?v=2",
      runtime: "144 min",
      rating: "7.0/10",
      description: "An ancient struggle between two Cybertronian races, the heroic Autobots and the evil Decepticons, comes to Earth, with a clue to the ultimate power held by a young teenager.",
      director: "Michael Bay",
      cast: "Shia LaBeouf, Megan Fox, Josh Duhamel, Tyrese Gibson"
    },
    { 
      title: "Transformers: Revenge of the Fallen", 
      year: 2009,
      video: "https://spx.corvani.cyou:443/v4/9a/rghch/index-f1-v1-a1.txt", 
      image: "https://m.media-amazon.com/images/I/81mwDd1XxaL._AC_UF1000,1000_QL80_.jpg",
      runtime: "150 min",
      rating: "5.9/10",
      description: "Sam Witwicky leaves the Autobots to attend college, but he is dragged back into the Transformers' war when he learns the truth about the ancient origins of the Transformers.",
      director: "Michael Bay",
      cast: "Shia LaBeouf, Megan Fox, Josh Duhamel, Tyrese Gibson"
    },
    { 
      title: "Transformers: Dark of the Moon", 
      year: 2011,
      video: "https://queenselti.me/dupalhmq/uwu.m3u8", 
      image: "https://medias.spotern.com/medias/posters/w290-poster/0/231-en.jpg",
      runtime: "154 min",
      rating: "6.2/10",
      description: "The Autobots learn of a Cybertronian spacecraft hidden on the Moon, and race against the Decepticons to reach it and learn its secrets, which could turn the tide in the Transformers' final battle.",
      director: "Michael Bay",
      cast: "Shia LaBeouf, Rosie Huntington-Whiteley, Josh Duhamel, Tyrese Gibson"
    },
    { 
      title: "Transformers: Age of Extinction", 
      year: 2014,
      video: "https://queenselti.me/sdonk/uwu.m3u8", 
      image: "https://image.tmdb.org/t/p/w500/jyzrfx2WaeY60kYZpPYepSjGz4S.jpg",
      runtime: "165 min",
      rating: "5.6/10",
      description: "When humanity begins hunting down all Transformers, Optimus Prime enlists the help of a struggling inventor and his daughter to save the Autobots from a powerful new threat.",
      director: "Michael Bay",
      cast: "Mark Wahlberg, Nicola Peltz, Jack Reynor, Stanley Tucci"
    },
    { 
      title: "Transformers: The Last Knight", 
      year: 2017,
      video: "https://queenselti.me/qxdhqai/uwu.m3u8", 
      image: "https://i.pinimg.com/736x/ae/b1/16/aeb116b30b56f190a4c32d9c60484ede.jpg",
      runtime: "154 min",
      rating: "5.2/10",
      description: "Humans are at war with the Transformers, and Optimus Prime is gone. The key to saving the future lies buried in the secrets of the past and the hidden history of Transformers on Earth.",
      director: "Michael Bay",
      cast: "Mark Wahlberg, Anthony Hopkins, Josh Duhamel, Laura Haddock"
    },
    { 
      title: "Bumblebee", 
      year: 2018,
      video: "https://queenselti.me/zfmyrfey/uwu.m3u8", 
      image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRBE2QUyZSAHKOOc5f_gpK3if-dHoXygjYpQyP7FW-8xuOWDRvgKLmEC9EKB-nST9UKfqE&usqp=CAU",
      runtime: "114 min",
      rating: "6.7/10",
      description: "On the run in the year 1987, Bumblebee finds refuge in a junkyard in a small California beach town. Charlie, on the cusp of turning 18 and trying to find her place in the world, discovers him.",
      director: "Travis Knight",
      cast: "Hailee Steinfeld, John Cena, Jorge Lendeborg Jr., John Ortiz"
    },
    { 
      title: "Transformers: Rise of the Beasts", 
      year: 2023,
      video: "https://queenselti.me/ceihwixj/uwu.m3u8", 
      image: "https://i.ebayimg.com/00/s/MTYwMFgxMDgw/z/VQcAAOSw4pRkcN3s/$_57.JPG?set_id=880000500F",
      runtime: "127 min",
      rating: "6.1/10",
      description: "During the '90s, a new faction of Transformers - the Maximals - join the Autobots as allies in the battle for Earth against the evil Decepticons and their new leader, Scourge.",
      director: "Steven Caple Jr.",
      cast: "Anthony Ramos, Dominique Fishback, Luna Lauren Velez, Dean Scott Vazquez"
    },
    { 
      title: "Transformers One", 
      year: 2024,
      video: "https://queenselti.me/stream_6730b68622689/uwu.m3u8", 
      image: "https://cdn.cinematerial.com/p/297x/j1m9dxzy/transformers-one-movie-poster-md.jpg?v=1721967433",
      runtime: "104 min",
      rating: "7.6/10",
      description: "An animated origin story of Optimus Prime and Megatron, showing how they went from brothers-in-arms to becoming sworn enemies in the legendary war for Cybertron.",
      director: "Josh Cooley",
      cast: "Chris Hemsworth, Brian Tyree Henry, Scarlett Johansson, Keegan-Michael Key"
    },
  ];

  // DOM elements (modal-related)
  const playbackModal = document.getElementById('playbackModal');
  const playerWrapper = document.getElementById('playerWrapper');
  const modalVideoId = 'modalVideo';
  const modalTitle = document.getElementById('modalTitle');
  const modalDesc = document.getElementById('modalDesc');

  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const playPauseBtn = document.getElementById('playPauseBtn');
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  const muteBtn = document.getElementById('muteBtn');

  // playback state
  let currentHls = null;
  let currentFiltered = [];
  let currentIndex = null;

  /******************************
   * Type detection helpers
   ******************************/
  function isMP4(url) { return /\.mp4($|\?)/i.test((url||'')); }
  function isHls(url) {
    if (!url) return false;
    return url.includes('.m3u8') || url.includes('index-') || /index.*\.txt/i.test(url) || url.includes('manifest') || url.includes('master');
  }
  function isYouTube(url) {
    if (!url) return false;
    return url.includes('youtube.com') || url.includes('youtu.be') || url.includes('youtube-nocookie.com') || url.includes('/embed/');
  }

  /******************************
   * Reset player container
   ******************************/
  function resetPlayerContainer() {
    if (currentHls) {
      try { currentHls.destroy(); } catch(e) {}
      currentHls = null;
    }
    playerWrapper.innerHTML = `<video id="${modalVideoId}" controls playsinline style="width:100%;height:100%;background:#000"></video>`;
  }

  function showModal() {
    playbackModal.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
  function hideModal() {
    playbackModal.classList.remove('active');
    document.body.style.overflow = '';
  }

  function showError(msg) {
    console.warn(msg);
  }

  /******************************
   * Core: open player (Illumination logic transplanted)
   ******************************/
  function openPlayer(list, index) {
    if (!Array.isArray(list) || list.length === 0 || index == null || index < 0 || index >= list.length) {
      showError('Invalid playback request');
      return;
    }
    currentFiltered = list;
    currentIndex = index;
    const movie = list[index];
    if (!movie) { showError('Movie missing'); return; }

    // metadata
    modalTitle.textContent = movie.title || '';
    modalDesc.textContent = movie.description || (movie.title || '');

    // reset & show
    resetPlayerContainer();
    showModal();

    // pick src
    let src = '';
    if (typeof movie.video === 'object' && movie.video !== null) {
      src = movie.video.high || movie.video.medium || movie.video.low || Object.values(movie.video)[0];
    } else {
      src = movie.video;
    }
    if (!src) {
      showError('No video source');
      setTimeout(()=> window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=`, 500);
      return;
    }

    const lc = (src || '').toLowerCase();

    // iframe-hosted common hosts
    if (lc.includes('streamtape.com') || lc.includes('dood') || lc.includes('vidcdn') || lc.includes('ok.ru') || lc.includes('mega.nz') || lc.includes('openload') || lc.includes('drive.google.com')) {
      playerWrapper.innerHTML = `<iframe src="${src}" width="100%" height="100%" frameborder="0" allowfullscreen allow="autoplay; encrypted-media"></iframe>`;
      playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
      return;
    }

    // youtube
    if (isYouTube(src)) {
      let embed = src;
      try {
        if (src.includes('watch') && src.includes('v=')) {
          const v = new URLSearchParams(src.split('?')[1]).get('v');
          if (v) embed = `https://www.youtube.com/embed/${v}`;
        } else if (src.includes('youtu.be/')) {
          const p = src.split('youtu.be/')[1].split(/[?&]/)[0];
          if (p) embed = `https://www.youtube.com/embed/${p}`;
        }
      } catch (e) {}
      playerWrapper.innerHTML = `<iframe src="${embed}?autoplay=1&modestbranding=1&rel=0" width="100%" height="100%" frameborder="0" allowfullscreen allow="autoplay; encrypted-media"></iframe>`;
      playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
      return;
    }

    // HLS
    if (isHls(src)) {
      const v = document.getElementById(modalVideoId);
      if (!v) { showError('Video element missing'); return; }
      if (window.Hls && Hls.isSupported()) {
        currentHls = new Hls();
        try {
          currentHls.loadSource(src);
          currentHls.attachMedia(v);
        } catch (e) { console.warn('HLS attach error', e); }
        currentHls.on(Hls.Events.MANIFEST_PARSED, function() {
          v.play().catch(()=>{});
          playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
        });
        currentHls.on(Hls.Events.ERROR, function(event, data) {
          console.warn('HLS error', data);
          if (data && data.fatal) {
            try { currentHls.destroy(); } catch(e){}
            currentHls = null;
            showError('HLS fatal error — redirecting to player.html');
            setTimeout(()=> window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`, 700);
          }
        });
      } else if (v.canPlayType && v.canPlayType('application/vnd.apple.mpegurl')) {
        v.src = src;
        v.play().catch(()=>{});
        playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
      } else {
        showError('HLS not supported — redirecting to player.html');
        setTimeout(()=> window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`, 700);
      }
      return;
    }

    // MP4
    if (isMP4(src)) {
      const v = document.getElementById(modalVideoId);
      if (!v) { window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`; return; }
      v.src = src;
      v.play().catch(()=>{});
      playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
      return;
    }

    // fallback
    window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`;
  }

  /******************************
   * Controls
   ******************************/
  function togglePlayPause() {
    const v = document.getElementById(modalVideoId);
    if (!v) return;
    if (v.paused) {
      v.play().catch(()=>{});
      playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
    } else {
      v.pause();
      playPauseBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Play';
    }
  }
  function playNext() {
    if (!currentFiltered || currentFiltered.length === 0) currentFiltered = movies.slice();
    if (currentIndex == null) return showError('No current video');
    if (currentIndex < currentFiltered.length - 1) openPlayer(currentFiltered, currentIndex + 1);
    else showError('No next video');
  }
  function playPrev() {
    if (!currentFiltered || currentFiltered.length === 0) currentFiltered = movies.slice();
    if (currentIndex == null) return showError('No current video');
    if (currentIndex > 0) openPlayer(currentFiltered, currentIndex - 1);
    else showError('No previous video');
  }
  function toggleFullscreen() {
    const el = document.getElementById(modalVideoId) || playerWrapper.querySelector('iframe');
    if (!el) return;
    if (!document.fullscreenElement) {
      (el.requestFullscreen || playerWrapper.requestFullscreen).call(el).catch(()=> showError('Fullscreen failed'));
    } else {
      document.exitFullscreen();
    }
  }
  function toggleMute() {
    const v = document.getElementById(modalVideoId);
    if (!v) return;
    v.muted = !v.muted;
    muteBtn.innerHTML = v.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
  }

  /******************************
   * Close modal & cleanup
   ******************************/
  function closeModalHandler() {
    if (currentHls) {
      try { currentHls.destroy(); } catch(e) {}
      currentHls = null;
    }
    const v = document.getElementById(modalVideoId);
    if (v) {
      try { v.pause(); } catch(e){}
      try { v.removeAttribute('src'); v.load(); } catch(e){}
    }
    resetPlayerContainer();
    hideModal();
    currentIndex = null;
    currentFiltered = [];
    playPauseBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Play';
  }

  /******************************
   * Events wiring for modal controls
   ******************************/
  playPauseBtn.addEventListener('click', togglePlayPause);
  nextBtn.addEventListener('click', playNext);
  prevBtn.addEventListener('click', playPrev);
  fullscreenBtn.addEventListener('click', toggleFullscreen);
  muteBtn.addEventListener('click', toggleMute);

  // close by clicking outside
  playbackModal.addEventListener('click', function(e){
    if (e.target === playbackModal) closeModalHandler();
  });

  // Escape & keyboard
  document.addEventListener('keydown', (e) => {
    if (!playbackModal.classList.contains('active')) return;
    switch (e.key.toLowerCase()) {
      case 'escape': closeModalHandler(); break;
      case ' ': e.preventDefault(); togglePlayPause(); break;
      case 'arrowright': { const v = document.getElementById(modalVideoId); if (v) v.currentTime = Math.max(0, v.currentTime + 10); break; }
      case 'arrowleft': { const v = document.getElementById(modalVideoId); if (v) v.currentTime = Math.max(0, v.currentTime - 10); break; }
      case 'f': toggleFullscreen(); break;
      case 'm': toggleMute(); break;
      case 'n': playNext(); break;
      case 'p': playPrev(); break;
    }
  });

  /******************************
   * Page init (renders cards and wires clicks to openPlayer)
   ******************************/
  const container = document.getElementById('movies');
  const searchBtn = document.getElementById('search-btn');
  const searchBar = document.getElementById('search-bar');
  const themeToggle = document.getElementById('theme-toggle');

  function initPage() {
    // Create movie cards
    container.innerHTML = '';
    movies.forEach((movie, index) => {
      const card = document.createElement('div');
      card.className = `movie-card fade-in delay-${index % 5} glow-effect`;
      card.innerHTML = `
        <div class="relative group overflow-hidden rounded-xl cursor-pointer">
          <img src="${movie.image}" alt="${movie.title}" 
               class="w-full h-48 sm:h-56 md:h-64 object-cover rounded-xl transition duration-500 group-hover:scale-105">
          <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4">
            <div>
              <h3 class="text-white font-semibold text-lg">${movie.title}</h3>
              <p class="text-gray-300 text-sm">${movie.runtime}</p>
            </div>
          </div>
          <div class="absolute top-3 right-3 bg-black bg-opacity-70 text-yellow-500 rounded-full w-10 h-10 flex items-center justify-center">
            <i class="fas fa-play"></i>
          </div>
          <div class="absolute top-3 left-3 bg-black bg-opacity-70 text-yellow-500 rounded-full px-2 py-1 text-xs">
            ${movie.rating}
          </div>
        </div>
        <div class="mt-3">
          <h3 class="text-white font-medium">${movie.title}</h3>
          <div class="flex items-center text-gray-400 text-sm mt-1">
            <span>${movie.year}</span>
            <span class="mx-2">•</span>
            <span>${movie.runtime}</span>
          </div>
        </div>
      `;

      // --- Changed: open modal player instead of redirecting ---
      card.addEventListener('click', () => {
        // use current movies array as list (no scope filtering here)
        openPlayer(movies, index);
      });

      container.appendChild(card);
    });

    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const active = document.querySelector('.filter-btn.active');
        if (active) active.classList.remove('active', 'bg-yellow-600', 'text-black');
        this.classList.add('active', 'bg-yellow-600', 'text-black');
        // (We did not implement filter logic — left as-is)
      });
    });
  }

  // Event listeners
  searchBtn.addEventListener('click', () => {
    searchBar.classList.toggle('hidden');
  });

  themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('bg-gray-100');
    document.body.classList.toggle('text-gray-900');
    document.body.classList.toggle('bg-black');
    document.body.classList.toggle('text-gray-100');

    const icon = themeToggle.querySelector('i');
    if (document.body.classList.contains('bg-black')) {
      icon.classList.remove('fa-sun');
      icon.classList.add('fa-moon');
    } else {
      icon.classList.remove('fa-moon');
      icon.classList.add('fa-sun');
    }
  });

  // Wire modal close from escape & by clicking outside already set above.
  // Also add an explicit close button? Transformers original had a close; we keep escape/outside click.

  // Initialize
  initPage();

</script>
</body>
</html>
