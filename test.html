<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live TV Channels</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Video.js -->
<link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet">
<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>

<!-- Shaka Player -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.js"></script>

<style>
:root {
  --bg: #0b0b0b;
  --panel: #141414;
  --card: #1e1e1e;
  --accent: #00c3ff;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: system-ui, Arial, sans-serif;
  background: var(--bg);
  color: #fff;
}

header {
  background: #111;
  padding: 14px;
  text-align: center;
  font-size: 20px;
  font-weight: bold;
}

/* Header Logo */
.header-logo {
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  height: 36px;
}

.header-wrap {
  position: relative;
}


/* Layout */
#container {
  display: grid;
  grid-template-columns: 300px 1fr;
  height: calc(100vh - 56px);
}

#sidebar {
  background: var(--panel);
  display: flex;
  flex-direction: column;
}

#searchBox {
  padding: 12px;
  border: none;
  outline: none;
  background: #1c1c1c;
  color: #fff;
  font-size: 14px;
}

/* Channel Grid */
#channelList {
  padding: 12px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
  gap: 12px;
  overflow-y: auto;
}

.channel {
  background: var(--card);
  border-radius: 14px;
  padding: 14px 10px;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  transition: 0.25s ease;
  text-align: center;
}

.channel:hover {
  transform: translateY(-4px);
  background: #2a2a2a;
}

.channel.active {
  outline: 2px solid var(--accent);
}

.logo {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  background: var(--accent);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 20px;
  color: #000;
}

.channel span {
  font-size: 13px;
  opacity: 0.9;
}

/* Player Modal */
#playerModal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.92);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

#playerModalContent {
  position: relative;
  width: 100%;
  height: 100%;
  background: #000;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Perfect video fit */
#playerModal video {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* Close Button */
#closeBtn {
  position: absolute;
  top: 14px;
  right: 16px;
  background: rgba(0,0,0,0.7);
  color: #fff;
  border: none;
  font-size: 18px;
  padding: 8px 12px;
  cursor: pointer;
  z-index: 10;
  border-radius: 8px;
}

#closeBtn:hover {
  background: red;
}

/* Mobile */
@media (max-width: 768px) {
  #container {
    grid-template-columns: 1fr;
  }

  #channelList {
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
  }
}
</style>
</head>

<body>

<header class="header-wrap">
  <img
    src="https://static.readdy.ai/image/0ece273271e400e488b9947cb1e99e9a/a79b6f32c71c4ee2094ead0eb9c84c9b.png"
    class="header-logo"
    alt="Logo"
  >
  ðŸ“º Live TV
</header>


<div id="container">
  <div id="sidebar">
    <input id="searchBox" placeholder="ðŸ” Search channels...">
    <div id="channelList"></div>
  </div>
</div>

<!-- Player Modal -->
<div id="playerModal">
  <div id="playerModalContent">
    <button id="closeBtn">âœ•</button>
    <video id="video" class="video-js vjs-default-skin" controls autoplay playsinline></video>
  </div>
</div>

<script>
const channels = [
  /* ðŸ”¥ YOUR CHANNEL ARRAY â€” UNCHANGED */
{"id": "stss1",
"m3u8": "https://tvsen6.aynaott.com/spsel1/index.m3u8"},
{"id":"redbull","m3u8":"https://rbmn-live.akamaized.net/hls/live/590964/BoRB-AT/master_3360.m3u8"},
  {"id": "tnt1",
 "mpd": "https://ottb.live.cf.ww.aiv-cdn.net/lhr-nitro/live/dash/enc/wf8usag51e/out/v1/bd3b0c314fff4bb1ab4693358f3cd2d3/cenc.mpd",
 "key": "d0f2e5c39e70c18f29bf77768a1ad89a:d6853c51fcf37a18905f0609972395d7" }, 
{"id": "tnt2",
 "mpd": "https://ottb.live.cf.ww.aiv-cdn.net/lhr-nitro/live/dash/enc/bsaaetko8v/out/v1/f8fa17f087564f51aa4d5c700be43ec4/cenc.mpd",
 "key": "9f51f3dc6313ac8bc668e2d9d1c04dfa:74bc63e5a193454a91ca494975db33f9" },
{"id": "tnt3",
 "mpd": "https://ottb.live.cf.ww.aiv-cdn.net/lhr-nitro/live/dash/enc/lsdasbvglv/out/v1/bb548a3626cd4708afbb94a58d71dce9/cenc.mpd",
 "key": "a93c1cbfdccd23233bac13540c693e7f:2f6ab2e6693eb847eff3c9da8f9d01fc" }, 
 {"id": "tnt4",
 "mpd": "https://ottb.live.cf.ww.aiv-cdn.net/lhr-nitro/live/dash/enc/i2pcjr4pe5/out/v1/912e9db56d75403b8a9ac0a719110f36/cenc.mpd",
 "key": "192b1115da041585c77200128549efa1:634e10efe4abbb14be400a3ccbac0258" },
 {"id": "tnt5",
 "mpd": "https://otte.live.fly.ww.aiv-cdn.net/lhr-nitro/live/dash/enc/gesdwrdncn/out/v1/79e752f1eccd4e18b6a8904a0bc01f2d/cenc.mpd",
 "key": "60c0d9b41475e01db4ffb91ed557fbcc:36ee40e58948ca15e3caba8d47b8f34b" },
{"id": "stss1",
"m3u8": "https://tvsen6.aynaott.com/spsel1/index.m3u8"}, 
 {"id":"bein1","mpd":"https://aba5sdmaaaaaaaamooyrewxky2c4j.otte.live.cf.ww.aiv-cdn.net/syd-nitro/live/dash/enc/ghwcl6hv68/out/v1/83536910d8034e9b9895a20fbe1c1687/cenc.mpd","key":"335dad778109954503dcbb21dc92015f:24bfd75d436cbf73168a2a2dccd40281"},
{"id":"bein11", 
"mpd":"https://linearjitp-playback.astro.com.my/dash-wv/linear/408/default_ott.mpd","key":"1a655189ab5c49eb235308c2b1a9e710:3c4508af348844107f5e026a4fd6b16e"}, 
{"id":"bein2", 
"mpd":"https://aba5sdmaaaaaaaamdwujas5g6mg4r.otte.live.cf.ww.aiv-cdn.net/syd-nitro/live/dash/enc/8m8cd46i1t/out/v1/83985c68e4174e90a58a1f2c024be4c9/cenc.mpd","key":"0b42be2664d7e811d04f3e504e0924c5:ae24090123b8c72ac5404dc152847cb8"}, 
{"id":"bein21", 
"mpd":"https://linearjitp-playback.astro.com.my/dash-wv/linear/5066/default_ott.mpd","key":"39c175581e237eff9559607eb9b23c10:5102b12aac7756c65dcb46a101d960d3"}, 
{"id":"bein3", 
"mpd":"https://aba5sdmaaaaaaaamhq2w5oosrf5ae.otte.live.cf.ww.aiv-cdn.net/syd-nitro/live/dash/enc/q4u5nwaogz/out/v1/18de6d3e65934f3a8de4358e69eab86c/cenc.mpd","key":"7995c724a13748ed970840a8ab5bb9b3:67bdaf1e2175b9ff682fcdf0e2354b1e"}, 
{"id":"bein31", 
"mpd":"https://linearjitp-playback.astro.com.my/dash-wv/linear/2705/default_ott.mpd","key":"20c884ef8ed26b2762f8b1a78f2d1910:042a21bf236ca729b1e343ed6e0a6337"}, 
{"id":"beinxtra","m3u8":"https://bein-esp-xumo.amagi.tv/playlistR1080p.m3u8"},
{"id": "willowsports",
 "mpd": "https://a201aivottlinear-a.akamaihd.net/OTTB/lhr-nitro/clients/dash/enc/f60kqesunw/out/v1/a435ed7a00f947deb4369b46d8f2fb70/cenc.mpd",
 "key": "1779c27b9d077a3ba0c9cc1bb9a94b9f:cc5cf3b7928fb9e0a1ee6a8b566f0a8e" },
{"id": "willowsports1",
 "mpd": "https://aba3uy3aaaaaaaamfjv2jyrjdxcj4.otte.live.cf.ww.aiv-cdn.net/sin-nitro/live/dash-sd/enc/sq3nwcl4j4/out/v1/41930b7349364099bb1b4ef153032937/cenc-sd.mpd",
 "key": "4ae41f5965180707b310360dc5060c09:f78d1ba450f7ff87f215eb472cb4e17e" },
 {"id": "astrogd",
 "mpd": "https://linearjitp-playback.astro.com.my/dash-wv/linear/2701/default_ott.mpd",
 "key": "5be66a6f88efee3d6e30f72a9c58e310:168f3fadfc730ba3dfc932f7c430e27d" },
  {"id":"sts21","mpd":"https://edge4-moblive.yuppcdn.net/drm1/smil:starsports2drm.smil/manifest.mpd","key":"9872e439f21f4a299cab249c6554daa3:0cdfcfe0d0f1fbe100554ce3ef4c4665"}, 
{"id":"euro1","mpd":"https://v4-pan-n79-cdn-01.live.cdn.cgates.lt/live/dash/561802/index.mpd","key":"01a665d487aa4c1c898c9eb0ff1a21df:a0b9df5f92e6b218ddb6aa40a2cd996d"},
{"id":"euro21", 
"mpd":"https://dash2.antik.sk/stream/nvidia_eurosport2/playlist_cenc.mpd","key":"11223344556677889900112233445566:4b80724d0ef86bcb2c21f7999d67739d"},
{"id":"espn1", 
"mpd":"https://aca-live1-ott.izzigo.tv/6/out/u/dash/ESPNHDH265/default.mpd","key":"3fb8167957692836eca1464b7f952b45:f31042e8167eb4b49ce8117c9e5f1e85"}, 
{"id":"espn2", 
"mpd":"https://aca-live1-ott.izzigo.tv/7/out/u/dash/ESPN2HDH265/default.mpd","key":"faa2d2197cc44dc154650bbacb0dc238:9859d70c856660e20bbe6896f9cd3048"}, 
{"id":"espn3", 
"mpd":"https://aca-live1-ott.izzigo.tv/6/out/u/dash/ESPN3HDH265/default.mpd","key":"10580600369dbd7ac029f7e737247917:24ef48adb31daa130675c2a502da6982"}, 
{"id":"espn4", 
"mpd":"https://aca-live1-ott.izzigo.tv/6/out/u/dash/ESPN4HDH265/default.mpd","key":"1d2d7f1116eeec62d19943a892d721f7:033b809769a3c248af7383aa817fce72"},


 
];

const channelList = document.getElementById('channelList');
const searchBox = document.getElementById('searchBox');
const modal = document.getElementById('playerModal');
const closeBtn = document.getElementById('closeBtn');
let video = document.getElementById('video');

let vjsPlayer = videojs(video);
let shakaPlayer = null;
let activeChannelId = localStorage.getItem('lastChannel');

/* Render Channels */
function renderChannels(filter = '') {
  channelList.innerHTML = '';
  channels
    .filter(c => c.id.toLowerCase().includes(filter))
    .forEach(ch => {
      const div = document.createElement('div');
      div.className = 'channel';
      if (ch.id === activeChannelId) div.classList.add('active');

      const logo = document.createElement('div');
      logo.className = 'logo';
      logo.textContent = ch.id[0].toUpperCase();

      const name = document.createElement('span');
      name.textContent = ch.id.toUpperCase();

      div.append(logo, name);
      div.onclick = () => openPlayer(ch);
      channelList.appendChild(div);
    });
}

searchBox.oninput = e => renderChannels(e.target.value.toLowerCase());

async function openPlayer(ch) {
  activeChannelId = ch.id;
  localStorage.setItem('lastChannel', ch.id);
  renderChannels(searchBox.value.toLowerCase());

  modal.style.display = 'flex';
  await playChannel(ch);
}

async function closePlayer() {
  modal.style.display = 'none';

  // Destroy Shaka cleanly
  if (shakaPlayer) {
    await shakaPlayer.destroy();
    shakaPlayer = null;
  }

  // Dispose Video.js completely
  if (vjsPlayer) {
    vjsPlayer.dispose();
    vjsPlayer = null;
  }

  // Recreate video element (CRITICAL FIX)
  const container = document.getElementById('playerModalContent');
  const oldVideo = document.getElementById('video');

  if (oldVideo) oldVideo.remove();

  const newVideo = document.createElement('video');
  newVideo.id = 'video';
  newVideo.className = 'video-js vjs-default-skin';
  newVideo.setAttribute('controls', '');
  newVideo.setAttribute('autoplay', '');
  newVideo.setAttribute('playsinline', '');

  container.appendChild(newVideo);

  // Re-init Video.js
  video = newVideo;
  vjsPlayer = videojs(video);
}


closeBtn.onclick = closePlayer;
document.addEventListener('keydown', e => e.key === 'Escape' && closePlayer());

/* Playback Logic â€” untouched */
async function playChannel(ch) {
  if (shakaPlayer) {
    await shakaPlayer.destroy();
    shakaPlayer = null;
  }

  if (ch.m3u8) {
    vjsPlayer.src({ src: ch.m3u8, type: 'application/x-mpegURL' });
    vjsPlayer.play();
  }

  if (ch.mpd) {
    vjsPlayer.pause();
    shakaPlayer = new shaka.Player(video);

    if (ch.key) {
      const [kid, key] = ch.key.split(':');
      shakaPlayer.configure({ drm: { clearKeys: { [kid]: key } } });
    }

    try {
      await shakaPlayer.load(ch.mpd);
    } catch (e) {
      alert('Playback error');
      console.error(e);
    }
  }
}

renderChannels();
</script>

</body>
</html>
