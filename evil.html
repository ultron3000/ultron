<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Resident Evil Universe</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<!-- HLS.js for HLS playback -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.1/dist/hls.min.js"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary: #ffcc00;
      --secondary: #111827;
      --accent: #f59e0b;
      --muted: #9CA3AF;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: white;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .movie-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      transform-origin: center;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .movie-card:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .search-input {
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .search-input:focus {
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.5);
    }
    
    .header-glow {
      text-shadow: 0 0 10px rgba(255, 204, 0, 0.7);
    }
    
    .movie-poster {
      aspect-ratio: 2/3;
      transition: transform 0.5s ease;
    }
    
    .movie-card:hover .movie-poster {
      transform: scale(1.05);
    }
    
    .category-tab {
      transition: all 0.3s ease;
    }
    
    .category-tab:hover {
      transform: translateY(-2px);
    }
    
    .category-tab.active {
      background-color: var(--primary);
      color: var(--secondary);
      font-weight: 600;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #1e293b;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #ffcc00;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #f59e0b;
    }
    
    /* Animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.6s ease forwards;
    }
    
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
    .delay-400 { animation-delay: 0.4s; }
    
    /* Illumination modal styles (responsive) */
    .modal-backdrop { 
      position:fixed; 
      inset:0; 
      background: rgba(0,0,0,0.9); 
      display:none; 
      align-items:center; 
      justify-content:center; 
      z-index:9999; 
      padding: 0;
    }
    .modal-backdrop.active { display:flex; }
    .modal-card { 
      width: 100%;
      height: 100%;
      max-width: 980px;
      max-height: 90vh;
      border-radius: 0;
      overflow: hidden;
      background: #0b1220;
      box-shadow: 0 30px 80px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
    }
    .player-wrapper { 
      position: relative;
      flex: 1;
      min-height: 0;
      background: #000;
    }
    #topCloseBtn { 
      position: absolute;
      top: 8px;
      right: 8px;
      z-index: 10;
      background: rgba(0,0,0,0.7);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 1;
      transition: all 0.2s ease;
    }
    #topCloseBtn:hover {
      background: rgba(0,0,0,0.9);
      transform: scale(1.1);
    }
    .player-wrapper video, 
    .player-wrapper iframe { 
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .player-meta { 
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 12px;
      color: #ddd;
      background: #0b1220;
    }
    .player-meta .meta-left { 
      width: 100%;
    }
    .player-meta h3 { 
      margin: 0;
      font-size: 1.125rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .player-meta p { 
      margin: 6px 0 0 0;
      color: var(--muted);
      font-size: 0.92rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .controls-row { 
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: center;
    }

    .btn {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      min-width: 60px;
      flex: 1;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .btn:hover { 
      background: rgba(254,209,65,0.06); 
    }
    .btn i {
      font-size: 1rem;
    }

    /* Responsive adjustments */
    @media (min-width: 768px) {
      .modal-card {
        width: 92%;
        height: auto;
        border-radius: 12px;
        max-height: 80vh;
      }
      .player-wrapper {
        padding-bottom: 56.25%;
        height: 0;
      }
      .player-meta {
        flex-direction: row;
        justify-content: space-between;
        align-items: flex-start;
      }
      .player-meta .meta-left {
        max-width: 65%;
      }
      .controls-row {
        flex-wrap: nowrap;
        justify-content: flex-end;
      }
      .btn {
        flex: 0;
        min-width: auto;
        padding: 8px 12px;
      }
      #topCloseBtn {
        opacity: 0;
      }
      .player-wrapper:hover #topCloseBtn {
        opacity: 1;
      }
    }

    @media (max-width: 480px) {
      .btn {
        padding: 8px;
        font-size: 0;
      }
      .btn i {
        font-size: 1rem;
        margin: 0 !important;
      }
    }

    /* Modal legacy styles (unused) */
    .modal-overlay { display:none; }
    /* ============================
   DESKTOP FIX — DOES NOT TOUCH MOBILE
   ============================ */

@media (min-width: 768px) {

  /* Fix video height so it doesn't cover controls */
  .player-wrapper {
    padding-bottom: 0 !important;     /* remove forced 16:9 only on desktop */
    height: auto !important;
    max-height: 60vh !important;       /* safe video height */
    position: relative !important;
  }

  /* Ensure iframe/video stays inside wrapper */
  .player-wrapper video,
  .player-wrapper iframe {
    height: 100% !important;
    max-height: 60vh !important;
    position: relative !important;
  }

  /* Make sure controls are ALWAYS visible above video */
  .player-meta {
    position: relative !important;
    z-index: 100 !important;
    background: #0b1220 !important;      /* solid background for visibility */
    padding-top: 10px !important;
  }

  /* Controls row layout */
  .controls-row {
    display: flex !important;
    flex-wrap: wrap !important;
    justify-content: center !important;
    gap: 12px !important;
  }

  /* Buttons behave normally */
  .btn {
    min-width: 95px !important;
    padding: 10px 16px !important;
    flex: unset !important;
  }

  /* Modal height adjustment to fit everything */
  .modal-card {
    max-height: 85vh !important;
    overflow: visible !important;
  }
}

  </style>
</head>
<body class="relative">
<!-- Floating stars background -->
<div class="fixed inset-0 overflow-hidden -z-10">
<div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/80"></div>
<div class="stars"></div>
<div class="stars2"></div>
</div>
<div class="container mx-auto px-4 py-8 max-w-7xl">

<!-- Full-Width Video Header with Animated Logo -->
<div class="relative w-full h-[400px] md:h-[500px] overflow-hidden">
  <!-- YouTube Video Background -->
  <iframe 
    src="https://www.youtube.com/embed/lk549ugEjks?autoplay=1&mute=1&loop=1&playlist=lk549ugEjks&controls=0&modestbranding=1"
    frameborder="0" 
    allow="autoplay; fullscreen" 
    class="absolute top-0 left-0 w-full h-full pointer-events-none">
  </iframe>

  <!-- Animated Logo at Top-Left -->
  <img 
    src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Resident_Evil_%28Movie_logo%29.svg/2560px-Resident_Evil_%28Movie_logo%29.svg.png" 
    alt="Despicable Me Logo" 
    class="absolute top-4 left-4 h-16 md:h-24 animate-logo z-10"
  />
</div>

<style>
  /* Animated Logo */
  .animate-logo {
    animation: float-pulse 3s ease-in-out infinite, glow-logo 2s ease-in-out infinite alternate;
  }

  @keyframes float-pulse {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  @keyframes glow-logo {
    0% { filter: drop-shadow(0 0 2px #fffa65) drop-shadow(0 0 4px #ffba00); }
    50% { filter: drop-shadow(0 0 6px #fffa65) drop-shadow(0 0 12px #ffba00); }
    100% { filter: drop-shadow(0 0 2px #fffa65) drop-shadow(0 0 4px #ffba00); }
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .animate-logo { height: 4rem; top: 1rem; left: 1rem; }
  }
</style>

</div>
</div>
<!-- Movies Grid -->
<div class="mb-12">
<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6" id="movies"></div>
</div>
<!-- Footer / Social -->
  <div class="border-t border-gray-800 mt-8 pt-6 text-center text-gray-500">
    <a href="#" class="text-gray-400 hover:text-[#c0392b] transition px-2"><i class="fab fa-facebook-f"></i></a>
    <a href="#" class="text-gray-400 hover:text-[#c0392b] transition px-2"><i class="fab fa-twitter"></i></a>
    <a href="https://www.instagram.com/stark_4152/reels" class="text-gray-400 hover:text-[#c0392b] transition px-2"><i class="fab fa-instagram"></i></a>
    <a href="https://www.youtube.com/channel/UCD9dGWVkAjrdm3D_7gkbi2g" class="text-gray-400 hover:text-[#c0392b] transition px-2"><i class="fab fa-youtube"></i></a>
  </div>
</div>

<!-- === REPLACED: Illumination-style Modal Player === -->
<div id="playbackModal" class="modal-backdrop" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true">
    <div class="player-wrapper" id="playerWrapper">
      <!-- video or iframe injected here -->
      <video id="modalVideo" controls playsinline style="width:100%;height:100%;background:#000"></video>
      <button id="topCloseBtn" class="absolute top-4 right-4 z-10 bg-black/70 hover:bg-black/90 text-white rounded-full w-10 h-10 flex items-center justify-center transition">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>

    <div class="player-meta">
      <div class="meta-left">
        <h3 id="modalTitle">Title</h3>
        <p id="modalDesc" class="text-sm"></p>
      </div>
      <div class="controls-row">
        <button id="prevBtn" class="btn"><i class="fas fa-step-backward mr-2"></i>Prev</button>
        <button id="playPauseBtn" class="btn"><i class="fas fa-play mr-2"></i>Play</button>
        <button id="nextBtn" class="btn">Next<i class="fas fa-step-forward ml-2"></i></button>
        <button id="fullscreenBtn" class="btn"><i class="fas fa-expand"></i></button>
        <button id="muteBtn" class="btn"><i class="fas fa-volume-up"></i></button>
        <button id="closeBtn" class="btn"><i class="fas fa-times"></i></button>
      </div>
    </div>
  </div>
</div>

<script>
    /******************************
     * Existing movies array (unchanged)
     ******************************/
    const movies = [
    { 
        title: "Resident Evil", 
        video: "https://s5zt.valorpath.online/v4/vz/jwe3y/cf-master.txt?v=1731014337", 
        image: "https://image.tmdb.org/t/p/original/1UKNef590A0ZaMnxsscIcWuK1Em.jpg",
        year: 2002,
        type: "movie",
        duration: "100 min",
        rating: 6.6,
        description: "A special military unit fights a powerful, out-of-control supercomputer and hundreds of scientists who have mutated into flesh-eating creatures after a laboratory accident."
      },
      { 
        title: "Resident Evil: Apocalypse", 
        video: "https://sdqm.bryndellcreativehub.cyou/v4/m9/rv5mk/cf-master.txt?v=1730868935", 
        image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRdiiX0YCOeVMurh1l47oZt1abtBnz3XUiyww&s",
        year: 2004,
        type: "movie",
        duration: "94 min",
        rating: 6.1,
        description: "Alice awakes in Raccoon City, only to find it has become infested with zombies and monsters. With the help of Jill Valentine and Carlos Olivera, Alice must find a way out."
      },
      { 
        title: "Resident Evil: Extinction", 
          video: "https://s9dz.luminaryentertainment.shop/v4/qu/xqvpy/cf-master.txt?v=1735634928", 
        image: "https://lh3.googleusercontent.com/proxy/caKWq0vkTBd36ZW-Rb6l0xQr1HfLZMY6mqWmarB8CU8AF74aRGVykn16pScbOpbpAwioJZlYaq77j15uplBD-TbZwTcwAzL7VtVvMH1klHxdsHQNE_lDW6nO",
        year: 2007,
        type: "movie",
        duration: "94 min",
        rating: 6.0,
        description: "Survivors of the Raccoon City catastrophe travel across the Nevada desert, hoping to make it to Alaska. Alice joins them and together they fight the undead and the evil Umbrella Corporation."
      },
      { 
        title: "Resident Evil: Afterlife", 
        video: "https://sdqm.vellariofashion.cyou/v4/9a/ecvbb/cf-master.txt?v=1734233660", 
        image: "https://image.tmdb.org/t/p/original/qf8XoYwhPuk7omhcSdvAH2742my.jpg",
        year: 2010,
        type: "movie",
        duration: "97 min",
        rating: 5.8,
        description: "While still out to destroy the evil Umbrella Corporation, Alice joins a group of survivors living in a prison surrounded by the infected who also want to relocate to the mysterious but supposedly unharmed safe haven known only as Arcadia."
      },
      { 
        title: "Resident Evil: Retribution", 
        video: "https://znomc6azq2dc.nuvowaveproject.store/qfx8jx2m0lfz/hls3/01/00362/6ppwg4pvpqr9_h/master.txt", 
        image: "https://m.media-amazon.com/images/I/71mgrPbwftL._AC_UF894,1000_QL80_.jpg",
        year: 2012,
        type: "movie",
        duration: "96 min",
        rating: 5.7,
        description: "Alice fights alongside a resistance movement in the continuing battle against the Umbrella Corporation and the undead."
      },
      { 
        title: "Resident Evil: The Final Chapter", 
        video: "https://sunl.skylinehospitality.store/v4/db/daewf/cf-master.txt?v=1732146051", 
        image: "https://cdn11.bigcommerce.com/s-yzgoj/images/stencil/1280x1280/products/2904782/5971629/MOVAB39355__60101.1679612811.jpg?c=2",
        year: 2016,
        type: "movie",
        duration: "107 min",
        rating: 5.9,
        description: "Alice returns to where the nightmare began - The Hive in Raccoon City, where the Umbrella Corporation is gathering its forces for a final strike against the only remaining survivors of the apocalypse."
      },
      { 
        title: "Resident Evil: Degeneration", 
        video: "https://sqtd.luminairewellbeing.sbs/v4/us/m866o/cf-master.txt?v=1735357982", 
        image: "https://i.pinimg.com/474x/5d/45/8e/5d458e318ee7195665c6f1e29d3cddf5.jpg",
        year: 2008,
        type: "animation",
        duration: "97 min",
        rating: 6.4,
        description: "Set between Resident Evil 4 and Resident Evil 5, Leon S. Kennedy and Claire Redfield must contain a zombie outbreak at an airport."
      },
      { 
        title: "Resident Evil: Damnation", 
        video: "https://scvo.lyonic.cyou/v4/ck/mrej3/cf-master.txt?v=1733222234", 
        image: "https://image.tmdb.org/t/p/original/yhokCOGRDEaldBUkqNOYVbRvdga.jpg",
        year: 2012,
        type: "animation",
        duration: "100 min",
        rating: 6.5,
        description: "Leon S. Kennedy enters a war-torn Eastern European country to investigate rumors of bio-organic weapons being used in the conflict."
      },
      { 
        title: "Resident Evil: Vendetta", 
        video: "https://smeb.stellarcreststudio.cyou/v4/36/etzps/cf-master.txt?v=1735230868", 
        image: "https://image.tmdb.org/t/p/original/kdiMtgjWXEH9QZ85hgmWaSwshjf.jpg",
        year: 2017,
        type: "animation",
        duration: "97 min",
        rating: 6.3,
        description: "BSAA agent Chris Redfield enlists the help of Leon S. Kennedy and Rebecca Chambers to stop a death merchant with a vengeance from spreading a deadly virus in New York."
      },
      { 
        title: "Resident Evil: Welcome to Raccoon City", 
        video: "https://spuc.glimmerpathfashion.cyou/v4/ty/hdeix/cf-master.txt?v=1730757933", 
        image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSNEn__aJHfXzZD3AHvYKR8WUSVtXCkPR6rJg&s",
        year: 2021,
        type: "movie",
        duration: "107 min",
        rating: 5.4,
        description: "Set in 1998, this origin story explores the secrets of the mysterious Spencer Mansion and the ill-fated Raccoon City."
      },
      { 
        title: "Resident Evil: Death Island", 
        video: "https://sdqm.neoventis.sbs/v4/il/qa1x3/index-f1-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/M/MV5BNzg0OWYwOTMtYjVhNy00NzY0LWJiYTMtMGQ3OTczMmEwZmVhXkEyXkFqcGc@._V1_.jpg",
        year: 2023,
        type: "animation",
        duration: "87 min",
        rating: 6.8,
        description: "Leon S. Kennedy, Chris Redfield, and Jill Valentine team up to investigate a zombie outbreak on Alcatraz Island."
      }, ];
    /******************************
     * DOM refs for modal controls
     ******************************/
    const playbackModal = document.getElementById('playbackModal');
    const playerWrapper = document.getElementById('playerWrapper');
    const modalVideoId = 'modalVideo';
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const muteBtn = document.getElementById('muteBtn');

    let currentHls = null;
    let currentFiltered = [];
    let currentIndex = null;

    /******************************
     * Type detection helpers
     ******************************/
    function isMP4(url) { return /\.mp4($|\?)/i.test((url||'')); }
    function isHls(url) {
      if (!url) return false;
      return url.includes('.m3u8') || url.includes('index-') || /index.*\.txt/i.test(url) || url.includes('manifest') || url.includes('master');
    }
    function isYouTube(url) {
      if (!url) return false;
      return url.includes('youtube.com') || url.includes('youtu.be') || url.includes('youtube-nocookie.com') || url.includes('/embed/');
    }

    /******************************
     * Reset player container
     ******************************/
    function resetPlayerContainer() {
      if (currentHls) {
        try { currentHls.destroy(); } catch(e) {}
        currentHls = null;
      }
      playerWrapper.innerHTML = `<video id="${modalVideoId}" controls playsinline style="width:100%;height:100%;background:#000"></video>`;
    }

    function showModal() {
      playbackModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function hideModal() {
      playbackModal.classList.remove('active');
      document.body.style.overflow = '';
    }

    function showError(msg) {
      console.warn(msg);
    }

    /******************************
     * Core: open player (Illumination logic)
     ******************************/
    function openPlayer(list, index) {
      if (!Array.isArray(list) || list.length === 0 || index == null || index < 0 || index >= list.length) {
        showError('Invalid playback request');
        return;
      }
      currentFiltered = list;
      currentIndex = index;
      const movie = list[index];
      if (!movie) { showError('Movie missing'); return; }

      // metadata
      modalTitle.textContent = movie.title || '';
      modalDesc.textContent = movie.description || (movie.title || '');

      // reset & show
      resetPlayerContainer();
      showModal();

      // pick src
      let src = '';
      if (typeof movie.video === 'object' && movie.video !== null) {
        src = movie.video.high || movie.video.medium || movie.video.low || Object.values(movie.video)[0];
      } else {
        src = movie.video;
      }
      if (!src) {
        showError('No video source');
        setTimeout(()=> window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=`, 500);
        return;
      }

      const lc = (src || '').toLowerCase();

      // iframe-hosted common hosts
      if (lc.includes('streamtape.com') || lc.includes('dood') || lc.includes('vidcdn') || lc.includes('ok.ru') || lc.includes('mega.nz') || lc.includes('openload') || lc.includes('drive.google.com')) {
        playerWrapper.innerHTML = `<iframe src="${src}" width="100%" height="100%" frameborder="0" allowfullscreen allow="autoplay; encrypted-media"></iframe>`;
        playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
        return;
      }

      // youtube
      if (isYouTube(src)) {
        let embed = src;
        try {
          if (src.includes('watch') && src.includes('v=')) {
            const v = new URLSearchParams(src.split('?')[1]).get('v');
            if (v) embed = `https://www.youtube.com/embed/${v}`;
          } else if (src.includes('youtu.be/')) {
            const p = src.split('youtu.be/')[1].split(/[?&]/)[0];
            if (p) embed = `https://www.youtube.com/embed/${p}`;
          }
        } catch (e) {}
        playerWrapper.innerHTML = `<iframe src="${embed}?autoplay=1&modestbranding=1&rel=0" width="100%" height="100%" frameborder="0" allowfullscreen allow="autoplay; encrypted-media"></iframe>`;
        playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
        return;
      }

      // HLS
      if (isHls(src)) {
        const v = document.getElementById(modalVideoId);
        if (!v) { showError('Video element missing'); return; }
        if (window.Hls && Hls.isSupported()) {
          currentHls = new Hls();
          try {
            currentHls.loadSource(src);
            currentHls.attachMedia(v);
          } catch (e) { console.warn('HLS attach error', e); }
          currentHls.on(Hls.Events.MANIFEST_PARSED, function() {
            v.play().catch(()=>{});
            playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
          });
          currentHls.on(Hls.Events.ERROR, function(event, data) {
            console.warn('HLS error', data);
            if (data && data.fatal) {
              try { currentHls.destroy(); } catch(e){}
              currentHls = null;
              showError('HLS fatal error — redirecting to player.html');
              setTimeout(()=> window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`, 700);
            }
          });
        } else if (v.canPlayType && v.canPlayType('application/vnd.apple.mpegurl')) {
          v.src = src;
          v.play().catch(()=>{});
          playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
        } else {
          showError('HLS not supported — redirecting to player.html');
          setTimeout(()=> window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`, 700);
        }
        return;
      }

      // MP4
      if (isMP4(src)) {
        const v = document.getElementById(modalVideoId);
        if (!v) { window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`; return; }
        v.src = src;
        v.play().catch(()=>{});
        playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
        return;
      }

      // fallback
      window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`;
    }

    /******************************
     * Controls
     ******************************/
    function togglePlayPause() {
      const v = document.getElementById(modalVideoId);
      if (!v) return;
      if (v.paused) {
        v.play().catch(()=>{});
        playPauseBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
      } else {
        v.pause();
        playPauseBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Play';
      }
    }
    function playNext() {
      if (!currentFiltered || currentFiltered.length === 0) currentFiltered = movies.slice();
      if (currentIndex == null) return showError('No current video');
      if (currentIndex < currentFiltered.length - 1) openPlayer(currentFiltered, currentIndex + 1);
      else showError('No next video');
    }
    function playPrev() {
      if (!currentFiltered || currentFiltered.length === 0) currentFiltered = movies.slice();
      if (currentIndex == null) return showError('No current video');
      if (currentIndex > 0) openPlayer(currentFiltered, currentIndex - 1);
      else showError('No previous video');
    }
    function toggleFullscreen() {
      const el = document.getElementById(modalVideoId) || playerWrapper.querySelector('iframe');
      if (!el) return;
      if (!document.fullscreenElement) {
        (el.requestFullscreen || playerWrapper.requestFullscreen).call(el).catch(()=> showError('Fullscreen failed'));
      } else {
        document.exitFullscreen();
      }
    }
    function toggleMute() {
      const v = document.getElementById(modalVideoId);
      if (!v) return;
      v.muted = !v.muted;
      muteBtn.innerHTML = v.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
    }

    /******************************
     * Close modal & cleanup
     ******************************/
    function closeModalHandler() {
      if (currentHls) {
        try { currentHls.destroy(); } catch(e) {}
        currentHls = null;
      }
      const v = document.getElementById(modalVideoId);
      if (v) {
        try { v.pause(); } catch(e){}
        try { v.removeAttribute('src'); v.load(); } catch(e){}
      }
      resetPlayerContainer();
      hideModal();
      currentIndex = null;
      currentFiltered = [];
      playPauseBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Play';
    }

    /******************************
     * Events wiring
     ******************************/
    playPauseBtn.addEventListener('click', togglePlayPause);
    nextBtn.addEventListener('click', playNext);
    prevBtn.addEventListener('click', playPrev);
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    muteBtn.addEventListener('click', toggleMute);
    document.getElementById('closeBtn').addEventListener('click', closeModalHandler);
    document.getElementById('topCloseBtn').addEventListener('click', closeModalHandler);

    // close by clicking outside
    playbackModal.addEventListener('click', function(e){
      if (e.target === playbackModal) closeModalHandler();
    });

    // Escape & keyboard
    document.addEventListener('keydown', (e) => {
      if (!playbackModal.classList.contains('active')) return;
      switch (e.key.toLowerCase()) {
        case 'escape': closeModalHandler(); break;
        case ' ': e.preventDefault(); togglePlayPause(); break;
        case 'arrowright': { const v = document.getElementById(modalVideoId); if (v) v.currentTime = Math.max(0, v.currentTime + 10); break; }
        case 'arrowleft': { const v = document.getElementById(modalVideoId); if (v) v.currentTime = Math.max(0, v.currentTime - 10); break; }
        case 'f': toggleFullscreen(); break;
        case 'm': toggleMute(); break;
        case 'n': playNext(); break;
        case 'p': playPrev(); break;
      }
    });

    /******************************
     * Render movies and wire to openPlayer
     ******************************/
    const container = document.getElementById('movies');

    function renderMovies(moviesToRender) {
      container.innerHTML = '';
      moviesToRender.forEach((movie, index) => {
        const delayClass = `delay-${(index % 5) * 100}`;

        const div = document.createElement('div');
        div.className = `movie-card animate-fade-in ${delayClass} rounded-xl overflow-hidden bg-gray-800 hover:bg-gray-700 cursor-pointer relative group`;
        div.innerHTML = `
          <div class="relative overflow-hidden rounded-t-lg">
            <img src="${movie.image}" alt="${movie.title}" class="w-full h-full object-cover movie-poster">
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4">
              <button class="bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold py-2 px-4 rounded-full transition transform hover:scale-105">
                <i class="fas fa-play mr-2"></i> Watch Now
              </button>
            </div>
          </div>
          <div class="p-4">
            <h3 class="font-semibold text-lg truncate">${movie.title}</h3>
            <div class="flex justify-between items-center mt-2 text-sm text-gray-400">
              <span>${movie.year}</span>
              <span>${movie.duration}</span>
            </div>
          </div>
        `;

        // Open modal and use movies array for prev/next
        div.addEventListener('click', () => {
          openPlayer(moviesToRender, index);
        });

        container.appendChild(div);
      });
    }

    // Initial render
    renderMovies(movies);

    /******************************
     * Backwards-compatible extras:
     * Keep original search/category wiring but guard missing elements
     ******************************/
    const modalCloseBtn = document.getElementById('modal-close-btn');
    if (modalCloseBtn) modalCloseBtn.addEventListener('click', closeModalHandler);

    // previous code referenced searchBar; guard that
    const searchBarEl = document.getElementById('searchBar');
    if (searchBarEl) {
      searchBarEl.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const filteredMovies = movies.filter(movie => 
          movie.title.toLowerCase().includes(searchTerm)
        );
        renderMovies(filteredMovies);
      });
    }

    // Category tabs preservation (guard for existence)
    document.querySelectorAll('.category-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        // Update active tab
        document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        const category = this.dataset.category;
        let filteredMovies;

        if (category === 'all') {
          filteredMovies = movies;
        } else {
          filteredMovies = movies.filter(movie => (movie.categories || []).includes(category));
        }

        renderMovies(filteredMovies);
      });
    });

    /******************************
     * Create floating stars background (existing)
     ******************************/
    function createStars(container, count, sizeRange, durationRange) {
      for (let i = 0; i < count; i++) {
        const star = document.createElement('div');
        star.className = 'absolute rounded-full bg-white';

        // Random position
        const left = Math.random() * 100;
        const top = Math.random() * 100;

        // Random size
        const size = sizeRange[0] + Math.random() * (sizeRange[1] - sizeRange[0]);

        // Random animation duration
        const duration = durationRange[0] + Math.random() * (durationRange[1] - durationRange[0]);

        star.style.left = `${left}%`;
        star.style.top = `${top}%`;
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.opacity = Math.random() * 0.5 + 0.1;
        star.style.animation = `float ${duration}s infinite ease-in-out alternate`;
        star.style.animationDelay = `${Math.random() * 5}s`;

        container.appendChild(star);
      }
    }

    const starsContainer = document.querySelector('.stars');
    const starsContainer2 = document.querySelector('.stars2');
    if (starsContainer) createStars(starsContainer, 50, [1, 3], [5, 15]);
    if (starsContainer2) createStars(starsContainer2, 30, [2, 4], [10, 20]);

    // Add floating animation
    const style = document.createElement('style');
    style.innerHTML = `
      @keyframes float {
        0% { transform: translateY(0) translateX(0); }
        50% { transform: translateY(-20px) translateX(10px); }
        100% { transform: translateY(0) translateX(0); }
      }
    `;
    document.head.appendChild(style);

</script>

<!-- ============================= -->
<!--     ADSTERAA GLOBAL BLOCK     -->
<!-- ============================= -->

<!-- Banner 300x250 (Best placement: under video or anywhere inside content) -->
<div id="adsterra-banner-container" style="text-align:center; margin:20px 0;">
    <script type="text/javascript">
      atOptions = {
        'key' : '267d846b24a4cdd5fd7ab140783cec90',
        'format' : 'iframe',
        'height' : 250,
        'width' : 300,
        'params' : {}
      };
    </script>
    <script type="text/javascript" src="//bowlingprosperhalfbrother.com/267d846b24a4cdd5fd7ab140783cec90/invoke.js"></script>
</div>


<!-- Social Bar (Floating bottom widget - high earnings, non-intrusive) -->
<script type="text/javascript" src="//bowlingprosperhalfbrother.com/42/5b/58/425b58e61b66997ed4519d91d1f2dcf4.js"></script>


<!-- PopUnder (fires once per user interaction) - keep LAST -->
<script type="text/javascript" src="//bowlingprosperhalfbrother.com/2d/95/e8/2d95e8d5c6532307745afa9b1be1162b.js"></script>

<!-- ============================= -->
<!--     END ADSTERRA BLOCK        -->
<!-- ============================= -->
<!-- ===========================
      EXOCLICK — ALL IN ONE ADS
     =========================== -->

<!-- DESKTOP POPUNDER -->
<script type="application/javascript">
(function() {
    function randStr(e,t){for(var n="",r=t||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=0;o<e;o++)n+=r.charAt(Math.floor(Math.random()*r.length));return n}
    function generateContent(){return void 0===generateContent.val&&(generateContent.val="document.dispatchEvent("+randStr(4*Math.random()+3)+");"),generateContent.val}
    try{Object.defineProperty(document.currentScript,"innerHTML",{get:generateContent}),Object.defineProperty(document.currentScript,"textContent",{get:generateContent})}catch(e){};

    var adConfig = {
        "ads_host": "a.pemsrv.com",
        "syndication_host": "s.pemsrv.com",
        "idzone": 5788556,
        "popup_fallback": false,
        "popup_force": false,
        "chrome_enabled": true,
        "new_tab": false,
        "frequency_period": 720,
        "frequency_count": 1,
        "trigger_method": 3,
        "trigger_class": "",
        "trigger_delay": 0,
        "capping_enabled": true,
        "tcf_enabled": true,
        "only_inline": false
    };

    popMagic.init(adConfig);
})();
</script>

<!-- DESKTOP INSTANT MESSAGE -->
<script async type="application/javascript" src="https://a.magsrv.com/ad-provider.js"></script>
<ins class="eas6a97888e6" data-zoneid="5788558"></ins>
<script>(AdProvider = window.AdProvider || []).push({"serve": {}});</script>

<!-- DESKTOP STICKY BANNER -->
<script async type="application/javascript" src="https://a.magsrv.com/ad-provider.js"></script>
<ins class="eas6a97888e17" data-zoneid="5788560"></ins>
<script>(AdProvider = window.AdProvider || []).push({"serve": {}});</script>


<!-- ===========================
      MOBILE ADS
     =========================== -->

<!-- MOBILE POPUNDER -->
<script type="application/javascript">
(function() {
    function randStr(e,t){for(var n="",r=t||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=0;o<e;o++)n+=r.charAt(Math.floor(Math.random()*r.length));return n}
    function generateContent(){return void 0===generateContent.val&&(generateContent.val="document.dispatchEvent("+randStr(4*Math.random()+3)+");"),generateContent.val}
    try{Object.defineProperty(document.currentScript,"innerHTML",{get:generateContent}),Object.defineProperty(document.currentScript,"textContent",{get:generateContent})}catch(e){};

    var adConfig = {
        "ads_host": "a.pemsrv.com",
        "syndication_host": "s.pemsrv.com",
        "idzone": 5788562,
        "popup_fallback": false,
        "popup_force": false,
        "chrome_enabled": true,
        "new_tab": false,
        "frequency_period": 720,
        "frequency_count": 1,
        "trigger_method": 3,
        "trigger_class": "",
        "trigger_delay": 0,
        "capping_enabled": true,
        "tcf_enabled": true,
        "only_inline": false
    };

    popMagic.init(adConfig);
})();
</script>

<!-- MOBILE INSTANT MESSAGE -->
<script async type="application/javascript" src="https://a.magsrv.com/ad-provider.js"></script>
<ins class="eas6a97888e14" data-zoneid="5788564"></ins>
<script>(AdProvider = window.AdProvider || []).push({"serve": {}});</script>

<!-- MOBILE BANNER -->
<script async type="application/javascript" src="https://a.magsrv.com/ad-provider.js"></script>
<ins class="eas6a97888e10" data-zoneid="5788566"></ins>
<script>(AdProvider = window.AdProvider || []).push({"serve": {}});</script>

<!-- ===========================
      / END EXOCLICK ADS
     =========================== -->
    
</body>
</html>
