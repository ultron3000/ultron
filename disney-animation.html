<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Disney Animation Collection | Disney+</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    /* --- preserved your original styles (kept intact) --- */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #000000, #1a1a2e);
      min-height: 100vh;
      color: white;
    }
    .movie-card { transition: .25s; }
    .movie-card:hover { transform: translateY(-6px); }
    .disney-blue { background-color: #113CCF; }
    .disney-blue-text { color: #113CCF; }
    .hidden { display:none; }
    /* Loader + overlay styles used by modal (minimal, non-invasive) */
    .player-overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; }
    .loader { width:48px; height:48px; border-radius:50%; border:6px solid rgba(255,255,255,0.12); border-top-color:#113CCF; animation:spin 1s linear infinite; display:none; pointer-events:auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .player-controls-overlay {
  position: static;          /* ← key fix */
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  background: #0b0b0b;
  border-top: 1px solid rgba(255,255,255,0.08);
}
    .modal-content:hover .player-controls-overlay { opacity:1; }
    .pc-btn { background: rgba(17,60,207,0.9); color:#fff; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }
    .pc-btn.secondary { background: rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.06); }

  /* === SMART FULLSCREEN VIDEO FIX (NO CROPPING, NO GAPS WHEN POSSIBLE) === */
video:fullscreen,
video:-webkit-full-screen,
iframe:fullscreen,
iframe:-webkit-full-screen {
  width: 100vw !important;
  height: 100vh !important;
  max-width: 100vw !important;
  max-height: 100vh !important;

  object-fit: contain !important;
  background-color: black;
}

/* Only cover when video aspect is cinematic */
@media (min-aspect-ratio: 16/9) {
  video:fullscreen,
  video:-webkit-full-screen,
  iframe:fullscreen,
  iframe:-webkit-full-screen {
    object-fit: cover !important;
  }
}

  </style>
</head>
<body>

  <!-- UI kept exactly as before -->
  <div class="showcase-header">
    <header class="bg-gradient-to-b from-black to-transparent py-4 px-6">
      <div class="container mx-auto flex justify-between items-center">
        <div class="flex items-center space-x-2">
          <div class="w-10 h-10 rounded-full overflow-hidden flex items-center justify-center shine-effect">
  <img src="https://static-assets.bamgrid.com/product/disneyplus/images/logo.1a56f51c764022ee769c91d894d44326.svg" 
       alt="Disney+ Logo" class="w-full h-full object-contain">
</div>

        </div>
        <nav class="hidden md:flex space-x-6">
          <a href="#" class="hover:disney-blue-text transition">Home</a>
          <a href="#" class="hover:disney-blue-text transition">Movies</a>
          <a href="#" class="hover:disney-blue-text transition">Characters</a>
          <a href="#" class="hover:disney-blue-text transition">Shorts</a>
        </nav>
        <button class="md:hidden text-2xl disney-blue-text">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </header>

    <div class="container mx-auto px-4 flex-1 flex items-center">
      <div class="max-w-4xl">
        <h1 class="text-5xl md:text-6xl font-bold mb-4 gradient-text">Disney Animation Collection</h1>
        <div class="flex items-center space-x-4 mb-6">
          <span class="disney-blue text-white px-3 py-1 rounded-full text-sm font-semibold">Featured</span>
          <span class="text-gray-400">1990-2024</span>
          <span class="text-gray-400">•</span>
          <span class="text-gray-400">40+ Movies & Shorts</span>
        </div>
        <p class="text-lg text-gray-300 mb-6">
          Enjoy all your favorite Disney animated movies in one place. From classic fairy tales to modern adventures, 
          experience the magic of Disney's animated universe.
        </p>
      </div>
    </div>
  </div>

  <main class="container mx-auto px-4 pb-16">
    <!-- Featured -->
    <section class="mb-12">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold flex items-center">
          <span class="mr-2 disney-blue-text">Featured</span>
          <i class="fas fa-star disney-blue-text"></i>
        </h2>
        <a href="#" class="text-sm disney-blue-text hover:underline">View All</a>
      </div>
      <div class="relative">
        <div class="scroll-container overflow-x-auto pb-4 flex space-x-6" id="featured-row">
          <!-- featured cards injected by JS -->
        </div>
      </div>
    </section>

    <!-- Main grid -->
    <div
  id="main-grid"
  class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-5"
>
      <!-- movie cards injected by JS -->
    </div>
  </main>

  <!-- Modal markup (kept same) -->
  <div id="playback-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-enter">
    <div class="max-w-4xl w-full mx-4 bg-gray-900 rounded-xl overflow-hidden shadow-2xl">
      <div class="flex items-start justify-between p-4 border-b border-gray-800">
        <div>
          <h3 id="modal-title" class="text-2xl font-bold"></h3>
          <div class="text-gray-400 text-sm">
            <span id="movie-year"></span> • <span id="movie-duration"></span> • <span class="disney-blue-text">★ <span id="movie-rating"></span>/10</span>
          </div>
        </div>
        <div class="flex space-x-3">
          <button id="modal-share" class="text-gray-400 hover:text-white transition">
            <i class="fas fa-share-alt"></i>
          </button>
          <button id="close-modal" class="text-white bg-gray-800 hover:bg-gray-700 px-3 py-2 rounded transition">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <div class="modal-content relative bg-black">
        <!-- Player area (we will inject <video> or <iframe> here dynamically) -->
        <div id="modal-player-area" style="position:relative;padding-top:56.25%;height:0;">
  <video id="modal-video" class="absolute top-0 left-0 w-full h-full" controls playsinline></video>

  <div class="player-overlay">
    <div id="player-loader" class="loader" aria-hidden="true" style="display:none"></div>
  </div>
</div>

<!-- ✅ CONTROLS NOW LIVE BELOW THE PLAYER -->
<div class="player-controls-overlay">
  <div class="left-controls">
    <button id="pc-prev" class="pc-btn secondary"><i class="fas fa-step-backward"></i></button>
    <button id="pc-playpause" class="pc-btn"><i class="fas fa-play"></i></button>
    <button id="pc-next" class="pc-btn secondary"><i class="fas fa-step-forward"></i></button>
  </div>
  <div class="right-controls">
    <button id="pc-mute" class="pc-btn secondary"><i class="fas fa-volume-up"></i></button>
    <button id="pc-full" class="pc-btn secondary"><i class="fas fa-expand"></i></button>
  </div>
</div>

        <div class="p-4">
          <p id="modal-description" class="text-gray-300 mb-6"></p>
          <div class="flex space-x-4">
            <button id="play-button-in-modal" class="disney-blue hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-full flex items-center transition transform hover:scale-105">
              <i class="fas fa-play mr-2"></i> Play
            </button>
            <button id="watchlist-btn" class="bg-gray-800 hover:bg-gray-700 text-white font-semibold py-3 px-8 rounded-full flex items-center transition">
              <i class="fas fa-plus mr-2"></i> Watchlist
            </button>
            <button id="like-btn" class="bg-gray-800 hover:bg-gray-700 text-white font-semibold py-3 px-4 rounded-full transition">
              <i class="fas fa-thumbs-up"></i>
            </button>
          </div>

          <div class="mt-6 pt-6 border-t border-gray-800">
            <h4 class="text-sm font-semibold text-gray-400 mb-2">Details</h4>
            <p class="text-gray-300 text-sm"><span id="movie-genre"></span> • <span id="movie-director"></span></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-gray-900 py-12">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-6 md:mb-0">
          <div class="flex items-center space-x-2 mb-4">
            <div class="w-10 h-10 disney-blue rounded-full flex items-center justify-center">
              <i class="fas fa-play text-white"></i>
            </div>
            <div>
              <h5 class="text-white font-semibold">Disney Animation</h5>
              <p class="text-gray-400 text-sm">All your favorites in one place</p>
            </div>
          </div>
        </div>
        <div>
          <p class="text-gray-500 text-sm">© Disney. This is a fan collection demo.</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- HLS.js for .m3u8 playback -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.1/dist/hls.min.js"></script>

  <script>
  /************************************************
   * Player integration (Hawkeye/Tukaram behavior)
   * - Keeps your UI 100% intact
   * - Binds cards to open modal and play MP4/HLS/iframe/YouTube
   * - Shows loader, provides overlay controls (prev/play/next/mute/full)
   ************************************************/

  // --- placeholder movies array (skip heavy data per request) ---
  const movies = [
    /* Replace this placeholder with your real array */
    { 
        title: "Wreck-It Ralph", 
        video: "https://sri.glintoriahealth.sbs:443/v4/is9/p91ry/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/zWoIgZ7mgmPkaZjG0102BSKFIqQ.jpg",
        year: 2012,
        duration: "101 min",
        rating: 4.5,
        genre: "Animation, Adventure",
        director: "Rich Moore",
        description: "A video game villain wants to be a hero and sets out to fulfill his dream, but his quest brings havoc to the whole arcade where he lives."
      },
      { 
        title: "Ralph Breaks the Internet", 
        video: "https://p.10014.workers.dev:443/dewshine74.xyz/file2/YVYrQCzuZa+hU6Mm585RNtdHwrOhXim2pR3UFNRIvUL5mh6+wwUrQIC+Xs6k3h28IVzAsm13o0lzsulfC8P9wPGJKnc51NeFuXA9ra8tqp8UTTND2CcCmAnqeBXsRprlEUN+7v2dAqXN~9gjp9AcsiHnsT491rb+qcvVCz2kbOM=/MTA4MA==/aW5kZXgubTN1OA==.m3u8", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/iVCrhBcpDaHGvv7CLYbK6PuXZo1.jpg",
        year: 2018,
        duration: "112 min",
        rating: 4.6,
        genre: "Animation, Adventure",
        director: "Rich Moore, Phil Johnston",
        description: "Six years after the events of Wreck-It Ralph, Ralph and Vanellope, now friends, discover a wi-fi router in their arcade, leading them into a new adventure."
      },
      { 
        title: "Strange World", 
        video: "https://sy6.marineroadcreativeworks.cyou:443/v4/is3/rqy18/index-f1-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/jXGMJUq9zcrScs02qkQuCtmWwaI.jpg",
        year: 2022,
        duration: "102 min",
        rating: 4.2,
        genre: "Animation, Adventure",
        director: "Don Hall, Qui Nguyen",
        description: "The legendary Clades are a family of explorers whose differences threaten to topple their latest and most crucial mission."
      },
      { 
        title: "Big Hero 6", 
        video: "https://s39.oakfieldproductionstudio.sbs:443/v4/vz/6kgzw/index-f1-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/2mxS4wUimwlLmI1xp6QW6NSU361.jpg",
        year: 2014,
        duration: "102 min",
        rating: 4.7,
        genre: "Animation, Action",
        director: "Don Hall, Chris Williams",
        description: "The special bond that develops between plus-sized inflatable robot Baymax and prodigy Hiro Hamada, who team up with a group of friends to form a band of high-tech heroes."
      },
      { 
        title: "Zootopia", 
        video: "https://s39.moriartis.store:443/v4/rw/bh9xu/index-f1-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/hlK0e0wAQ3VLuJcsfIYPvb4JVud.jpg",
        year: 2016,
        duration: "108 min",
        rating: 4.9,
        genre: "Animation, Comedy",
        director: "Byron Howard, Rich Moore",
        description: "In a city of anthropomorphic animals, a rookie bunny cop and a cynical con artist fox must work together to uncover a conspiracy."
      },
      { 
        title: "Zootopia 2", 
        video: "https://sau.ascentivehub.shop:443/v4/urp/dbrfbl/index-f2-v1-a1.txt", 
        image: "https://f.woowoowoowoo.net/resize/250x400/81/8a/818a11c04a0530dea9b4d811d330b7a6/818a11c04a0530dea9b4d811d330b7a6.jpg",
        year: 2025,
        duration: "110 min",
        rating: 7.9,
        genre: "Animation, Comedy",
        director: "Byron Howard, Jared Bush",
        description: "Brave rabbit cop Judy Hopps and her friend, the fox Nick Wilde, team up again to crack a new case, the most perilous and intricate of their careers."
      },
      { 
        title: "Hopp on Board", 
        video: "https://spuc.virelodesignagency.cyou/v4/db/ktyct/index-f1-v1-a1.txt", 
        image: "https://resizing.flixster.com/cV8P_W2QnmAe_kUJWZ5aLGa-wWM=/fit-in/705x460/v2/https://resizing.flixster.com/-XZAfHZM39UwaGJIFWKAE8fS0ak=/v3/t/assets/p22973425_e_v9_aa.jpg",
        year: 2022,
        duration: "10 min",
        rating: 7.2,
        genre: "Animation, Short",
        director: "Byron Howard, Rich Moore",
        description: "After saying goodbye to their daughter, one of Bonnie and Stu's kids sneaks aboard the Zootopia train, so they chase after it."
      },
      { 
        title: "The Real Rodents of Little Rodentia", 
        video: "https://sj3l.silverlark.sbs/v4/db/3xpyg/index-f1-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/M/MV5BNWQyMmNlYWMtMGI1NS00MjIwLTgxMGItZmFiNzI5MjU2OGM4XkEyXkFqcGc@._V1_.jpg",
        year: 2022,
        duration: "10 min",
        rating: 7.2,
        genre: "Animation, Short",
        director: "Byron Howard, Rich Moore",
        description: "Bride-to-be Fru Fru battles her cousin-turned-Shrew of Honor, Tru Tru, for the spotlight."
      },
      { 
        title: "Duke the Musical", 
        video: "https://queenselti.me/stream_66c599d1cbdb6/uwu.m3u8", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/original/ydFPHiFLZdleAUlEohANYSwneia.jpg",
        year: 2022,
        duration: "10 min",
        rating: 7.2,
        genre: "Animation, Short",
        director: "Byron Howard, Rich Moore",
        description: "After getting apprehended, Duke Weaselton ponders his life choices, through song."
      },
      { 
        title: "The Godfather of the Bride", 
        video: "https://sskt.greenleafhospitality.space/v4/db/dam5y/index-f1-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/original/lni7qNWyCOR5NmrceRxkUxsnxaJ.jpg",
        year: 2022,
        duration: "10 min",
        rating: 7.2,
        genre: "Animation, Short",
        director: "Byron Howard, Rich Moore",
        description: "At his daughter's wedding, Mr. Big flashes back to his humble beginnings."
      },
      { 
        title: "So You Think You Can Prance", 
        video: "https://sh9f.newterrafoods.store/v4/db/xk8lj/index-f1-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/M/MV5BMDFlY2M0ODItMzYzNC00ZGM2LWFjMzUtZWU0M2NlMmFlMTFlXkEyXkFqcGc@._V1_.jpg",
        year: 2022,
        duration: "10 min",
        rating: 7.2,
        genre: "Animation, Short",
        director: "Byron Howard, Rich Moore",
        description: "Clawhauser attempts to audition for Gazelle's newest reality competition series."
      },
      { 
        title: "Dinner Rush", 
        video: "https://sskt.lumintrixagency.shop/v4/db/ovxtb/index-f1-v1-a1.txt", 
        image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRGF2v1eQ3r-QgL32-kRPo2WNRZyq25zBH4Og&s",
        year: 2022,
        duration: "10 min",
        rating: 7.2,
        genre: "Animation, Short",
        director: "Byron Howard, Rich Moore",
        description: "Flash and Priscilla take it slow - very slow - on their first date."
      },
      { 
        title: "Tangled", 
        video: "https://snq.harborlightdesignlab.cfd:443/v4/6s/arl9b/index-f1-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/ym7Kst6a4uodryxqbGOxmewF235.jpg",
        year: 2010,
        duration: "100 min",
        rating: 7.7,
        genre: "Family, Musical",
        director: "Byron Howard, Nathan Greno",
        description: "The magically long-haired Rapunzel has spent her entire life in a tower, but now that a runaway thief has stumbled upon her, she is about to discover the world for the first time, and who she really is."
      },
      { 
        title: "Tangled Ever After", 
        video: "https://sh9f.lunetrix.store:443/v4/sc/5iduf/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/ak5SCuJbdf8G4NbQ1KIUHjplrF1.jpg",
        year: 2012,
        duration: "6 min",
        rating: 4.3,
        genre: "Animation, Short",
        director: "Nathan Greno, Byron Howard",
        description: "Pascal and Maximus must retrieve Rapunzel and Flynn's lost wedding rings before the ceremony begins."
      },
      { 
        title: "Moana", 
        video: "https://vip.opstream11.com/20220314/1891_6e9e642c/index.m3u8", 
        image: "https://www.tallengestore.com/cdn/shop/products/MOANA-Poster2_8dbe0bb2-3f82-4372-abc0-545b041c5f1b.jpg?v=1568977049",
        year: 2016,
        duration: "107 min",
        rating: 4.7,
        genre: "Animation, Adventure",
        director: "Ron Clements, John Musker",
        description: "In Ancient Polynesia, when a terrible curse incurred by the Demigod Maui reaches Moana's island, she answers the Ocean's call to seek out the Demigod to set things right."
      },
      { 
        title: "Moana 2", 
        video: "https://vip.opstream15.com:443/20241230/46549_6e65e501/3000k/hls/mixed.m3u8", 
        image: "https://i5.walmartimages.com/seo/Disney-Moana-2-Group-Wall-Poster-22-375-x-34_98129fc6-ae01-4e73-b287-59914346a60c.116a95fe575a9b03d5093814b33606ff.jpeg",
        year: 2024,
        duration: "110 min",
        rating: 4.8,
        genre: "Animation, Adventure",
        director: "David G. Derrick Jr.",
        description: "Moana returns in a new adventure that takes her beyond the reef on a dangerous journey to the far seas of Oceania."
      },
      { 
        title: "Encanto", 
        video: "https://vip.opstream14.com/20220320/1893_3dbee5bc/index.m3u8", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/4j0PNHkMr5ax3IA8tjtxcmPU3QT.jpg",
        year: 2021,
        duration: "102 min",
        rating: 4.6,
        genre: "Animation, Musical",
        director: "Jared Bush, Byron Howard",
        description: "A Colombian teenage girl has to face the frustration of being the only member of her family without magical powers."
      },
      { 
        title: "Raya and the Last Dragon", 
        video: "https://smeb.merridianhospitality.site:443/v4/ho/tbdjp/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/5nVhgCzxKbK47OLIKxCR1syulOn.jpg",
        year: 2021,
        duration: "107 min",
        rating: 4.5,
        genre: "Animation, Adventure",
        director: "Don Hall, Carlos López Estrada",
        description: "In a realm known as Kumandra, a re-imagined Earth inhabited by an ancient civilization, a warrior named Raya is determined to find the last dragon."
      },
      { 
        title: "Us Again", 
        video: "https://silu.rivercrestproduction.store:443/v4/il/m9qbj/index-f2-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/M/MV5BNGJkZWM2ZjgtZDMzZS00YzA3LWJiMjctY2I0MTIwZjQxYjEyXkEyXkFqcGc@._V1_.jpg",
        year: 2021,
        duration: "7 min",
        rating: 4.3,
        genre: "Animation, Short",
        director: "Zach Parrish",
        description: "A short film about an elderly man and his wife who magically become young again for one night."
      },
      { 
        title: "The Rescuers Down Under", 
        video: "https://smho.aetherflowbranding.online:443/v4/61/ijkp1/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/5koTDBmMAkJOgAe4PL4163UKjvG.jpg",
        year: 1990,
        duration: "77 min",
        rating: 4.0,
        genre: "Animation, Adventure",
        director: "Hendel Butoy, Mike Gabriel",
        description: "Bernard and Miss Bianca travel to the Australian outback to save a boy named Cody from a evil poacher."
      },
      { 
        title: "Planes", 
        video: "https://sxic.solenium.space:443/v4/ck/ijnoj/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/i2xgU0y0p77WTrB0oIkbpdaWq8R.jpg",
        year: 2013,
        duration: "91 min",
        rating: 3.9,
        genre: "Animation, Adventure",
        director: "Klay Hall",
        description: "Dusty is a cropdusting plane who dreams of competing in a famous aerial race. The problem? He's hopelessly afraid of heights."
      },
      { 
        title: "Planes: Fire & Rescue", 
        video: "https://s6sy.symphoniaevents.sbs:443/v4/us/jfuca/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/pOmteFeBDI9FJOPTDvYJYFeAtdp.jpg",
        year: 2014,
        duration: "83 min",
        rating: 5.9,
        genre: "Animation, Adventure",
        director: "Bobs Gannaway",
        description: "When Dusty learns that his engine is damaged and he may never race again, he joins a forest fire and rescue unit to be trained as a firefighter, or else his air strip will be shut down."
      },
      { 
        title: "Wish", 
        video: "https://spok.zafyrastudio.shop:443/v4/il/uqkww/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/m9ckCVKU9vW3Dxc8hbodx7mjJbe.jpg",
        year: 2023,
        duration: "95 min",
        rating: 4.1,
        genre: "Animation, Fantasy",
        director: "Chris Buck, Fawn Veerasunthorn",
        description: "A young girl named Asha possesses a magical ability to make wishes come true, but when she discovers a dark secret about the kingdom's ruler, she must fight to save her people."
      },
      { 
        title: "Frozen", 
        video: "https://scvo.zafyrastudio.shop:443/v4/61/gr5td/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/mbPrrbt8bSLcHSBCHnRclPlMZPl.jpg",
        year: 2013,
        duration: "102 min",
        rating: 4.8,
        genre: "Animation, Musical",
        director: "Chris Buck, Jennifer Lee",
        description: "When the newly crowned Queen Elsa accidentally uses her power to turn things into ice to curse her home in infinite winter, her sister Anna teams up with a mountain man, his playful reindeer, and a snowman to change the weather condition."
      },
      { 
        title: "Frozen II", 
        video: "https://sr81.glimmerpathfashion.cyou:443/v4/ox/bu9dr/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/mINJaa34MtknCYl5AjtNJzWj8cD.jpg",
        year: 2019,
        duration: "103 min",
        rating: 4.7,
        genre: "Animation, Adventure",
        director: "Chris Buck, Jennifer Lee",
        description: "Anna, Elsa, Kristoff, Olaf and Sven leave Arendelle to travel to an ancient, autumn-bound forest of an enchanted land. They set out to find the origin of Elsa's powers in order to save their kingdom."
      },
      { 
        title: "Frozen Fever", 
        video: "https://shkn.crimsonforestventures.online:443/v4/sc/in95x/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w780/mPrDJ7puYzPLG5kPM96iNszF2sM.jpg",
        year: 2015,
        duration: "7 min",
        rating: 4.3,
        genre: "Animation, Short",
        director: "Chris Buck, Jennifer Lee",
        description: "Elsa plans a birthday party for Anna, but she keeps sneezing and summoning little snowmen who wreak havoc on the party."
      },
      { 
        title: "Arendelle Castle Yule Log: Cut Paper Edition", 
        video: "https://sojg.mindcrest.store:443/v4/ck/owq61/index-f1-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/M/MV5BOGNmZDE4YmYtOTM0Ny00YWE1LTk1MTItZDUyMzJhOGQ1YWFlXkEyXkFqcGc@._V1_.jpg",
        year: 2020,
        duration: "60 min",
        rating: 4.0,
        genre: "Animation, Special",
        director: "Disney Animation",
        description: "A cozy yule log video featuring the Frozen characters in a beautiful cut-paper style animation."
      },
      { 
        title: "Once Upon a Snowman", 
        video: "https://sqtd.nuvistar.online/v4/61/oa1iq/index-f1-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/hddzYJtfYYeMDOQVcH58n8m1W3A.jpg",
        year: 2020,
        duration: "8 min",
        rating: 4.2,
        genre: "Animation, Short",
        director: "Dan Abraham, Trent Correy",
        description: "The story of how Olaf the snowman came to life and found his nose in this short film set during the events of Frozen."
      },
      { 
        title: "Beauty and the Beast", 
        video: "https://spok.stellarifyventures.sbs:443/v4/np/5iwil/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w500/hUJ0UvQ5tgE2Z9WpfuduVSdiCiU.jpg",
        year: 1991,
        duration: "84 min",
        rating: 4.9,
        genre: "Animation, Musical",
        director: "Gary Trousdale, Kirk Wise",
        description: "A prince cursed to spend his days as a hideous monster sets out to regain his humanity by earning a young woman's love."
      },
      { 
        title: "Beauty and the Beast", 
        video: "https://sh9f.zenithwellbeing.site:443/v4/qu/h5818/index-f1-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w780/hKegSKIDep2ewJWPUQD7u0KqFIp.jpg",
        year: 2017,
        duration: "90 min",
        rating: 4.9,
        genre: "Animation, Musical",
        director: "Bill Condon",
        description: "A live-action adaptation of Disney's version of the classic tale of a cursed prince and a beautiful young woman who helps him break the spell."
      },
      { 
        title: "The Lion King", 
        video: "https://slob.greenhavenconsult.sbs/v4/ck/gda5u/index-f1-v1-a1.txt", 
        image: "https://image.tmdb.org/t/p/original/dzBtMocZuJbjLOXvrl4zGYigDzh.jpg",
        year: 2019,
        duration: "118 min",
        rating: 6.8,
        genre: "Animation, Musical",
        director: "Jon Favreau",
        description: "After the murder of his father, a young lion prince flees his kingdom only to learn the true meaning of responsibility and bravery."
      },
      { 
        title: "Mufasa: The Lion King", 
        video: "https://vip.opstream15.com:443/20250105/47015_264fd669/3000k/hls/mixed.m3u8", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w780/lurEK87kukWNaHd0zYnsi3yzJrs.jpg",
        year: 2023,
        duration: "98 min",
        rating: 4.5,
        genre: "Animation, Adventure",
        director: "Barry Jenkins",
        description: "This prequel to The Lion King follows Mufasa's rise from orphaned cub to legendary king of the Pride Lands."
      },
      { 
        title: "The Lion King", 
        video: "https://s8v3.auralithagency.online/v4/qu/inwif/index-f1-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w780/sKCr78MXSLixwmZ8DyJLrpMsd15.jpg",
        year: 1994,
        duration: "98 min",
        rating: 4.5,
        genre: "Animation, Adventure",
        director: "Roger Allers, Rob Minkoff",
        description: "Young lion prince Simba, eager to one day become king of the Pride Lands, grows up under the watchful eye of his father Mufasa; all the while his villainous uncle Scar conspires to take the throne for himself. Amid betrayal and tragedy, Simba must confront his past and find his rightful place in the Circle of Life."
      },
      { 
        title: "The Lion King II: Simba's Pride", 
        video: "https://sdqm.neoventis.sbs:443/v4/ic/56zq3/index-f1-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w780/sWR1x6UCMCGN9xEf8RGhPS934X0.jpg",
        year: 2023,
        duration: "98 min",
        rating: 4.5,
        genre: "Animation, Adventure",
        director: "Darrell Rooney",
        description: "The circle of life continues for Simba, now fully grown and in his rightful place as the king of Pride Rock. Simba and Nala have given birth to a daughter, Kiara who's as rebellious as her father was. But Kiara drives her parents to distraction when she catches the eye of Kovu, the son of the evil lioness, Zira. Will Kovu steal Kiara's heart?"
      },
      { 
        title: "Paperman", 
        video: "https://sbi6.zenithstrategylabs.online:443/v4/xq/p3bfj/index-f1-v1-a1.txt", 
        image: "https://i.pinimg.com/736x/a3/f5/00/a3f500c5016afd52c1ef24f875d7f581.jpg",
        year: 2012,
        duration: "7 min",
        rating: 4.6,
        genre: "Animation, Short",
        director: "John Kahrs",
        description: "An office worker uses paper airplanes to meet the girl of his dreams in this black-and-white animated short."
      },
      { 
        title: "Get a Horse!", 
        video: "https://s6sy.inovara.cyou:443/v4/pq/pem8b/index-f2-v1-a1.txt",
        image: "https://www.rotoscopers.com/wp-content/uploads/2013/06/disney-mickey-mouse-get-a-horse-poster.jpg",
        year: 2013,
        duration: "6 min",
        rating: 4.3,
        genre: "Animation, Short",
        director: "Lauren MacMullan",
        description: "Mickey Mouse and his friends go on a wild ride when Peg-Leg Pete tries to run them off the road."
      },
      { 
        title: "Feast", 
        video: "https://spuc.riverstoneart.space:443/v4/9a/pebv1/index-f2-v1-a1.txt",
        image: "https://i.pinimg.com/736x/a6/51/38/a651381d63987ff86b97f3e08cb45c43.jpg",
        year: 2014,
        duration: "6 min",
        rating: 4.5,
        genre: "Animation, Short",
        director: "Patrick Osborne",
        description: "The story of one man's love life as seen through the eyes of his best friend and dog, Winston."
      },
      { 
        title: "Pocahontas", 
        video: "https://se9d.blueridgecreatives.store:443/v4/qu/pczyb/index-f2-v1-a1.txt", 
        image: "https://i.ebayimg.com/images/g/GFIAAOSw-W5UsX1u/s-l1200.jpg",
        year: 1995,
        duration: "81 min",
        rating: 4.3,
        genre: "Animation, Musical",
        director: "Mike Gabriel, Eric Goldberg",
        description: "An American Indian woman is supposed to marry the village's best warrior, but she yearns for something more—and soon meets Capt. John Smith."
      },
      { 
        title: "Far From the Tree", 
        video: "https://sskt.carvoniaconsultancy.sbs:443/v4/6s/6kc6j/index-f1-v1-a1.txt", 
        image: "https://upload.wikimedia.org/wikipedia/en/f/fe/Far_From_the_Tree_%28film%29.jpg",
        year: 2021,
        duration: "7 min",
        rating: 4.4,
        genre: "Animation, Short",
        director: "Natalie Nourigat",
        description: "A young raccoon learns the meaning of caution from his protective parent in this heartwarming short."
      },
      { 
        title: "Inner Workings", 
        video: "https://sxic.moonstreamspace.space/v4/pq/6uo9k/index-f1-v1-a1.txt", 
        image: "https://static.tvtropes.org/pmwiki/pub/images/innerworkingsip1.jpg",
        year: 2016,
        duration: "6 min",
        rating: 4.2,
        genre: "Animation, Short",
        director: "Leonardo Matsuda",
        description: "The internal organs of a man named Paul go to war with his brain as he tries to balance work and play."
      },
      { 
        title: "Hercules", 
        video: "https://smeb.nevalonmedia.cyou:443/v4/sc/hqj1n/index-f2-v1-a1.txt", 
        image: "https://i.ebayimg.com/images/g/C~0AAOSwQ-RiZzOc/s-l1200.jpg",
        year: 1997,
        duration: "93 min",
        rating: 4.5,
        genre: "Animation, Musical",
        director: "Ron Clements, John Musker",
        description: "The son of the Greek Gods Zeus and Hera is stripped of his immortality as an infant and must become a true hero to reclaim it."
      },
      { 
        title: "Bolt", 
        video: "https://sqtd.prismaticaeventworks.cfd:443/v4/hz/itpks/index-f2-v1-a1.txt", 
        image: "https://i.pinimg.com/736x/9d/c2/be/9dc2befdb05b1f43edc7b0147233f48b.jpg",
        year: 2008,
        duration: "96 min",
        rating: 4.3,
        genre: "Animation, Adventure",
        director: "Byron Howard, Chris Williams",
        description: "The canine star of a fictional sci-fi/action show believes his powers are real. When he's accidentally shipped to New York, he begins a cross-country journey to reunite with his owner."
      },
      { 
        title: "Super Rhino", 
        video: "https://sbi6.hyvera.sbs:443/v4/sc/dymzs/index-f1-v1-a1.txt", 
        image: "https://resizing.flixster.com/-XZAfHZM39UwaGJIFWKAE8fS0ak=/v3/t/assets/p10185029_p_v8_aa.jpg",
        year: 2009,
        duration: "4 min",
        rating: 4.0,
        genre: "Animation, Short",
        director: "Nathan Greno",
        description: "Rhino the hamster imagines himself as a superhero in this short film featuring characters from Bolt."
      },
      { 
        title: "Mulan", 
        video: "https://s9dz.northfieldinnovation.store:443/v4/36/qyvfz/index-f2-v1-a1.txt", 
        image: "https://images.squarespace-cdn.com/content/v1/5cc8bc4f93a632622cd1616d/1612211900174-F2ZE27GB2I0BKWRZGKA5/mulan.jpg?format=2500w",
        year: 1998,
        duration: "88 min",
        rating: 4.7,
        genre: "Animation, Adventure",
        director: "Tony Bancroft, Barry Cook",
        description: "To save her father from death in the army, a young maiden secretly goes in his place and becomes one of China's greatest heroines in the process."
      },
      { 
        title: "Tarzan", 
        video: "https://sdqm.skylineforge.space/v4/9a/5g3dt/index-f1-v1-a1.txt", 
        image: "https://i.pinimg.com/736x/a6/64/76/a6647653258d7e614f438765d0c4ef79.jpg",
        year: 1999,
        duration: "88 min",
        rating: 4.5,
        genre: "Animation, Adventure",
        director: "Chris Buck, Kevin Lima",
        description: "A man raised by gorillas must decide where he really belongs when he discovers he's a human."
      },
      { 
        title: "The Little Mermaid II: Return to the Sea", 
        video: "https://smeb.mountainstreamlab.space:443/v4/db/qfu5x/index-f2-v1-a1.txt", 
        image: "https://image.tmdb.org/t/p/original/iKc78Lh0mgaz6hAN0atfCXlYR0i.jpg",
        year: 2000,
        duration: "75 min",
        rating: 3.9,
        genre: "Animation, Adventure",
        director: "Jim Kammerud",
        description: "Ariel's daughter, Melody, longs to be part of the underwater world, but when she's tricked by Ursula's sister, Morgana, Ariel and her family must save her."
      },
      { 
        title: "The Little Mermaid", 
        video: "https://spok.stellarforgeinnovation.online/v4/np/hlkw39/index-f2-v1-a1.txt", 
        image: "https://image.tmdb.org/t/p/w500/ym1dxyOk4jFcSl4Q2zmRrA5BEEN.jpg",
        year: 2023,
        duration: "98 min",
        rating: 7.2,
        genre: "Animation, Adventure",
        director: "Jim Kammerud",
        description: "The youngest of King Triton’s daughters, and the most defiant, Ariel longs to find out more about the world beyond the sea, and while visiting the surface, falls for the dashing Prince Eric. With mermaids forbidden to interact with humans, Ariel makes a deal with the evil sea witch, Ursula, which gives her a chance to experience life on land, but ultimately places her life – and her father’s crown – in jeopardy."
      },
      { 
        title: "Dinosaur", 
        video: "https://smeb.carvoniaconsultancy.sbs/v4/sc/xkzdw/index-f1-v1-a1.txt", 
        image: "https://i.ebayimg.com/images/g/nv8AAOSwGYZnbuaY/s-l1200.jpg",
        year: 2000,
        duration: "82 min",
        rating: 3.8,
        genre: "Animation, Adventure",
        director: "Ralph Zondag, Eric Leighton",
        description: "An orphaned dinosaur raised by lemurs joins an arduous trek to a sancturary after a meteorite shower destroys his family home."
      },
      { 
        title: "The Emperor's New Groove", 
        video: "https://sskt.symphoniaevents.sbs:443/v4/sc/muwxa/index-f1-v1-a1.txt", 
        image: "https://live.staticflickr.com/65535/53420121153_dacca34553_b.jpg",
        year: 2000,
        duration: "78 min",
        rating: 4.6,
        genre: "Animation, Comedy",
        director: "Mark Dindal",
        description: "Emperor Kuzco is turned into a llama by his ex-administrator Yzma, and must now regain his throne with the help of Pacha, the gentle llama herder."
      },
      { 
        title: "Atlantis: The Lost Empire", 
        video: "https://sxic.halcyonfinancialgroup.online/v4/36/cl1gi/index-f1-v1-a1.txt", 
        image: "https://xl.movieposterdb.com/23_11/2001/230011/xl_atlantis-the-lost-empire-movie-poster_a80be3bf.jpg",
        year: 2001,
        duration: "95 min",
        rating: 4.2,
        genre: "Animation, Adventure",
        director: "Gary Trousdale, Kirk Wise",
        description: "A young linguist joins an intrepid group of explorers to find the mysterious lost continent of Atlantis."
      },
      { 
        title: "Lilo & Stitch", 
        video: "https://se9d.valentrixlearninghub.online:443/v4/m9/rv6tc/index-f1-v1-a1.txt", 
        image: "https://i.pinimg.com/736x/e9/82/6e/e9826eab7e5176063120ac72593c2930.jpg",
        year: 2002,
        duration: "85 min",
        rating: 4.6,
        genre: "Animation, Comedy",
        director: "Dean DeBlois, Chris Sanders",
        description: "A young Hawaiian girl befriends a dog-like alien who is actually an illegal genetic experiment hiding from intergalactic authorities."
      },
      { 
        title: "Lilo & Stitch 2: Stitch Has a Glitch", 
        video: "https://sojg.valentrixcreations.space:443/v4/js/ufesv/index-f2-v1-a1.txt", 
        image: "https://artworks.thetvdb.com/banners/v4/movie/2056/posters/651179b68b38a.jpg",
        year: 2005,
        duration: "68 min",
        rating: 6.2,
        genre: "Animation, Comedy",
        director: "Tony Leondis, Michael LaBash",
        description: "As Stitch helps his friend to prepare for the annual Hula festival, things go haywire. Now, it is up to Stitch and his friends to get things organised."
      },
      { 
        title: "Lilo & Stitch", 
        video: "https://scvo.skylineforge.space:443/v4/ho/pk6xee/index-f1-v1-a1.txt", 
        image: "https://i.ebayimg.com/00/s/MTYwMFgxMDc5/z/YmMAAOSw~nNnSeST/$_57.JPG?set_id=880000500F",
        year: 2025,
        duration: "108 min",
        rating: 7.0,
        genre: "Animation, Comedy",
        director: "Dean Fleischer Camp",
        description: "A lonely Hawaiian girl befriends a runaway alien, helping to mend her fragmented family."
      },
      { 
        title: "Treasure Planet", 
        video: "https://sbi6.luminarygroupdigital.online:443/v4/ty/3ykyf/index-f1-v1-a1.txt", 
        image: "https://i.pinimg.com/564x/7f/47/66/7f4766f3004f020ed246ea23f45579f4.jpg",
        year: 2002,
        duration: "95 min",
        rating: 4.3,
        genre: "Animation, Adventure",
        director: "Ron Clements, John Musker",
        description: "A Disney version of Robert Louis Stevenson's Treasure Island, with a sci-fi twist."
      },
      { 
        title: "Destino", 
        video: "https://spuc.aurorafieldenergy.sbs:443/v4/sc/qj66l/index-f1-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/M/MV5BZTYwZDdiZmItMTRlMS00NzkzLThlNWUtMjNhMzk0MjM0YWI0XkEyXkFqcGc@._V1_QL75_UX190_CR0,2,190,281_.jpg",
        year: 2003,
        duration: "7 min",
        rating: 4.4,
        genre: "Animation, Short",
        director: "Dominique Monféry",
        description: "A collaboration between Walt Disney and Salvador Dalí that was begun in 1945 and finally completed in 2003."
      },
      { 
        title: "Brother Bear", 
        video: "https://slob.bluehavenhospitality.sbs/v4/rw/xl9w3/index-f1-v1-a1.txt", 
        image: "https://i.ebayimg.com/images/g/0jkAAOSw7X1mYXPu/s-l1200.jpg",
        year: 2003,
        duration: "85 min",
        rating: 4.2,
        genre: "Animation, Adventure",
        director: "Aaron Blaise, Robert Walker",
        description: "When a young Inuit hunter kills a bear for revenge, he is magically changed into a bear himself."
      },
      { 
        title: "Brother Bear 2", 
        video: "https://sojg.aurorapathcreative.space:443/v4/lf/payhb/index-f2-v1-a1.txt", 
        image: "https://wsrv.nl/?url=https://image.tmdb.org/t/p/w780/yaA8q2zHHUgFWdJNxXyAdU71SzM.jpg",
        year: 2006,
        duration: "85 min",
        rating: 4.2,
        genre: "Animation, Adventure",
        director: "Aaron Blaise, Robert Walker",
        description: "Kenai finds his childhood human friend Nita and the two embark on a journey to burn the amulet he gave to her before he was a bear, much to Koda's dismay.."
      },
      { 
        title: "Chicken Little", 
        video: "00", 
        image: "https://m.media-amazon.com/images/I/415S91KQW9L._AC_UF1000,1000_QL80_.jpg",
        year: 2005,
        duration: "81 min",
        rating: 3.7,
        genre: "Animation, Comedy",
        director: "Mark Dindal",
        description: "After ruining his reputation with the town, a courageous chicken must come to the rescue of his fellow citizens when aliens start an invasion."
      },
      { 
        title: "Meet the Robinsons", 
        video: "00", 
        image: "https://images.justwatch.com/poster/300765687/s718/meet-the-robinsons.jpg",
        year: 2007,
        duration: "95 min",
        rating: 4.1,
        genre: "Animation, Adventure",
        director: "Stephen Anderson",
        description: "Lewis is a brilliant inventor who meets mysterious stranger named Wilbur Robinson, whisking Lewis away in a time machine to the future."
      },
      { 
        title: "The Princess and the Frog", 
        video: "00", 
        image: "https://imgc.allpostersimages.com/img/posters/trends-international-disney-the-princess-and-the-frog-one-sheet_u-L-Q1RG0FE0.jpg",
        year: 2009,
        duration: "97 min",
        rating: 4.5,
        genre: "Animation, Musical",
        director: "Ron Clements, John Musker",
        description: "A waitress, desperate to fulfill her dreams as a restaurant owner, is set on a journey to turn a frog prince back into a human being, but she has to face the same problem after she kisses him."
      },
      { 
        title: "Tick Tock Tale", 
        video: "00", 
        image: "https://m.media-amazon.com/images/M/MV5BMTQ5MDA1MDA0MF5BMl5BanBnXkFtZTgwNDYzODA2NjE@._V1_.jpg",
        year: 2010,
        duration: "6 min",
        rating: 4.1,
        genre: "Animation, Short",
        director: "Dean Wellins",
        description: "A cuckoo clock bird must save the day when the clock tower's mechanism breaks down."
      },
      { 
        title: "Winnie the Pooh", 
        video: "00", 
        image: "https://cdn11.bigcommerce.com/s-nq6l4syi/images/stencil/1280x1280/products/70265/958026/129100-1024__60172.1697242172.jpg?c=2",
        year: 2011,
        duration: "63 min",
        rating: 4.3,
        genre: "Animation, Comedy",
        director: "Stephen Anderson, Don Hall",
        description: "Winnie the Pooh and friends go on a quest to save Christopher Robin from an imaginary culprit."
      },
      { 
        title: "Prep & Landing: Naughty vs. Nice", 
        video: "00", 
        image: "https://m.media-amazon.com/images/M/MV5BYzg3NTEwMWMtZTExZS00ZjdjLWJlOTUtMzNhMmZjMzcwOGMwXkEyXkFqcGc@._V1_FMjpg_UX1000_.jpg",
        year: 2011,
        duration: "22 min",
        rating: 4.2,
        genre: "Animation, Short",
        director: "Kevin Deters, Stevie Wermers",
        description: "The elite unit of Christmas elves known as Prep & Landing must thwart an attack on Santa's workshop."
      }
    ];

  // --- DOM refs (matching your markup)
  const featuredRow = document.getElementById('featured-row');
  const mainGrid = document.getElementById('main-grid');
  const playbackModal = document.getElementById('playback-modal');
  const modalPlayerArea = document.getElementById('modal-player-area');
  const modalTitle = document.getElementById('modal-title');
  const modalDescription = document.getElementById('modal-description');
  const movieYear = document.getElementById('movie-year');
  const movieDuration = document.getElementById('movie-duration');
  const movieRating = document.getElementById('movie-rating');
  const movieGenre = document.getElementById('movie-genre');
  const movieDirector = document.getElementById('movie-director');
  const closeModalBtn = document.getElementById('close-modal');

  // overlay control refs (rebinding done after injection)
  let pcPlayPause, pcPrev, pcNext, pcMute, pcFull, playerLoader;

  // playback state
  let currentHls = null;
  let currentFiltered = [];
  let currentIndex = null;

  // --- type detection helpers
  function isMP4(url) { return /\.mp4($|\?)/i.test((url||'')); }
  function isHls(url) {
    if (!url) return false;
    return url.includes('.m3u8') || url.includes('index-') || /index.*\.txt/i.test(url) || url.includes('manifest') || url.includes('master');
  }
  function isYouTube(url) {
    if (!url) return false;
    return url.includes('youtube.com') || url.includes('youtu.be') || url.includes('youtube-nocookie.com') || url.includes('/embed/');
  }

  // IMPORTANT FIX:
  // previous implementation redirected any "stream-like" url immediately.
  // That caused .m3u8 / HLS to be redirected instead of played inline.
  // We now ONLY redirect to player.html when the URL is truly unknown/unplayable:
  function shouldRedirectToPlayer(url) {
    if (!url) return true;
    const lc = url.toLowerCase();
    // If it's MP4, HLS, YouTube or known iframe host -> do NOT redirect
    if (isMP4(lc) || isHls(lc) || isYouTube(lc)) return false;
    if (lc.includes('streamtape.com') || lc.includes('dood') || lc.includes('vidcdn') || lc.includes('ok.ru') || lc.includes('mega.nz') || lc.includes('drive.google.com') || lc.includes('openload')) return false;
    // Otherwise: redirect (unknown/unsupported)
    return true;
  }

  // reset player area to fresh state (injects a <video> element + overlays)
  function resetPlayerArea() {
    if (currentHls) {
      try { currentHls.destroy(); } catch(e) {}
      currentHls = null;
    }
    modalPlayerArea.innerHTML = `
      <video id="modal-video" class="absolute top-0 left-0 w-full h-full" controls playsinline></video>
      <div class="player-overlay"><div id="player-loader" class="loader" style="display:none"></div></div>
      <div class="player-controls-overlay">
        <div class="left-controls">
          <button id="pc-prev" class="pc-btn secondary"><i class="fas fa-step-backward"></i></button>
          <button id="pc-playpause" class="pc-btn"><i class="fas fa-play"></i></button>
          <button id="pc-next" class="pc-btn secondary"><i class="fas fa-step-forward"></i></button>
        </div>
        <div class="right-controls">
          <button id="pc-mute" class="pc-btn secondary"><i class="fas fa-volume-up"></i></button>
          <button id="pc-full" class="pc-btn secondary"><i class="fas fa-expand"></i></button>
        </div>
      </div>
    `;
    // rebind overlay controls (they live in injected markup)
    bindOverlayControls();
  }

  // bind overlay control buttons to behavior
  function bindOverlayControls() {
    const v = document.getElementById('modal-video');
    playerLoader = document.getElementById('player-loader');

    pcPlayPause = document.getElementById('pc-playpause');
    pcPrev = document.getElementById('pc-prev');
    pcNext = document.getElementById('pc-next');
    pcMute = document.getElementById('pc-mute');
    pcFull = document.getElementById('pc-full');

    if (pcPlayPause) {
      pcPlayPause.onclick = () => {
        const vid = document.getElementById('modal-video');
        if (!vid) return;
        if (vid.paused) { vid.play().catch(()=>{}); pcPlayPause.innerHTML = '<i class="fas fa-pause"></i>'; }
        else { vid.pause(); pcPlayPause.innerHTML = '<i class="fas fa-play"></i>'; }
      };
    }
    if (pcPrev) pcPrev.onclick = playPrev;
    if (pcNext) pcNext.onclick = playNext;
    if (pcMute) {
      pcMute.onclick = () => {
        const vid = document.getElementById('modal-video');
        if (!vid) return;
        vid.muted = !vid.muted;
        pcMute.innerHTML = vid.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
      };
    }
    if (pcFull) {
      pcFull.onclick = () => {
        const el = document.getElementById('modal-video') || modalPlayerArea.querySelector('iframe');
        if (!el) return;
        if (!document.fullscreenElement) {
          (el.requestFullscreen || modalPlayerArea.requestFullscreen).call(el).catch(()=>{});
        } else {
          document.exitFullscreen();
        }
      };
    }

    // sync native video events to overlay UI
    document.addEventListener('play', (e) => {
      if (e.target && e.target.id === 'modal-video' && pcPlayPause) pcPlayPause.innerHTML = '<i class="fas fa-pause"></i>';
    }, true);
    document.addEventListener('pause', (e) => {
      if (e.target && e.target.id === 'modal-video' && pcPlayPause) pcPlayPause.innerHTML = '<i class="fas fa-play"></i>';
    }, true);
  }

  // core: opens modal and chooses playback engine (HLS, MP4, iframe, YouTube)
  function playInModal(list, index) {
    if (!Array.isArray(list) || list.length === 0 || index == null || index < 0 || index >= list.length) {
      console.warn('Invalid playback request'); return;
    }
    currentFiltered = list;
    currentIndex = index;
    const movie = list[index];

    // set metadata (UI preserved)
    modalTitle.textContent = movie.title || '';
    modalDescription.textContent = movie.description || '';
    movieYear.textContent = movie.year || '';
    movieDuration.textContent = movie.duration || '';
    movieRating.textContent = movie.rating || '';
    movieGenre.textContent = movie.genre || '';
    movieDirector.textContent = movie.director || '';

    // prepare player area and show loader
    resetPlayerArea();
    const loaderEl = document.getElementById('player-loader');
    if (loaderEl) loaderEl.style.display = 'block';

    playbackModal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';

    // choose src
    let src = '';
    if (typeof movie.video === 'object' && movie.video !== null) {
      src = movie.video.high || movie.video.medium || movie.video.low || Object.values(movie.video)[0];
    } else {
      src = movie.video;
    }
    if (!src) {
      console.warn('No video url — fallback to player.html');
      setTimeout(()=> window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=`, 500);
      return;
    }
    const lc = (src || '').toLowerCase();

    // iframe-hosted sites (embed)
    if (lc.includes('streamtape.com') || lc.includes('dood') || lc.includes('vidcdn') || lc.includes('ok.ru') || lc.includes('mega.nz') || lc.includes('drive.google.com') || lc.includes('openload')) {
      modalPlayerArea.innerHTML = `<iframe src="${src}" style="position:absolute;inset:0;width:100%;height:100%;border:0;" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
      const l2 = document.getElementById('player-loader'); if (l2) l2.style.display = 'none';
      bindOverlayControls(); // overlay still bound
      return;
    }

    // YouTube (convert to embed)
    if (isYouTube(src)) {
      let embed = src;
      try {
        if (src.includes('watch') && src.includes('v=')) {
          const v = new URLSearchParams(src.split('?')[1]).get('v');
          if (v) embed = `https://www.youtube.com/embed/${v}`;
        } else if (src.includes('youtu.be/')) {
          const p = src.split('youtu.be/')[1].split(/[?&]/)[0];
          if (p) embed = `https://www.youtube.com/embed/${p}`;
        }
      } catch (e) {}
      modalPlayerArea.innerHTML = `<iframe src="${embed}?autoplay=1&modestbranding=1&rel=0" style="position:absolute;inset:0;width:100%;height:100%;border:0;" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
      const l3 = document.getElementById('player-loader'); if (l3) l3.style.display = 'none';
      bindOverlayControls();
      return;
    }

    // HLS (.m3u8 / index.txt)
    if (isHls(src)) {
      const v = document.getElementById('modal-video');
      if (!v) { console.warn('Video element missing'); return; }
      if (window.Hls && Hls.isSupported()) {
        currentHls = new Hls();
        try {
          currentHls.loadSource(src);
          currentHls.attachMedia(v);
        } catch (e) { console.warn('HLS attach error', e); }
        currentHls.on(Hls.Events.MANIFEST_PARSED, function() {
          const l4 = document.getElementById('player-loader'); if (l4) l4.style.display = 'none';
          v.play().catch(()=>{});
        });
        currentHls.on(Hls.Events.ERROR, function(event, data) {
          console.warn('HLS error', data);
          if (data && data.fatal) {
            try { currentHls.destroy(); } catch(e){}
            currentHls = null;
            console.warn('HLS fatal — redirecting to player.html');
            setTimeout(()=> window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`, 700);
          }
        });
      } else if (v.canPlayType && v.canPlayType('application/vnd.apple.mpegurl')) {
        v.src = src;
        v.addEventListener('loadedmetadata', () => {
          const l5 = document.getElementById('player-loader'); if (l5) l5.style.display = 'none';
          v.play().catch(()=>{});
        }, { once: true });
      } else {
        console.warn('HLS not supported — redirecting');
        setTimeout(()=> window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`, 700);
      }
      bindOverlayControls();
      return;
    }

    // MP4 fallback
    if (isMP4(src)) {
      const v = document.getElementById('modal-video');
      if (!v) { window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`; return; }
      v.src = src;
      v.addEventListener('loadeddata', () => {
        const l6 = document.getElementById('player-loader'); if (l6) l6.style.display = 'none';
        v.play().catch(()=>{});
      }, { once: true });
      bindOverlayControls();
      return;
    }

    // unknown => fallback to player page
    window.location.href = `player.html?title=${encodeURIComponent(movie.title||'')}&video=${encodeURIComponent(src||'')}`;
  }

  // next / prev helpers
  function playNext() {
    if (!currentFiltered || currentFiltered.length === 0) currentFiltered = movies.slice();
    if (currentIndex == null) return console.warn('No current video');
    if (currentIndex < currentFiltered.length - 1) playInModal(currentFiltered, currentIndex + 1);
    else console.warn('No next video');
  }
  function playPrev() {
    if (!currentFiltered || currentFiltered.length === 0) currentFiltered = movies.slice();
    if (currentIndex == null) return console.warn('No current video');
    if (currentIndex > 0) playInModal(currentFiltered, currentIndex - 1);
    else console.warn('No previous video');
  }

  // close & cleanup
  function closeModalHandler() {
    if (currentHls) {
      try { currentHls.destroy(); } catch(e) {}
      currentHls = null;
    }
    const v = document.getElementById('modal-video');
    if (v) {
      try { v.pause(); } catch(e){}
      try { v.removeAttribute('src'); v.load(); } catch(e){}
    }
    resetPlayerArea();
    playbackModal.classList.add('hidden');
    document.body.style.overflow = '';
    currentIndex = null;
    currentFiltered = [];
  }

  // --- render functions (preserve your original layout but ensure card clicks open modal)
  function renderCards() {
    // featured: first 6
    featuredRow.innerHTML = '';
    const featured = movies.slice(0,6);
    featured.forEach((m, fi) => {
      const card = document.createElement('div');
      card.className = 'flex-none w-64 md:w-80';
      card.innerHTML = `
        <div class="movie-card cursor-pointer bg-gray-800 rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition transform hover:-translate-y-1 relative">
          <div class="relative">
            <img src="${m.image}" alt="${m.title}" class="w-full h-40 md:h-48 object-cover">
            <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 transition">
              <div class="play-icon absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 disney-blue bg-opacity-90 rounded-full w-12 h-12 flex items-center justify-center opacity-0 transition">
                <i class="fas fa-play text-white"></i>
              </div>
            </div>
            <span class="absolute top-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded">${m.duration || ''}</span>
          </div>
          <div class="p-4">
            <div class="flex justify-between items-start mb-1">
              <h2 class="text-lg font-semibold">${m.title}</h2>
              <span class="disney-blue-text text-sm">★ ${m.rating}</span>
            </div>
            <p class="text-sm text-gray-400">${m.year} • ${ (m.genre || '').split(',')[0] || '' }</p>
          </div>
        </div>
      `;
      card.querySelector('.movie-card').addEventListener('click', () => handleCardClick(m, fi));
      featuredRow.appendChild(card);
    });

    // main grid
    mainGrid.innerHTML = '';
    movies.forEach((movie, idx) => {
      const card = document.createElement('div');
      card.className = 'movie-card cursor-pointer bg-gray-800 rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition transform hover:-translate-y-1 relative';
      card.innerHTML = `
        <div class="relative">
          <img src="${movie.image}" alt="${movie.title}" class="w-full h-40 md:h-48 object-cover">
          <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 transition">
            <div class="play-icon absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 disney-blue bg-opacity-90 rounded-full w-12 h-12 flex items-center justify-center opacity-0 transition">
              <i class="fas fa-play text-white"></i>
            </div>
          </div>
          <span class="absolute top-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded">${movie.duration || ''}</span>
        </div>
        <div class="p-4">
          <div class="flex justify-between items-start mb-1">
            <h2 class="text-lg font-semibold">${movie.title}</h2>
            <span class="disney-blue-text text-sm">★ ${movie.rating || ''}</span>
          </div>
          <p class="text-sm text-gray-400">${movie.year || ''} • ${ (movie.genre || '').split(',')[0] || '' }</p>
        </div>
      `;
      card.addEventListener('click', () => handleCardClick(movie, idx));
      mainGrid.appendChild(card);
    });
  }

  // decide whether to inline-play or redirect
  function handleCardClick(movie, idx=0) {
    // If shouldRedirectToPlayer returns true => fallback to player.html
    if (shouldRedirectToPlayer(movie.video)) {
      const url = `player.html?title=${encodeURIComponent(movie.title)}&video=${encodeURIComponent(movie.video)}`;
      window.location.href = url;
      return;
    }

    // otherwise open modal player
    const filtered = getFilteredList();
    const indexInFiltered = filtered.findIndex(m => m.title === movie.title && m.year === movie.year);
    const playIndex = indexInFiltered >= 0 ? indexInFiltered : idx;
    playInModal(filtered.length ? filtered : movies, playIndex);
  }

  // simple filtered list getter (preserves original file behavior; extend for search/categories)
  function getFilteredList() {
    return movies.slice();
  }

  // event bindings
  document.getElementById('close-modal').addEventListener('click', closeModalHandler);
  playbackModal.addEventListener('click', (e) => { if (e.target === playbackModal) closeModalHandler(); });

  document.addEventListener('keydown', (e) => {
    if (playbackModal.classList.contains('hidden')) return;
    switch (e.key.toLowerCase()) {
      case 'escape': closeModalHandler(); break;
      case ' ': e.preventDefault(); { const v = document.getElementById('modal-video'); if (v) v.paused ? v.play() : v.pause(); break; }
      case 'arrowright': { const v = document.getElementById('modal-video'); if (v) v.currentTime = Math.max(0, v.currentTime + 10); break; }
      case 'arrowleft': { const v = document.getElementById('modal-video'); if (v) v.currentTime = Math.max(0, v.currentTime - 10); break; }
      case 'n': playNext(); break;
      case 'p': playPrev(); break;
      case 'm': { const v = document.getElementById('modal-video'); if (v) v.muted = !v.muted; break; }
      case 'f': {
        const el = document.getElementById('modal-video') || modalPlayerArea.querySelector('iframe');
        if (el) { (el.requestFullscreen || modalPlayerArea.requestFullscreen).call(el).catch(()=>{}); }
        break;
      }
    }
  });

  document.getElementById('play-button-in-modal').addEventListener('click', () => {
    const v = document.getElementById('modal-video'); if (v) v.play().catch(()=>{});
  });

  // initial render
  window.addEventListener('DOMContentLoaded', () => {
    renderCards();
    resetPlayerArea(); // ensure markup is consistent on load
  });

  // expose close for external use
  window.closePlayerModal = closeModalHandler;
  </script>
 

</body>
</html>
