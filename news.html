<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jio TV Player</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.js"></script>

<style>
body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: Arial, sans-serif;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 15px;
  padding: 15px;
}
.card {
  cursor: pointer;
  text-align: center;
}
.card img {
  width: 100%;
  border-radius: 10px;
}
.card b {
  display: block;
  margin-top: 6px;
  font-size: 14px;
}

/* Modal */
#modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.9);
  z-index: 999;
}
#playerBox {
  position: absolute;
  inset: 5%;
  background: #000;
}
video {
  width: 100%;
  height: 100%;
}
.close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 22px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="grid" id="channels"></div>

<div id="modal">
  <div class="close" onclick="closePlayer()">✕</div>
  <div id="playerBox">
    <video id="video" controls autoplay></video>
  </div>
</div>

<script>
/* ===============================
   JIO CHANNEL LIST (WORKING)
================================ */
const CHANNELS = [
  {
    title: "Sports18 Khel",
    image: "https://jiotvimages.cdn.jio.com/dare_images/images/Sports18_Khel.png",
    mpd: "https://jiotvpllive.cdn.jio.com/bpk-tv/Sports18_Khel_BTS/output/index.mpd",
    keyId: "ab947ddbb9795d38bff35597b4f73108",
    key: "2671e22eb7dc174c35b6aad4b113f7b0"
  },
  {
    title: "Star Sports 1 Hindi",
    image: "https://jiotvimages.cdn.jio.com/dare_images/images/Star_Sports_HD1_Hindi.png",
    mpd: "https://jiotvmblive.cdn.jio.com/bpk-tv/Star_Sports_1_Hindi_BTS/output/index.mpd",
    keyId: "8ea9b607549252068e260a5f4d7dd321",
    key: "350c0aaffedf51cc1502e9543c7c885e"
  }
];

/* ===============================
   RENDER CHANNELS
================================ */
const grid = document.getElementById("channels");

CHANNELS.forEach((c, i) => {
  grid.innerHTML += `
    <div class="card" onclick="play(${i})">
      <img src="${c.image}">
      <b>${c.title}</b>
    </div>
  `;
});

/* ===============================
   PLAYER LOGIC (JIO SAFE)
================================ */
let player;

async function play(i) {
  const c = CHANNELS[i];

  document.getElementById("modal").style.display = "block";

  const video = document.getElementById("video");

  if (player) {
    await player.destroy();
  }

  player = new shaka.Player(video);

  // ✅ JIO ClearKey (CORRECT)
  player.configure({
    drm: {
      clearKeys: {
        [c.keyId]: c.key
      }
    }
  });

  try {
    await player.load(c.mpd);
    video.play();
  } catch (e) {
    console.error("Playback error", e);
    alert("Playback failed. Check console.");
  }
}

function closePlayer() {
  document.getElementById("modal").style.display = "none";
  if (player) player.destroy();
}
</script>

</body>
</html>
