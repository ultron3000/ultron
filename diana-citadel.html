<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Citadel - Season 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FontAwesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- HLS.js (Required for m3u8 streaming) -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    /* Custom UI */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #111; }
    ::-webkit-scrollbar-thumb { background: #ffcc00; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #ffdd33; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn .5s ease-out forwards; }

    .gradient-text {
      background: linear-gradient(90deg, #ffcc00, #ff9900);
      -webkit-background-clip: text;
      color: transparent;
    }

    #sparkCanvasPage {
      position: fixed; top:0;left:0;width:100%;height:100%;
      pointer-events:none; z-index:10000;
    }

    /* Spinner */
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #555;
      border-top: 4px solid #ffcc00;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: auto;
      margin-top: 80px;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>

<body class="bg-black text-gray-100 min-h-screen">

<!-- HEADER -->
<header class="sticky top-0 z-50 bg-black bg-opacity-90 backdrop-blur-sm border-b border-yellow-600/20">
  <div class="container mx-auto px-4 py-4 flex justify-between items-center">
    <div class="flex items-center space-x-2">
      <div class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center">
        <i class="fas fa-shield-alt text-black text-xl"></i>
      </div>
      <h1 class="text-2xl font-bold gradient-text">Citadel: Diana</h1>
    </div>

    <div class="flex items-center space-x-4">
      <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-800 transition">
        <i class="fas fa-moon text-yellow-500"></i>
      </button>

      <button id="search-btn" class="p-2 rounded-full hover:bg-gray-800 transition">
        <i class="fas fa-search text-yellow-500"></i>
      </button>
    </div>
  </div>

  <div id="search-bar" class="hidden px-4 pb-4">
    <div class="relative">
      <input type="text" placeholder="Search episodes..."
        class="w-full bg-gray-900 border border-yellow-600/30 rounded-full py-2 px-4 pl-10 text-white">
      <i class="fas fa-search absolute left-3 top-3 text-yellow-500"></i>
    </div>
  </div>
</header>

<!-- MAIN -->
<main class="container mx-auto px-4 py-8">

  <!-- Banner -->
  <section class="mb-12 relative overflow-hidden rounded-xl">
    <div class="absolute inset-0 bg-gradient-to-r from-black via-black/70 to-transparent z-10"></div>
    <img src="https://resizing.flixster.com/lPMq-zM5jVKZq9Wj1hfng9PVp7Y=/620x336/v2/https://statcdn.fandango.com/MPX/image/NBCU_Fandango/68/695/thumb_180A7415-9B86-4287-BC0A-E2FC4109DEBE.jpg" 
         class="w-full h-64 md:h-96 object-cover">

    <div class="absolute bottom-0 left-0 z-20 p-6 md:p-8">
      <h2 class="text-3xl md:text-5xl font-bold mb-2 gradient-text"></h2>
      <p class="text-gray-300 max-w-xl mb-4">
        In 2030 Milan, an undercover agent for the global spy agency Citadel is trapped behind enemy lines as a mole in the powerful enemy syndicate Manticore.
      </p>

      <div class="flex space-x-3">
        <button class="bg-yellow-600 hover:bg-yellow-700 text-black font-semibold py-2 px-6 rounded-full">
        </button>
        <button class="bg-gray-800 hover:bg-gray-700 text-white font-semibold py-2 px-6 rounded-full">
        </button>
      </div>
    </div>
  </section>

  <!-- Episodes -->
  <section>
    <h3 class="text-xl font-semibold mb-6 flex items-center">
      <i class="fas fa-list-ul text-yellow-500 mr-2"></i> Episodes
    </h3>

    <div id="movies" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"></div>
  </section>

</main>

<!-- FOOTER -->
<footer class="bg-gray-900 border-t border-gray-800 mt-12 py-8">
  <div class="container mx-auto px-4 text-center text-gray-400 text-sm">
    ©  Citadel Productions. All rights reserved.
  </div>
</footer>

<!-- VIDEO MODAL -->
<div id="video-modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-90 flex items-center justify-center">
  <div class="relative w-full max-w-4xl bg-gray-900 rounded-xl overflow-hidden">

    <!-- Close -->
    <button id="close-video-modal"
      class="absolute top-4 right-4 z-50 text-white hover:text-yellow-500 text-2xl">
      <i class="fas fa-times"></i>
    </button>

    <!-- Video Container -->
    <div class="modal-player w-full" style="aspect-ratio:16/9;">
      <div id="loading-spinner" class="spinner hidden"></div>
      <video id="modal-video" class="w-full h-full" controls playsinline></video>
    </div>

    <!-- Player Info -->
    <div class="p-6">
      <h3 id="modal-title" class="text-2xl font-bold mb-2"></h3>
      <p id="modal-description" class="text-gray-300 mb-4"></p>
      <button id="next-episode-btn"
        class="hidden bg-yellow-600 hover:bg-yellow-700 text-black font-semibold py-2 px-4 rounded-full">
        Next Episode →
      </button>
    </div>
  </div>
</div>

<!-- SPARK EFFECT -->
<canvas id="sparkCanvasPage"></canvas>

<!-- JAVASCRIPT -->
<script>
/* MOVIE DATA (unchanged — same as yours) */
const movies = [
      { 
        title: "Split in Two", 
        video: "https://sad.aurorionbranding.site:443/v4/rqz/wag6o/index-f2-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/f35e7523b74a0651d3ab54d56a63306d333f37c54793fbd5d372059d58a8c7ae._BR-6_AC_SX720_FMwebp_.jpg",
        description: "2030: in a gray and hyper-controlled Milan, Diana and Luca are sent on a mission to Lugano to spy on the exchange of a powerful weapon. Not far away, Edo Zani, Manticore Italy’s heir, has to respond to an unexpected proposal from the head of Manticore France, Cecile. In the flashbacks, Diana investigates her parents’ suspicious deaths when she meets Gabriele, a mysterious Citadel agent.",
        duration: "52 min"
      },
      { 
        title: "War", 
        video: "https://spc.oravix.cyou:443/v4/rqz/is3zv/index-f2-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/661b6fe92fac351e7a4f0e0f524d45cb3d9100eab863f15e13f3f2aadc5e4d87._BR-6_AC_SX720_FMwebp_.jpg",
        description: "Diana and Edo form a secret agreement and make their first move, but they underestimate Cecile’s fierce reaction. While Manticore Italy is under attack, Ettore Zani has to step in to stop a war from breaking out. In the flashbacks, Diana completes her training with Gabriele and becomes a Citadel agent.",
        duration: "48 min"
      },
      { 
        title: "Together", 
        video: "https://svz.ellionhealth.cyou:443/v4/rqz/kftmv/index-f2-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/d9281667f948b73a7ff860a38d78a008bf470138650e1ad9f79cd910d37b012d._BR-6_AC_SX720_FMwebp_.jpg",
        description: "Ettore sends Edo and Diana to Sicily on a sensitive mission that threatens their alliance. However, under the Mediterranean sun, the two discover they are connected by much more than their objectives. Eight years earlier, Diana infiltrates Manticore and carries out her first mission.",
        duration: "55 min"
      },
      { 
        title: "The Zanis", 
        video: "https://sri.artanix.sbs:443/v4/rqz/8hy3v/index-f2-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/678fe3e11e682b8c510e64bfb52e785ec87ee99bb89d6a957afb5e6fcfef4c6b._BR-6_AC_SX720_FMwebp_.jpg",
        description: "Diana is captured and struggles desperately to survive while Ettore has to make a hard decision in order to restore Manticore Italy's power, as memories resurface of the day when his relationship with Edo was shattered forever.",
        duration: "50 min"
      },
      { 
        title: "Attack", 
        video: "https://sau.frostlinegarden.store:443/v4/djx/tzvae/index-f2-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/9c0364b8762bc47a208f40c4e5359801419a5c699c3b024d95c014a5023eefcf._BR-6_AC_SX720_FMwebp_.jpg",
        description: "Edo leads a group of agents in an attack on the Manticore France's headquarters in Paris. Just as Diana is about to get her hands on the weapon, she is forced to decide which side she is on, as she had to do eight years earlier, the night Citadel was destroyed.",
        duration: "49 min"
      },
      { 
        title: "Jupiter", 
        video: "https://shh.ridgegateinnovationhub.shop:443/v4/rqz/qgkjm/index-f2-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/d930c0c27c1355a65f11e838d2e02c802f78c4b0feb61308d9ec12d8fffc0a5e._BR-6_AC_SX720_FMwebp_.jpg",
        description: "As Diana ponders her choice, Edo works on a powerful new weapon. Ettore tries to get closer to his son, playing one last, surprise card. In a flashback, the Zanis mourn Enrico while Diana realizes she's the last living Citadel agent.",
        duration: "53 min"
      },
    ];

/* DOM References */
const container = document.getElementById("movies");
const modal = document.getElementById("video-modal");
const modalVideo = document.getElementById("modal-video");
const modalTitle = document.getElementById("modal-title");
const modalDescription = document.getElementById("modal-description");
const spinner = document.getElementById("loading-spinner");
const nextBtn = document.getElementById("next-episode-btn");

let currentIndex = 0;
let hls = null;

/* Utilities */
function isHLS(u){ return /\.m3u8/.test(u); }
function isMP4(u){ return /\.mp4/.test(u); }
function isYT(u){ return u.includes("youtu"); }
function isMega(u){ return u.includes("mega.nz/embed"); }
function isStreamTape(u){ return u.includes("streamtape.com"); }

/* Modal Controls */
function showModal(){ modal.classList.remove("hidden"); document.body.style.overflow="hidden"; }
function hideModal(){
  modal.classList.add("hidden");
  document.body.style.overflow="";
  modalVideo.pause();
  modalVideo.src="";
  if(hls){ hls.destroy(); hls=null; }

  document.querySelector(".modal-player").innerHTML = `
      <div id="loading-spinner" class="spinner hidden"></div>
      <video id="modal-video" class="w-full h-full" controls playsinline></video>
  `;
}

/* Playback */
function playEpisode(index){
  currentIndex = index;
  const ep = movies[index];

  modalTitle.textContent = ep.title;
  modalDescription.textContent = ep.description;
  nextBtn.classList.toggle("hidden", index === movies.length - 1);

  // Reset player
  const container = document.querySelector(".modal-player");
  container.innerHTML = `
    <div id="loading-spinner" class="spinner"></div>
    <video id="modal-video" class="w-full h-full" controls playsinline></video>
  `;

  const videoEl = document.getElementById("modal-video");
  spinner.classList.remove("hidden");

  // StreamTape
  if(isStreamTape(ep.video)){
    container.innerHTML = `<iframe src="${ep.video}" allowfullscreen class="w-full h-full"></iframe>`;
    showModal(); return;
  }

  // Mega
  if(isMega(ep.video)){
    container.innerHTML = `<iframe src="${ep.video}" allowfullscreen class="w-full h-full"></iframe>`;
    showModal(); return;
  }

  // YouTube
  if(isYT(ep.video)){
    container.innerHTML = `
      <iframe class="w-full h-full"
      src="${ep.video}?autoplay=1&modestbranding=1&rel=0"
      allow="autoplay; encrypted-media" allowfullscreen></iframe>
    `;
    showModal(); return;
  }

  // HLS
  if(isHLS(ep.video)){
    if(Hls.isSupported()){
      hls = new Hls();
      hls.loadSource(ep.video);
      hls.attachMedia(videoEl);
      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        spinner.classList.add("hidden");
        videoEl.play();
      });
    } else {
      videoEl.src = ep.video;
      spinner.classList.add("hidden");
      videoEl.play();
    }
    showModal();
    return;
  }

  // MP4
  if(isMP4(ep.video)){
    videoEl.src = ep.video;
    spinner.classList.add("hidden");
    videoEl.play();
    showModal();
    return;
  }

  // Fallback
  window.location.href = `player.html?title=${encodeURIComponent(ep.title)}&video=${encodeURIComponent(ep.video)}`;
}

/* Next Episode */
nextBtn.onclick = () => playEpisode(currentIndex + 1);

/* Auto next */
modalVideo?.addEventListener("ended", () => {
  if(currentIndex < movies.length - 1) playEpisode(currentIndex + 1);
});

/* Render Episode Grid */
function renderMovies(){
  container.innerHTML = "";
  movies.forEach((m, i) => {
    const card = document.createElement("div");
    card.className = "rounded-xl overflow-hidden bg-gray-800 hover:bg-gray-700 cursor-pointer";
    card.innerHTML = `
      <img src="${m.image}" class="w-full">
      <div class="p-3">
        <h3 class="font-semibold text-lg">${m.title}</h3>
      </div>
    `;
    card.onclick = () => playEpisode(i);
    container.appendChild(card);
  });
}
renderMovies();

/* Close modal */
document.getElementById("close-video-modal").onclick = hideModal;
modal.onclick = e => { if(e.target === modal) hideModal(); };

/* Keyboard Controls */
document.addEventListener("keydown", e => {
  if(modal.classList.contains("hidden")) return;

  const v = document.getElementById("modal-video");

  if(e.key === "Escape") hideModal();
  if(e.key === " ") { e.preventDefault(); v.paused ? v.play() : v.pause(); }
  if(e.key === "ArrowRight") v.currentTime += 10;
  if(e.key === "ArrowLeft") v.currentTime -= 10;
});

</script>

</body>
</html>
