<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The Day of the Jackal — Fixed Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- hls.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.1/dist/hls.min.js"></script>

  <style>
    /* kept your styles (unchanged) */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #111; }
    ::-webkit-scrollbar-thumb { background: #ffcc00; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #ffdd33; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px);} to { opacity:1; transform: translateY(0);} }
    .fade-in { animation: fadeIn 0.45s ease-out forwards; }
    .delay-1 { animation-delay: .08s } .delay-2 { animation-delay: .16s } .delay-3 { animation-delay: .24s } .delay-4 { animation-delay: .32s } .delay-5 { animation-delay: .40s }

    .glow-effect { position:relative; }
    .glow-effect::after { content:''; position:absolute; inset:0; border-radius:12px; box-shadow:0 0 15px rgba(255,204,0,0); transition: box-shadow .3s ease; pointer-events:none; }
    .glow-effect:hover::after { box-shadow:0 0 15px rgba(255,204,0,0.7); }

    .gradient-text {
      background: linear-gradient(90deg,#ffcc00,#ff9900);
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }

    @media (max-width:640px) { .movie-card { width: calc(50% - 1rem); } }
    @media (max-width:400px) { .movie-card { width: 100%; } }

    /* Modal/player styles (Hawkeye-style) */
    .modal-overlay { position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,0.9); z-index:9999; opacity:0; visibility:hidden; transition: all .2s ease; }
    .modal-overlay.active { opacity:1; visibility:visible; }
    .modal-card { width:95%; max-width:1100px; border-radius:12px; overflow:hidden; background: linear-gradient(180deg,#0b0b0b,#151515); box-shadow:0 30px 80px rgba(0,0,0,0.7); }
    .player-area { position:relative; padding-bottom:56.25%; height:0; background:black; }
    .player-area video, .player-area iframe { position:absolute; inset:0; width:100%; height:100%; background:black; }
    .progress-bar { height:6px; background: rgba(255,255,255,0.06); width:100%; position:relative; }
    .progress-fill { position:absolute; left:0; top:0; bottom:0; width:0%; background:#ffd166; transition: width .2s linear; }
    .controls { display:flex; gap:8px; align-items:center; }
    .btn { background:#1f1f1f; color:#fff; padding:8px 12px; border-radius:8px; }
    .btn.primary { background:#ffd166; color:#111827; }

    #playerError { display:none; }
    #playerError.show { display:block; }
    /* ============================
   MOBILE FIX — DOES NOT TOUCH DESKTOP
   ============================ */

@media (max-width: 767px) {

  /* Proper mobile player layout (matches your working version) */
  .player-wrapper {
    padding-bottom: 56.25% !important;   /* keep 16:9 on mobile */
    height: 0 !important;
    position: relative !important;
  }

  .player-wrapper video,
  .player-wrapper iframe {
    position: absolute !important;
    inset: 0 !important;
    width: 100% !important;
    height: 100% !important;
  }

  /* Proper stacked mobile controls */
  .player-meta {
    display: flex !important;
    flex-direction: column !important;
    gap: 12px !important;
    padding: 12px !important;
    background: #0b1220 !important;
    z-index: 20 !important;
  }

  /* Mobile control row wraps properly */
  .controls-row {
    display: flex !important;
    flex-wrap: wrap !important;
    justify-content: center !important;
    gap: 10px !important;
  }

  /* Mobile buttons use icon-only layout */
  .btn {
    padding: 8px !important;
    font-size: 0 !important;      /* hides text on mobile */
    min-width: 48px !important;
    height: 44px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }

  .btn i {
    font-size: 1.1rem !important;
    margin: 0 !important;
  }

  /* Close button always visible on mobile */
  #topCloseBtn {
    opacity: 1 !important;
  }
}
/* ============================
   DESKTOP FIX — DOES NOT TOUCH MOBILE
   ============================ */

@media (min-width: 768px) {

  /* Fix video height so it doesn't cover controls */
  .player-wrapper {
    padding-bottom: 0 !important;     /* remove forced 16:9 only on desktop */
    height: auto !important;
    max-height: 60vh !important;       /* safe video height */
    position: relative !important;
  }

  /* Ensure iframe/video stays inside wrapper */
  .player-wrapper video,
  .player-wrapper iframe {
    height: 100% !important;
    max-height: 60vh !important;
    position: relative !important;
  }

  /* Make sure controls are ALWAYS visible above video */
  .player-meta {
    position: relative !important;
    z-index: 100 !important;
    background: #0b1220 !important;      /* solid background for visibility */
    padding-top: 10px !important;
  }

  /* Controls row layout */
  .controls-row {
    display: flex !important;
    flex-wrap: wrap !important;
    justify-content: center !important;
    gap: 12px !important;
  }

  /* Buttons behave normally */
  .btn {
    min-width: 95px !important;
    padding: 10px 16px !important;
    flex: unset !important;
  }

  /* Modal height adjustment to fit everything */
  .modal-card {
    max-height: 85vh !important;
    overflow: visible !important;
  }
}
  </style>
</head>

<body class="bg-black text-gray-100 min-h-screen">
  <!-- Header (kept intact) -->
  <header class="sticky top-0 z-50 bg-black bg-opacity-90 backdrop-blur-sm border-b border-yellow-600/20">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <div class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center">
          <i class="fas fa-crosshairs text-black text-xl"></i>
        </div>
        <h1 class="text-2xl font-bold gradient-text">THE DAY OF THE JACKAL</h1>
      </div>

      <div class="flex items-center space-x-4">
        <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-800 transition">
          <i class="fas fa-moon text-yellow-500"></i>
        </button>
        <button id="search-btn" class="p-2 rounded-full hover:bg-gray-800 transition">
          <i class="fas fa-search text-yellow-500"></i>
        </button>
      </div>
    </div>

    <!-- Search Bar (hidden by default) -->
    <div id="search-bar" class="hidden px-4 pb-4">
      <div class="relative">
        <input id="search-input" type="text" placeholder="Search episodes..."
               class="w-full bg-gray-900 border border-yellow-600/30 rounded-full py-2 px-4 pl-10 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
        <i class="fas fa-search absolute left-3 top-3 text-yellow-500"></i>
      </div>
    </div>
  </header>

  <!-- Main content (kept intact) -->
  <main class="container mx-auto px-4 py-8">
    <!-- Hero -->
    <section class="mb-12 relative overflow-hidden rounded-xl">
      <div class="absolute inset-0 bg-gradient-to-r from-black via-black/70 to-transparent z-10"></div>
      <img src="https://static1.cbrimages.com/wordpress/wp-content/uploads/2024/10/the-day-of-the-jackal-eddie-redmayne.jpg"
           alt="The Day of the Jackal Banner" class="w-full h-64 md:h-96 object-cover">
      <div class="absolute bottom-0 left-0 z-20 p-6 md:p-8">
        <h2 class="text-3xl md:text-5xl font-bold mb-2 gradient-text">Movie & TV Series</h2>
        <p class="text-gray-300 mb-4 max-w-lg">A gripping political thriller across two eras — the iconic 1973 film and the modern 2024 TV series — both follow a deadly assassin known as "The Jackal" and the global manhunt to stop him.</p>
        <div class="flex space-x-3">
          <button id="play-all-btn" class="bg-yellow-600 hover:bg-yellow-700 text-black font-semibold py-2 px-6 rounded-full transition flex items-center">
            <i class="fas fa-play mr-2"></i> Play All
          </button>
          <button class="bg-gray-800 hover:bg-gray-700 text-white font-semibold py-2 px-6 rounded-full transition flex items-center">
            <i class="fas fa-info-circle mr-2"></i> Details
          </button>
        </div>
      </div>
    </section>

    <!-- Filters -->
    <div class="flex flex-wrap items-center justify-between mb-8 gap-4">
      <div class="flex space-x-2 overflow-x-auto pb-2">
        <button class="filter-btn active bg-yellow-600 text-black px-4 py-1 rounded-full text-sm font-medium" data-filter="all">All</button>
        <button class="filter-btn bg-gray-800 hover:bg-gray-700 px-4 py-1 rounded-full text-sm font-medium" data-filter="thriller">Thriller</button>
        <button class="filter-btn bg-gray-800 hover:bg-gray-700 px-4 py-1 rounded-full text-sm font-medium" data-filter="drama">Drama</button>
        <button class="filter-btn bg-gray-800 hover:bg-gray-700 px-4 py-1 rounded-full text-sm font-medium" data-filter="political">Political</button>
        <button class="filter-btn bg-gray-800 hover:bg-gray-700 px-4 py-1 rounded-full text-sm font-medium" data-filter="crime">Crime</button>
      </div>

      <div class="flex items-center space-x-2">
        <span class="text-gray-400 text-sm">Sort by:</span>
        <select id="sort-select" class="bg-gray-900 border border-gray-700 text-white text-sm rounded-full px-3 py-1 focus:outline-none focus:ring-1 focus:ring-yellow-500">
          <option value="release">Release Date</option>
          <option value="order">Episode Order</option>
          <option value="pop">Popularity</option>
        </select>
      </div>
    </div>

    <!-- Episodes Grid -->
    <section>
      <h3 class="text-xl font-semibold mb-6 flex items-center">
        <i class="fas fa-list-ul text-yellow-500 mr-2"></i>
        Episodes
      </h3>

      <div id="episodes" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
        <!-- episode cards inserted by JS -->
      </div>
    </section>

    <!-- Original Movie Section -->
    <section class="mt-12">
      <h3 class="text-xl font-semibold mb-6 flex items-center">
        <i class="fas fa-film text-yellow-500 mr-2"></i>
        Original Movie (1973)
      </h3>

      <div id="original-movie" class="grid grid-cols-1 gap-6">
        <!-- original movie card inserted by JS -->
      </div>
    </section>
  </main>

  <!-- Footer (kept) -->
  <footer class="bg-gray-900 border-t border-gray-800 mt-12 py-8">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <div class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
              <i class="fas fa-shield-alt text-black text-sm"></i>
            </div>
            <span class="text-xl font-bold gradient-text">THE DAY OF THE JACKAL</span>
          </div>
          <p class="text-gray-400 text-sm mt-2">©  The Day of the Jackal Productions. All rights reserved.</p>
        </div>

        <div class="flex space-x-6">
          <a href="#" class="text-gray-400 hover:text-yellow-500 transition"><i class="fab fa-facebook-f"></i></a>
          <a href="#" class="text-gray-400 hover:text-yellow-500 transition"><i class="fab fa-twitter"></i></a>
          <a href="https://www.instagram.com/stark_4152" class="text-gray-400 hover:text-yellow-500 transition"><i class="fab fa-instagram"></i></a>
          <a href="https://www.youtube.com/channel/UCYwTAs1PRVHbq4LnCHEEicw" class="text-gray-400 hover:text-yellow-500 transition"><i class="fab fa-youtube"></i></a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Playback Modal (Hawkeye-style) -->
  <div id="playback-modal" class="modal-overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="relative p-4 border-b border-gray-700 flex items-start justify-between">
        <div>
          <div id="modal-title" class="text-xl font-bold text-yellow-400"></div>
          <div id="modal-sub" class="text-sm text-gray-400 mt-1"></div>
        </div>
        <div class="flex items-center gap-3">
          <button id="close-modal-btn" class="text-white p-2 rounded bg-gray-800 hover:bg-gray-700"><i class="fas fa-times"></i></button>
        </div>
      </div>

      <div id="player-area" class="player-area">
        <!-- default video (JS will create/destroy HLS-controlled <video>) -->
        <video id="modal-video" controls playsinline preload="metadata" class="w-full h-full"></video>
      </div>

      <div class="progress-bar" id="video-progress"><div id="progress-fill" class="progress-fill"></div></div>

      <div class="p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
        <div>
          <p id="modal-desc" class="text-gray-300 text-sm"></p>
          <div id="qualityControls" class="mt-2"></div>
        </div>

        <div class="controls">
          <button id="prevBtn" class="btn" title="Previous"><i class="fas fa-step-backward"></i></button>
          <button id="modal-play" class="btn primary" title="Play/Pause"><i class="fas fa-play mr-2"></i><span id="playText">Play</span></button>
          <button id="nextBtn" class="btn" title="Next"><i class="fas fa-step-forward"></i></button>
          <button id="muteBtn" class="btn" title="Mute"><i class="fas fa-volume-up"></i></button>
          <button id="fullscreenBtn" class="btn" title="Fullscreen"><i class="fas fa-expand"></i></button>
        </div>
      </div>
    </div>
  </div>

  <div id="playerError" class="hidden bg-red-900 text-white p-2 rounded mt-2 text-center"></div>

  <script>
  /***************
   * Data (unchanged as uploaded)
   ***************/
  const episodes = [
    { title: "Episode 1", year: 2024, video: "https://p.10014.workers.dev:443/frostveil88.live/file2/aqAq3zu97OJYKuIeujX5zo9zpwhT8hNU4zTtuzJsTUruMxxPCE6N69YJxdE+g7g631vwVmecLpRhTFZ6ZRcokx+UOYAtF3I8UgfvczlrDmpgq7skxWHxgP6xYxZP0COVSw2j8Eg4spwrKEF~jdZjVA==/MTA4MA==/aW5kZXgubTN1OA==.m3u8", image: "https://img10.hotstar.com/image/upload/f_auto/sources/r1/cms/prod/4749/1738838544749-h", runtime: "45 min", rating: "7.8/10", description: "When an elite assassin carries out his latest kill, it catches the attention of an intelligence officer, who starts to hunt him down." },
    { title: "Episode 2", year: 2024, video: "https://p.10014.workers.dev:443/hailmist36.pro/file2/uYNI9xPEpwbhFRzjHgqKiAF5gck80I+r89ApnMRtcJ7NZ7l2qn7LquI3MA9hXFr56AsAG8f0+ebiNvIhCT8G6QUC63yULIn2O5~QKPmP4bOrMoM0QzpbcN9R~WJvncL61oZ4YFO+dzi6gBjB2TvS~w==/MTA4MA==/aW5kZXgubTN1OA==.m3u8", image: "https://img10.hotstar.com/image/upload/f_auto/sources/r1/cms/prod/4955/1738838544955-h", runtime: "45 min", rating: "8.1/10", description: "With his previous client backing out of payment, the Jackal's reputation is on the line, and he starts to plot his revenge." },
    { title: "Episode 3", year: 2024, video: "https://p.10014.workers.dev:443/dewshine74.xyz/file2/xaG2YaYeq9RcKNYkRZIFdApWkDtZZ3r7EQ7yA0J73dmB~~FqqebldQLc87jObJuSeGW0A1eGDUSDd~~IJMMgSSF+oK1bSVp6qd+YuDgeQcmmQ~AI8Ow+3LWlh1lJb2rXgvlSJbw0SSYYXvSMv4YsXQ==/MTA4MA==/aW5kZXgubTN1OA==.m3u8", image: "https://img10.hotstar.com/image/upload/f_auto/sources/r1/cms/prod/5166/1738838545166-h", runtime: "45 min", rating: "8.3/10", description: "Armed with the knowledge of his wayward client's identity, the Jackal tracks him down in Munich, determined to settle the score." },
    { title: "Episode 4", year: 2024, video: "https://p.10014.workers.dev:443/stormgleam42.xyz/file2/MBWfEmLX83hcs5iXqwXSk3uhSp1uvkccIfAmjq2yiK6itZvHudQgp1l6qsgyewoxQurbagRbofOcqVLxjrMqLj+BBH1k8CvsBBgf3tjmhDS3xnWvK0RqHkqkRQHHu1upOYrrxcoGAMTFhqKSbIMbAg==/MTA4MA==/aW5kZXgubTN1OA==.m3u8", image: "https://img10.hotstar.com/image/upload/f_auto/sources/r1/cms/prod/7180/1738838547180-h", runtime: "45 min", rating: "8.4/10", description: "His vengeance fulfilled, the Jackal flees Munich and tries to quell Nuria's suspicions. Bianca follows a new lead in her hunt." },
    { title: "Episode 5", year: 2024, video: "https://p.10014.workers.dev:443/rainflare53.pro/file2/hKkjcA2vq3FH~+5bZea8KKSb0N6DVsqxJcB~4qr6k10+F+L7eUH3kz8gTQ4b~gKOmzSR3wwAFlK6US~DczD9O9ytUkoNReO7h1qIv0s9f7jC2ghu~+5SMP2C~ewNP2ZiYTcPTrc0o1YtEfM+TLew1Q==/MTA4MA==/aW5kZXgubTN1OA==.m3u8", image: "https://img10.hotstar.com/image/upload/f_auto/sources/r1/cms/prod/6205/1738838546205-h", runtime: "45 min", rating: "8.7/10", description: "The Jackal visits Norman with a special commission, but with Bianca also tracking Norman down, she is starting to close in on him." },
    { title: "Episode 6", year: 2024, video: "https://p.10014.workers.dev:443/dewshine74.xyz/file2/P3aZywUINpcWL8RPRhMx0VWEnu1p~7BlvgfIe9AzfhAg6wKUvfprnif0Lvo7+5HffA~Y2fnXJMl2Tk0ALwo1aMpmq~mnSBTb8r7qdoaQK~IpG1W5DnLrFekFrwpGufp~ypFwpBGvPEcCitnDLO3+1Q==/MTA4MA==/aW5kZXgubTN1OA==.m3u8", image: "https://img10.hotstar.com/image/upload/f_auto/sources/r1/cms/prod/3306/1738838543306-h", runtime: "45 min", rating: "9.0/10", description: "Following his shoot-out with Bianca, the Jackal must escape his captors and regroup ahead of his hit on Ulle Dag Charles; Bianca tracks his trail of devastation through central Europe." },
    { title: "Episode 7", year: 2024, video: "https://p.10014.workers.dev:443/cloudspark91.live/file2/1olkifcpEf+CdDR4otzTt6z9v6e9p8vPqGLRtR~j70SqTvX9b48GCW54TeZ58MWQ~OkplrzaAfP1BXqPje2ATeHZaeEzWXpiZlh21cbPn2BCUfjdJ1RYXX~~nz~lwqMmu66QZWBSAvxU2PXYX+uTfYTa9cXRs~6ckPdaCKpZUmk=/MTA4MA==/aW5kZXgubTN1OA==.m3u8", image: "https://img10.hotstar.com/image/upload/f_auto/sources/r1/cms/prod/1604/1738838541604-h", runtime: "45 min", rating: "8.5/10", description: "The Jackal and Bianca both descend on Tallinn in anticipation of UDC's announcement; with the venue in lockdown and Bianca closing in, the Jackal must use all his wiles as he prepares to take his shot." },
    { title: "Episode 8", year: 2024, video: "https://p.10014.workers.dev:443/rainflare53.pro/file2/tdtVlaRN0RgiS708f9dTMznyc7~ynTzs6881v30Xtox2AwqA96a3Saq5rFB1OYWJRCLns+hN975LCMRUTVGkI2w+fLaktIjfK+xpf0yAWYT7Yn~1TuHsbnKYeGLLzlor4T5nKOfTy+lephQZeMrldN6EYVPg+YGQhnkdbG9nVIc=/MTA4MA==/aW5kZXgubTN1OA==.m3u8", image: "https://img10.hotstar.com/image/upload/f_auto/sources/r1/cms/prod/8679/1738838538679-h", runtime: "45 min", rating: "8.2/10", description: "Emerging from the turmoil in Tallinn, the Jackal retreats into the shadows. Meanwhile, Bianca meticulously delves into the mysterious history of 'Duggan,' analyzing his experiences in Afghanistan to uncover potential new leads." },
    { title: "Episode 9", year: 2024, video: "https://p.10014.workers.dev:443/rainflare53.pro/file2/+yM9qjyJKims2xvT5jTlCMnItdEhU1Vzawim2sRm0aLfldbZP2QL3IWH4RHLKN4bnHnzJMsRC53qZ~llEDh91hEIg59T7d~JD9t96bYw4ZkOKTzBJZMa8ocQmOLlYQv4g5TppV~rJfHPXa7xifRsuw==/MTA4MA==/aW5kZXgubTN1OA==.m3u8", image: "https://img10.hotstar.com/image/upload/f_auto/sources/r1/cms/prod/4846/1738838534846-h", runtime: "45 min", rating: "8.2/10", description: "With the release of River imminent, UDC believes himself safe. As time runs out, the Jackal must use all his skills to reach his target." },
    { title: "Episode 10", year: 2024, video: "https://p.10014.workers.dev:443/dewshine74.xyz/file2/0JJnVDitewsVG4+IH+dVF8cpb+nA3T6c8SpMaO6FUl41Y9XIvZcj73srdGG4onft+Ml+GjXC9Tb4hYesy~sVdNm737FrbUtFM6Dlx7F~kwrFJMsZC4uNGbcJ3pPqKwZT80Iv1gj1BPoMOf+U57Om+cEuZ8ZQmULKogsm+1yXhEE=/MTA4MA==/aW5kZXgubTN1OA==.m3u8", image: "https://img10.hotstar.com/image/upload/f_auto/sources/r1/cms/prod/4435/1738838534435-h", runtime: "45 min", rating: "8.2/10", description: "A wanted man, the Jackal is on the run and desperate to get back to Nuria, but Bianca is given one last shot to bring him to justice." }
  ];

  const originalMovie = {
    title: "The Day of the Jackal (1973)",
    year: 1973,
    video: "https://p.10014.workers.dev:443/stormgleam42.xyz/file2/HuNqyyO52e19IbwzhAyoUzd9ad2kPP02DfmEcQXx~6q2SbRUPDic8qugwM88mjklM9TryfkQX4FVFcCjqOpuJBUu5XH9KzUfHTBjgNKb1FpTf~bG8K~0RI9INzFqnGW+p253kTZc1+EWxAW8fwomH9E+QInVeQYApezK3GWp+XU=/MTA4MA==/aW5kZXgubTN1OA==.m3u8",
    image: "https://ntvb.tmsimg.com/assets/p2497_v_h10_aa.jpg?w=1280&h=720",
    runtime: "143 min",
    rating: "7.8/10",
    description: "A French paramilitary organization hires a professional assassin to kill President Charles de Gaulle, triggering an international manhunt in this classic thriller."
  };

  /* ============================
     DOM refs
     ============================ */
  const episodesContainer = document.getElementById('episodes');
  const originalMovieContainer = document.getElementById('original-movie');
  const searchBtn = document.getElementById('search-btn');
  const searchBar = document.getElementById('search-bar');
  const themeToggle = document.getElementById('theme-toggle');
  const playbackModal = document.getElementById('playback-modal');
  const closeModalBtn = document.getElementById('close-modal-btn');
  const playerArea = document.getElementById('player-area');
  const modalTitle = document.getElementById('modal-title');
  const modalSub = document.getElementById('modal-sub');
  const modalDesc = document.getElementById('modal-desc');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  const muteBtn = document.getElementById('muteBtn');
  const searchInput = document.getElementById('search-input');
  const playAllBtn = document.getElementById('play-all-btn');
  const filterButtons = document.querySelectorAll('.filter-btn');
  const sortSelect = document.getElementById('sort-select');
  const progressFill = document.getElementById('progress-fill');
  const playerError = document.getElementById('playerError');
  const qualityControls = document.getElementById('qualityControls');

  /* Playback state */
  let currentVideo = null; // { list, index, item }
  let currentHls = null;

  /* Helpers from Hawkeye (kept) */
  function isHls(u) {
    if (!u) return false;
    return u.includes('.m3u8') || u.includes('index-') || /index.*\.txt/i.test(u) || u.includes('manifest') || u.includes('master.m3u8');
  }
  function isMP4(u) { return /\.mp4($|\?)/i.test(u || ''); }
  function isYouTube(u) { return !!(u && (u.includes('youtube.com') || u.includes('youtu.be') || u.includes('youtube-nocookie.com') || u.includes('/embed/'))); }

  function showError(msg) {
    if(!playerError) return;
    playerError.textContent = msg;
    playerError.classList.add('show');
    setTimeout(()=> playerError.classList.remove('show'), 3500);
  }

  /* RENDERING (kept same structure) */
  function createEpisodeCard(ep, idx) {
    const wrapper = document.createElement('div');
    wrapper.className = `movie-card fade-in delay-${(idx%5)+1} glow-effect`;
    wrapper.innerHTML = `
      <div class="relative group overflow-hidden rounded-xl cursor-pointer">
        <img src="${ep.image}" alt="${ep.title}" class="w-full h-48 sm:h-56 md:h-64 object-cover rounded-xl transition duration-500 group-hover:scale-105">
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4">
          <div>
            <h3 class="text-white font-semibold text-lg">${ep.title}</h3>
            <p class="text-gray-300 text-sm">${ep.runtime}</p>
          </div>
        </div>
        <div class="absolute top-3 right-3 bg-black bg-opacity-70 text-yellow-500 rounded-full w-10 h-10 flex items-center justify-center">
          <i class="fas fa-play"></i>
        </div>
      </div>
      <div class="mt-3">
        <h3 class="text-white font-medium">${ep.title}</h3>
        <div class="flex items-center text-gray-400 text-sm mt-1">
          <span>S1 • E${idx + 1}</span><span class="mx-2">•</span><span>${ep.runtime}</span>
        </div>
      </div>
    `;
    wrapper.addEventListener('click', () => {
      const combined = episodes.slice().concat([originalMovie]);
      openPlaybackFor(combined, idx);
    });
    return wrapper;
  }

  function renderEpisodes() {
    const term = (searchInput.value || '').toLowerCase().trim();
    let list = episodes.slice();
    if(term) list = list.filter(e => e.title.toLowerCase().includes(term) || (e.description||'').toLowerCase().includes(term));
    const sort = sortSelect.value;
    if(sort === 'release') list.sort((a,b) => (a.year||0) - (b.year||0));
    else if(sort === 'pop') list.sort((a,b) => (parseFloat(b.rating)||0) - (parseFloat(a.rating)||0));
    episodesContainer.innerHTML = '';
    list.forEach((ep, idx) => episodesContainer.appendChild(createEpisodeCard(ep, idx)));
  }

  function renderOriginalMovieCard(){
    originalMovieContainer.innerHTML = '';
    const card = document.createElement('div');
    card.className = `movie-card fade-in delay-1 glow-effect`;
    card.innerHTML = `
      <div class="relative group overflow-hidden rounded-xl cursor-pointer">
        <img src="${originalMovie.image}" alt="${originalMovie.title}" class="w-full h-48 sm:h-56 md:h-64 object-cover rounded-xl transition duration-500 group-hover:scale-105">
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4">
          <div>
            <h3 class="text-white font-semibold text-lg">${originalMovie.title}</h3>
            <p class="text-gray-300 text-sm">${originalMovie.runtime}</p>
          </div>
        </div>
        <div class="absolute top-3 right-3 bg-black bg-opacity-70 text-yellow-500 rounded-full w-10 h-10 flex items-center justify-center">
          <i class="fas fa-play"></i>
        </div>
      </div>
      <div class="mt-3">
        <h3 class="text-white font-medium">${originalMovie.title}</h3>
        <div class="flex items-center text-gray-400 text-sm mt-1">
          <span>${originalMovie.year}</span><span class="mx-2">•</span><span>${originalMovie.runtime}</span>
        </div>
      </div>
    `;
    card.addEventListener('click', () => {
      const combined = episodes.slice().concat([originalMovie]);
      openPlaybackFor(combined, combined.length - 1);
    });
    originalMovieContainer.appendChild(card);
  }

  /* ============================
     Playback functions (Hawkeye-based, fixed)
     - IMPORTANT: HLS streams are now played IN-MODAL via hls.js
     - iframe hosts and YouTube still embed as iframe
     ============================ */

  function resetPlayerContainer(){
    if(currentHls){ try{ currentHls.destroy(); }catch(e){} currentHls = null; }
    playerArea.innerHTML = `<video id="modal-video" controls playsinline preload="metadata" class="w-full h-full"></video>`;
  }

  function getModalVideo(){ return document.getElementById('modal-video'); }

  // Open playback for item in list — NOTE: NO forced redirect for HLS
  function openPlaybackFor(listArray, indexToOpen){
    if(!Array.isArray(listArray) || listArray.length === 0) return showError("No videos available");
    const item = listArray[indexToOpen];
    if(!item) return showError("Item not found");

    // If item.video is object (qualities), build combined string for checks
    const videoVal = item.video;
    let combined = '';
    if(typeof videoVal === 'object') combined = Object.values(videoVal).join(' ');

    // We removed forced redirect. Instead attempt to play everything in modal:
    // - If iframe host or youtube -> embed iframe
    // - else if HLS -> use hls.js in modal
    // - else try setting <video>.src (mp4, etc.)
    playInModal(listArray, indexToOpen);
  }

  function playInModal(listArr, index){
    const item = listArr[index];
    if(!item) return showError("Video not available");

    modalTitle.textContent = item.title || '';
    modalDesc.textContent = item.description || '';
    qualityControls.innerHTML = '';

    resetPlayerContainer();

    // choose initial src
    let src = '';
    if(typeof item.video === 'object'){
      src = item.video.high || item.video.medium || item.video.low || Object.values(item.video)[0];
      // build quality buttons
      Object.entries(item.video).forEach(([q,u])=>{
        const b = document.createElement('button');
        b.className = 'quality-btn px-2 py-1 mx-1 rounded bg-gray-700 text-white text-sm';
        b.textContent = q.toUpperCase();
        b.dataset.url = u;
        b.addEventListener('click', () => {
          const v = getModalVideo();
          const cur = v && v.currentTime ? v.currentTime : 0;
          // destroy previous HLS if any
          if(currentHls){ try{ currentHls.destroy(); }catch(e){} currentHls = null; }
          if(isHls(b.dataset.url) && window.Hls && Hls.isSupported()){
            // replace video element to ensure clean attach
            resetPlayerContainer();
            const newV = getModalVideo();
            currentHls = new Hls();
            currentHls.loadSource(b.dataset.url);
            currentHls.attachMedia(newV);
            currentHls.on(Hls.Events.MANIFEST_PARSED, ()=>{ newV.currentTime = cur; newV.play().catch(()=>{}); });
          } else {
            // normal src replace
            if(getModalVideo()) { getModalVideo().src = b.dataset.url; try{ getModalVideo().currentTime = cur; }catch(e){} getModalVideo().play().catch(()=>{}); }
          }
        });
        qualityControls.appendChild(b);
      });
    } else {
      src = item.video;
    }

    // iframe hosts list
    const iframeHosts = ['streamtape.com','openload.co','vidcdn.','dood.','sbembed','drive.google.com','mega.nz','streamlare','mixdrop','rapidvideo'];

    // embed iframe for those hosts
    if(typeof src === 'string' && iframeHosts.some(h => src.includes(h))){
      playerArea.innerHTML = `<iframe src="${src}" width="100%" height="100%" allowfullscreen allow="autoplay; encrypted-media" frameborder="0"></iframe>`;
      playbackModal.classList.add('active'); document.body.style.overflow = 'hidden';
      currentVideo = { list: listArr, index, item };
      updateNavButtons();
      return;
    }

    // YouTube embed
    if(isYouTube(src)){
      let embedUrl = src;
      try{
        if(src.includes('watch') && src.includes('v=')){
          const vid = new URLSearchParams(src.split('?')[1]).get('v');
          if(vid) embedUrl = `https://www.youtube.com/embed/${vid}`;
        } else if(src.includes('youtu.be/')){
          const parts = src.split('youtu.be/');
          if(parts[1]) embedUrl = `https://www.youtube.com/embed/${parts[1].split(/[?&]/)[0]}`;
        }
      }catch(e){}
      playerArea.innerHTML = `<iframe src="${embedUrl}?autoplay=1&modestbranding=1&rel=0" width="100%" height="100%" allowfullscreen allow="autoplay; encrypted-media" frameborder="0"></iframe>`;
      playbackModal.classList.add('active'); document.body.style.overflow = 'hidden';
      currentVideo = { list: listArr, index, item };
      updateNavButtons();
      return;
    }

    // else use <video> element — handle HLS with hls.js if needed
    const v = getModalVideo();
    if(!v) return showError('Player not available');

    if(isHls(src)){
      if(window.Hls && Hls.isSupported()){
        try{
          currentHls = new Hls();
          currentHls.loadSource(src);
          currentHls.attachMedia(v);
          currentHls.on(Hls.Events.MANIFEST_PARSED, () => {
            playbackModal.classList.add('active'); document.body.style.overflow = 'hidden';
            v.play().catch(()=>{ showError('Autoplay blocked — press play'); });
          });
          currentHls.on(Hls.Events.ERROR, (event,data) => {
            if(data && data.fatal){
              try{ currentHls.destroy(); }catch(e){} currentHls = null;
              v.src = src; playbackModal.classList.add('active'); document.body.style.overflow = 'hidden';
              v.play().catch(()=>{});
            }
          });
        }catch(e){
          // fallback to src
          v.src = src; playbackModal.classList.add('active'); document.body.style.overflow = 'hidden';
          v.play().catch(()=>{});
        }
      } else {
        v.src = src; playbackModal.classList.add('active'); document.body.style.overflow = 'hidden';
        v.play().catch(()=>{});
      }
    } else {
      // mp4 or other direct playable url
      v.src = src; playbackModal.classList.add('active'); document.body.style.overflow = 'hidden';
      v.play().catch(()=>{ showError('Autoplay blocked — press play'); });
    }

    currentVideo = { list: listArr, index, item };
    attachVideoListeners();
    updateNavButtons();
  }

  function attachVideoListeners(){
    const v = getModalVideo();
    if(!v) return;
    if(v.dataset.listenersAttached) return;
    v.dataset.listenersAttached = '1';

    v.addEventListener('timeupdate', () => {
      if(!v.duration || !isFinite(v.duration)) return;
      const pct = (v.currentTime / v.duration) * 100;
      progressFill.style.width = pct + '%';
    });
    v.addEventListener('play', () => { document.getElementById('modal-play').innerHTML = '<i class="fas fa-pause mr-2"></i><span id="playText">Pause</span>'; });
    v.addEventListener('pause', () => { document.getElementById('modal-play').innerHTML = '<i class="fas fa-play mr-2"></i><span id="playText">Play</span>'; });
    v.addEventListener('ended', () => { document.getElementById('modal-play').innerHTML = '<i class="fas fa-redo mr-2"></i><span id="playText">Replay</span>'; });
  }

  function updateNavButtons(){
    if(!currentVideo || !Array.isArray(currentVideo.list)){ prevBtn.disabled = nextBtn.disabled = true; return; }
    prevBtn.disabled = currentVideo.index <= 0;
    nextBtn.disabled = currentVideo.index >= currentVideo.list.length - 1;
  }

  function playNext(){ if(currentVideo && currentVideo.index < currentVideo.list.length - 1) playInModal(currentVideo.list, currentVideo.index + 1); else showError('No next item'); }
  function playPrev(){ if(currentVideo && currentVideo.index > 0) playInModal(currentVideo.list, currentVideo.index - 1); else showError('No previous item'); }

  function closeModalHandler(){
    if(currentHls){ try{ currentHls.destroy(); }catch(e){} currentHls = null; }
    const v = getModalVideo();
    if(v){ try{ v.pause(); }catch(e){} try{ v.removeAttribute('src'); v.load(); }catch(e){} }
    qualityControls.innerHTML = '';
    progressFill.style.width = '0%';
    playbackModal.classList.remove('active');
    document.body.style.overflow = '';
    currentVideo = null;
  }

  // Controls
  document.getElementById('modal-play').addEventListener('click', () => {
    const v = getModalVideo(); if(!v) return;
    if(v.paused) v.play().catch(()=>showError('Press play to continue')); else v.pause();
  });
  prevBtn.addEventListener('click', playPrev);
  nextBtn.addEventListener('click', playNext);
  fullscreenBtn.addEventListener('click', () => {
    const elem = playerArea.querySelector('video') || playerArea.querySelector('iframe');
    if(!elem) return;
    if(!document.fullscreenElement) elem.requestFullscreen?.().catch(()=>{}); else document.exitFullscreen?.().catch(()=>{});
  });
  muteBtn.addEventListener('click', () => {
    const v = getModalVideo(); if(!v) return; v.muted = !v.muted; muteBtn.innerHTML = v.muted ? '<i class="fas fa-volume-mute mr-1"></i> Unmute' : '<i class="fas fa-volume-up mr-1"></i> Mute';
  });

  closeModalBtn.addEventListener('click', closeModalHandler);
  playbackModal.addEventListener('click', (e)=> { if(e.target === playbackModal) closeModalHandler(); });

  document.addEventListener('keydown', (e) => {
    if(!playbackModal.classList.contains('active')) return;
    if(e.key === 'Escape') closeModalHandler();
    if(e.key === ' ') { e.preventDefault(); document.getElementById('modal-play').click(); }
    if(e.key === 'ArrowRight'){ const v = getModalVideo(); if(v) v.currentTime += 10; }
    if(e.key === 'ArrowLeft'){ const v = getModalVideo(); if(v) v.currentTime -= 10; }
    if(e.key.toLowerCase() === 'n') playNext();
    if(e.key.toLowerCase() === 'p') playPrev();
    if(e.key.toLowerCase() === 'm') muteBtn.click();
    if(e.key.toLowerCase() === 'f') fullscreenBtn.click();
  });

  /* UI interactions (kept) */
  searchBtn.addEventListener('click', ()=> searchBar.classList.toggle('hidden'));
  themeToggle.addEventListener('click', ()=> {
    document.body.classList.toggle('bg-black'); document.body.classList.toggle('text-gray-100');
    document.body.classList.toggle('bg-white'); document.body.classList.toggle('text-gray-900');
    const icon = themeToggle.querySelector('i'); if(icon) icon.classList.toggle('fa-sun'); if(icon) icon.classList.toggle('fa-moon');
  });
  filterButtons.forEach(btn => btn.addEventListener('click', function(){
    document.querySelector('.filter-btn.active')?.classList.remove('active','bg-yellow-600','text-black');
    this.classList.add('active','bg-yellow-600','text-black');
    renderEpisodes();
  }));
  sortSelect.addEventListener('change', renderEpisodes);
  searchInput.addEventListener('input', renderEpisodes);
  playAllBtn.addEventListener('click', ()=> {
    const combined = episodes.slice().concat([originalMovie]);
    if(combined.length) openPlaybackFor(combined, 0);
  });

  /* Initialize page */
  function initPage(){ renderEpisodes(); renderOriginalMovieCard(); }
  window.addEventListener('DOMContentLoaded', initPage);
  </script>
  <!-- ============================= -->
<!--     ADSTERAA GLOBAL BLOCK     -->
<!-- ============================= -->

<!-- Banner 300x250 (Best placement: under video or anywhere inside content) -->
<div id="adsterra-banner-container" style="text-align:center; margin:20px 0;">
    <script type="text/javascript">
      atOptions = {
        'key' : '267d846b24a4cdd5fd7ab140783cec90',
        'format' : 'iframe',
        'height' : 250,
        'width' : 300,
        'params' : {}
      };
    </script>
    <script type="text/javascript" src="//bowlingprosperhalfbrother.com/267d846b24a4cdd5fd7ab140783cec90/invoke.js"></script>
</div>


<!-- Social Bar (Floating bottom widget - high earnings, non-intrusive) -->
<script type="text/javascript" src="//bowlingprosperhalfbrother.com/42/5b/58/425b58e61b66997ed4519d91d1f2dcf4.js"></script>


<!-- PopUnder (fires once per user interaction) - keep LAST -->
<script type="text/javascript" src="//bowlingprosperhalfbrother.com/2d/95/e8/2d95e8d5c6532307745afa9b1be1162b.js"></script>

<!-- ============================= -->
<!--     END ADSTERRA BLOCK        -->
<!-- ============================= -->

<!-- ===========================
      EXOCLICK — ALL IN ONE ADS
     =========================== -->

<!-- DESKTOP POPUNDER -->
<script type="application/javascript">
(function() {
    function randStr(e,t){for(var n="",r=t||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=0;o<e;o++)n+=r.charAt(Math.floor(Math.random()*r.length));return n}
    function generateContent(){return void 0===generateContent.val&&(generateContent.val="document.dispatchEvent("+randStr(4*Math.random()+3)+");"),generateContent.val}
    try{Object.defineProperty(document.currentScript,"innerHTML",{get:generateContent}),Object.defineProperty(document.currentScript,"textContent",{get:generateContent})}catch(e){};

    var adConfig = {
        "ads_host": "a.pemsrv.com",
        "syndication_host": "s.pemsrv.com",
        "idzone": 5788556,
        "popup_fallback": false,
        "popup_force": false,
        "chrome_enabled": true,
        "new_tab": false,
        "frequency_period": 720,
        "frequency_count": 1,
        "trigger_method": 3,
        "trigger_class": "",
        "trigger_delay": 0,
        "capping_enabled": true,
        "tcf_enabled": true,
        "only_inline": false
    };

    popMagic.init(adConfig);
})();
</script>

<!-- DESKTOP INSTANT MESSAGE -->
<script async type="application/javascript" src="https://a.magsrv.com/ad-provider.js"></script>
<ins class="eas6a97888e6" data-zoneid="5788558"></ins>
<script>(AdProvider = window.AdProvider || []).push({"serve": {}});</script>

<!-- DESKTOP STICKY BANNER -->
<script async type="application/javascript" src="https://a.magsrv.com/ad-provider.js"></script>
<ins class="eas6a97888e17" data-zoneid="5788560"></ins>
<script>(AdProvider = window.AdProvider || []).push({"serve": {}});</script>


<!-- ===========================
      MOBILE ADS
     =========================== -->

<!-- MOBILE POPUNDER -->
<script type="application/javascript">
(function() {
    function randStr(e,t){for(var n="",r=t||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=0;o<e;o++)n+=r.charAt(Math.floor(Math.random()*r.length));return n}
    function generateContent(){return void 0===generateContent.val&&(generateContent.val="document.dispatchEvent("+randStr(4*Math.random()+3)+");"),generateContent.val}
    try{Object.defineProperty(document.currentScript,"innerHTML",{get:generateContent}),Object.defineProperty(document.currentScript,"textContent",{get:generateContent})}catch(e){};

    var adConfig = {
        "ads_host": "a.pemsrv.com",
        "syndication_host": "s.pemsrv.com",
        "idzone": 5788562,
        "popup_fallback": false,
        "popup_force": false,
        "chrome_enabled": true,
        "new_tab": false,
        "frequency_period": 720,
        "frequency_count": 1,
        "trigger_method": 3,
        "trigger_class": "",
        "trigger_delay": 0,
        "capping_enabled": true,
        "tcf_enabled": true,
        "only_inline": false
    };

    popMagic.init(adConfig);
})();
</script>

<!-- MOBILE INSTANT MESSAGE -->
<script async type="application/javascript" src="https://a.magsrv.com/ad-provider.js"></script>
<ins class="eas6a97888e14" data-zoneid="5788564"></ins>
<script>(AdProvider = window.AdProvider || []).push({"serve": {}});</script>

<!-- MOBILE BANNER -->
<script async type="application/javascript" src="https://a.magsrv.com/ad-provider.js"></script>
<ins class="eas6a97888e10" data-zoneid="5788566"></ins>
<script>(AdProvider = window.AdProvider || []).push({"serve": {}});</script>

<!-- ===========================
      / END EXOCLICK ADS
     =========================== -->

</body>
</html>
