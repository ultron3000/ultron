<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Animation Universe</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<!-- hls.js for HLS playback -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.1/dist/hls.min.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
  :root {
    --sony-blue: #0066cc;
    --sony-yellow: #ffcc00;
    --sony-red: #cc0000;
    --sony-green: #00cc66;
  }
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #111827 0%, #1e293b 100%);
    color: white;
    min-height: 100vh;
  }
  /* (kept your existing styles) */
  .movie-card { transition: all 0.3s ease; transform-style: preserve-3d; perspective: 1000px; cursor:pointer; }
  .movie-card:hover { transform: translateY(-10px) scale(1.03); box-shadow: 0 25px 50px -12px rgba(255,204,0,0.25); }
  .movie-poster { transition: all 0.5s ease; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3); }
  .movie-card:hover .movie-poster { transform: rotateY(10deg); }
  .search-glow { box-shadow: 0 0 15px rgba(255,204,0,0.5); }
  .sony-logo { text-shadow: 0 0 10px rgba(255,204,0,0.7); }
  .category-btn { transition: all 0.2s ease; }
  .category-btn:hover { transform: scale(1.1); }
  .category-btn.active { background-color: var(--sony-yellow); color: #111827; }
  .fade-in { animation: fadeIn 0.5s ease-in; }
  @keyframes fadeIn { from { opacity:0; transform: translateY(20px);} to { opacity:1; transform: translateY(0);} }
  ::-webkit-scrollbar { width:8px; height:8px; } ::-webkit-scrollbar-track { background:#1e293b; } ::-webkit-scrollbar-thumb { background:var(--sony-yellow); border-radius:4px; }

  /* --- Modal / Tukaram-style player styles (from Hawkeye) --- */
  /* flexible modal overlay */
  .modal-overlay { position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.9); z-index:1000; display:flex; justify-content:center; align-items:center; opacity:0; visibility:hidden; transition: all 0.3s ease; }
  .modal-overlay.active { opacity:1; visibility:visible; }
  .modal-container { width:90%; max-width:1000px; background:#1e293b; border-radius:12px; overflow:hidden; transform: scale(0.9); transition: transform 0.3s ease; }
  .modal-overlay.active .modal-container { transform: scale(1); }

  /* Tukaram modal player area */
  #modal-player { position: relative; padding-bottom:56.25%; height:0; background:black; }
  #modal-player video, #modal-player iframe { position:absolute; top:0; left:0; width:100%; height:100%; background:black; }

  /* progress bar */
  .progress-bar { height: 4px; background: rgba(255,255,255,0.12); position: relative; }
  .progress-bar-fill { position:absolute; top:0; left:0; height:100%; background: var(--sony-yellow); transition: width 0.3s ease; width:0%; }

  /* playback modal content */
  .watchlist-checkbox { position:relative; display:inline-block; width:20px; height:20px; }
  .watchlist-checkbox input { opacity:0; width:0; height:0; }
  .watchlist-checkbox .checkmark { position:absolute; top:0; left:0; height:20px; width:20px; background-color:transparent; border:2px solid #ffcc00; border-radius:4px; transition:all 0.3s; }
  .watchlist-checkbox input:checked ~ .checkmark { background-color:#ffcc00; }
  .watchlist-checkbox .checkmark:after { content:""; position:absolute; display:none; }
  .watchlist-checkbox input:checked ~ .checkmark:after { display:block; left:6px; top:2px; width:5px; height:10px; border:solid black; border-width:0 2px 2px 0; transform:rotate(45deg); }

  @media (max-width: 640px) {
    .movie-card { width: 100%; }
    .modal-container { width: 95%; max-width: 100%; }
    .movie-poster { height: 60vw; }
    h1 { font-size: 1.8rem; }
    .search-glow { box-shadow: none; }
    .container { padding-left: 1rem; padding-right: 1rem; }
  }

  @media (min-width: 641px) and (max-width: 1024px) {
    .modal-container { width: 90%; }
    .movie-poster { height: 35vw; }
  }

  @media (min-width: 1025px) {
    .modal-container { width: 80%; max-width: 1200px; }
  }

  .btn {
  background: rgba(255,255,255,0.1);
  padding: 10px 14px;
  border-radius: 9999px;
  transition: all 0.2s ease;
}
.btn:hover {
  background: var(--sony-yellow);
  color: black;
}

/* === SMART FULLSCREEN VIDEO FIX (NO CROPPING, NO GAPS WHEN POSSIBLE) === */
video:fullscreen,
video:-webkit-full-screen,
iframe:fullscreen,
iframe:-webkit-full-screen {
  width: 100vw !important;
  height: 100vh !important;
  max-width: 100vw !important;
  max-height: 100vh !important;

  object-fit: contain !important;
  background-color: black;
}

/* Only cover when video aspect is cinematic */
@media (min-aspect-ratio: 16/9) {
  video:fullscreen,
  video:-webkit-full-screen,
  iframe:fullscreen,
  iframe:-webkit-full-screen {
    object-fit: cover !important;
  }
}

</style>
</head>
<body class="pb-16">
  <!-- header (kept) -->
  <header class="relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-r from-blue-900 via-yellow-600 to-red-900 opacity-20"></div>
    <div class="container mx-auto px-4 py-4 sm:py-8 relative z-10 text-center">
      <div class="flex items-center justify-center mb-2 sm:mb-4">
        <i class="fas fa-film text-2xl sm:text-4xl text-yellow-400 mr-2 sm:mr-3"></i>
      </div>
      <p class="text-sm sm:text-lg text-gray-300 max-w-2xl mx-auto">Explore the vibrant world of Animation films</p>
    </div>
  </header>

  <!-- main -->
  <main class="container mx-auto px-4">
    <div class="mb-10">
      <div class="relative max-w-2xl mx-auto mb-6">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-search text-yellow-400 text-sm sm:text-base"></i></div>
        <input id="searchBar" class="w-full pl-10 pr-4 py-2 sm:py-3 rounded-full bg-gray-800 border border-gray-700 text-white search-glow text-sm sm:text-base" placeholder="Search  Animation movies..." type="text"/>
        <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
          <button id="clearSearch" class="text-gray-400 hover:text-yellow-400"><i class="fas fa-times"></i></button>
        </div>
      </div>

      <div class="flex flex-wrap justify-center gap-3 mb-8">

      </div>
    </div>

    <div class="flex justify-center items-center py-20" id="loading">
      <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-yellow-400"></div>
    </div>

    <div id="movies" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 sm:gap-6"></div>

    <div class="hidden text-center py-16" id="noResults">
      <i class="fas fa-film text-6xl text-gray-600 mb-4"></i>
      <h3 class="text-2xl font-semibold text-gray-300">No movies found</h3>
      <p class="text-gray-500 mt-2">Try adjusting your search or filter</p>
    </div>
  </main>

 <!-- Footer -->
<footer class="mt-20 py-6 bg-gray-900 bg-opacity-50">
<div class="container mx-auto px-4 text-center text-gray-400">
<div class="flex justify-center space-x-6 mb-4">
<a class="hover:text-yellow-400 transition-colors" href="#">
<i class="fab fa-facebook-f"></i>
</a>
<a class="hover:text-yellow-400 transition-colors" href="#">
<i class="fab fa-twitter"></i>
</a>
<a class="hover:text-yellow-400 transition-colors" href="https://www.instagram.com/stark_4152">
<i class="fab fa-instagram"></i>
</a>
<a class="hover:text-yellow-400 transition-colors" href="https://www.youtube.com/channel/UCYwTAs1PRVHbq4LnCHEEicw">
<i class="fab fa-youtube"></i>
</a>
</div>
<p class="text-sm mt-2">This is a fan-made project.</p>
</div>
</footer>

  <!-- =======================
       Playback Modal (Hawkeye/Tukaram-style)
       ======================= -->
  <div id="playback-modal" class="modal-overlay" aria-hidden="true">
    <div class="modal-container">
      <div class="relative">
        <button id="close-playback" class="absolute top-4 right-4 z-50 text-white hover:text-yellow-500 text-2xl bg-black/50 rounded-full p-2">
          <i class="fas fa-times"></i>
        </button>

        <!-- Flexible player container: video or iframe will be injected here -->
        <div id="modal-player">
          <video id="modal-video" class="w-full" controls playsinline>
            Your browser does not support the video tag.
          </video>
        </div>

        <!-- Custom Modal Controls -->
<div id="custom-controls" class="flex justify-center items-center gap-4 p-4 bg-black/80">
  <button id="prevBtn" class="btn text-white"><i class="fas fa-step-backward"></i></button>
  <button id="playPauseBtn" class="btn text-white"><i class="fas fa-play"></i></button>
  <button id="nextBtn" class="btn text-white"><i class="fas fa-step-forward"></i></button>
  <button id="muteBtn" class="btn text-white"><i class="fas fa-volume-up"></i></button>
  <button id="fullscreenBtn" class="btn text-white"><i class="fas fa-expand"></i></button>
  <button id="closeBtn" class="btn text-white"><i class="fas fa-times"></i></button>
</div>


        <div id="video-progress" class="progress-bar w-full">
          <div id="progress-bar-fill" class="progress-bar-fill" style="width:0%"></div>
        </div>

        <div class="p-6">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h3 id="modal-title" class="text-2xl font-bold mb-1"></h3>
              <div class="flex items-center text-gray-400 text-sm">
                <span id="modal-meta">•</span>
              </div>
            </div>
            <label class="watchlist-checkbox" title="Add to watchlist">
              <input type="checkbox" id="watchlist-checkbox">
              <span class="checkmark"></span>
            </label>
          </div>

          <p id="modal-description" class="text-gray-300 mb-6">Loading...</p>

          <div class="flex space-x-3">
            <button id="play-btn" class="bg-yellow-600 hover:bg-yellow-700 text-black font-semibold py-2 px-6 rounded-full transition flex items-center">
              <i class="fas fa-play mr-2"></i> Play
            </button>
            <button id="details-btn" class="bg-gray-800 hover:bg-gray-700 text-white font-semibold py-2 px-6 rounded-full transition flex items-center">
              <i class="fas fa-info-circle mr-2"></i> Details
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Loading spinner overlay used by playback logic -->
  <div id="loading-spinner" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 hidden">
    <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-yellow-500"></div>
  </div>

<script>
  /***** Data: (skipped movie list array as requested) *****/
  // You asked to skip the movies list array — keep this empty placeholder:
 const movies = [
      { title: "Spies in Disguise", video: "https://spuc.auronetworkpartners.shop/v4/np/owvev/index-f1-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/e7rWcrnuNej3JeVjqmRu0jVeRa4.jpg", category: "feature", year: 2019, franchise: "", award: false },

{ title: "Ferdinand", video: "https://skra.stellarforgeinnovation.online/v4/36/3sadp/index-f1-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/rMm94JsRfcOPiPVsTRcBiiVBOhz.jpg", category: "feature", year: 2017, franchise: "", award: false },

{ title: "Rio", video: "https://sr81.satoriwellbeinglab.shop:443/v4/9a/6jdca/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/4nJxhUknKV8Gqdhov8pU1YWDYfb.jpg", category: "feature", year: 2011, franchise: "", award: false },

{ title: "Rio 2", video: "https://sskt.claravonorganics.store:443/v4/ck/uvi1l/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/gVNTBrjxh2YRmQFjlaqrNbHVvrd.jpg", category: "feature", year: 2014, franchise: "", award: false },

{ title: "Epic", video: "https://s5zt.greenlineinnovations.store:443/v4/us/p3z83/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/81cSsWzjTfR3cJSqnTiHwy1eyPK.jpg", category: "feature", year: 2013, franchise: "", award: false },

{ title: "Robots", video: "https://smho.lucernaarchitecture.space:443/v4/9a/hvlko/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/fnKCh67l2DDG9NxxIlk9IpsXQ99.jpg", category: "feature", year: 2005, franchise: "", award: false },

{ title: "The Son of Bigfoot", video: "https://sbi6.aetherflowbranding.online/v4/db/h5bkp/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/5yCQvhFuFPY0pACxoUpLUlYCxop.jpg", category: "feature", year: 2017, franchise: "", award: false },

{ title: "Bigfoot Family", video: "https://sskt.velonaacademy.online/v4/sc/mo9cj/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/vn7sNO6CD8FBHBEVcOiNv08mjy1.jpg", category: "feature", year: 2020, franchise: "", award: false },

{ title: "Ron's Gone Wrong", video: "https://s8v3.silverlark.sbs/v4/ty/otne1/index-f1-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/plzgQAXIEHm4Y92ktxU6fedUc0x.jpg", category: "feature", year: 2021, franchise: "", award: false },

{ title: "Next Gen", video: "https://smeb.brightcrestinteractive.site:443/v4/js/9vmfm/index-f1-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/hUDDo5MPWM6rc6COQYhaoRNqvhE.jpg", category: "feature", year: 2018, franchise: "", award: false },

{ title: "Sahara", video: "https://s3ae.valentrixcreations.space/v4/hz/xr9q8/index-f1-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/9p8SQYNazWavpMzhN0OIuZm0HgI.jpg", category: "feature", year: 2017, franchise: "", award: false },

{ title: "Robinson Crusoe: The Wild Life", video: "https://s3ae.greenlineinnovations.store:443/v4/js/5lk3d/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/oW2CeCoFJKD57iyml0vWGRKKPaI.jpg", category: "feature", year: 2016, franchise: "", award: false },

{ title: "Tad, the Lost Explorer", video: "https://sipt.omniquestsolutions.shop:443/v4/61/nf9sn/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/vmysxjUJkYmp6CmjNOKOeHMOzFA.jpg", category: "feature", year: 2012, franchise: "", award: false },

{ title: "Mummies", video: "https://sipt.stellarpathlab.sbs/v4/m9/tfevt/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/r6Ghtw9ENhTXfeUsd1Al20ZAvX.jpg", category: "feature", year: 2023, franchise: "", award: false },

{ title: "The Wild", video: "https://sr81.luminarygroupdigital.online:443/v4/61/itcw9/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/sxqzaOto1qyUseSg6YpIP9Su5lp.jpg", category: "feature", year: 2006, franchise: "", award: false },

{ title: "Ice Age", video: "https://sy6.oravix.cyou:443/v4/hld/5teb9/index-f2-v1-a1.txt", image: "https://f.woowoowoowoo.net/resize/250x400/c6/59/c6591491f53c848d868589f3844bd965/c6591491f53c848d868589f3844bd965.jpg", category: "feature", year: 2002 },
      { title: "Ice Age: The Meltdown", video: "https://sad.fortimax.shop:443/v4/is3/jar9d/index-f2-v1-a1.txt", image: "https://f.woowoowoowoo.net/resize/250x400/2b/24/2b242f24f3ac4fe0cc3b3c293d077fcc/2b242f24f3ac4fe0cc3b3c293d077fcc.jpg", category: "feature", year: 2006 },
      { title: "Ice Age: Dawn of the Dinosaurs", video: "https://s5r.ridgegateinnovationhub.shop:443/v4/rqz/39zes/index-f2-v1-a1.txt", image: "https://f.woowoowoowoo.net/resize/250x400/4f/da/4fda35201fa5a6c247a5813fa66a7c27/4fda35201fa5a6c247a5813fa66a7c27.jpg", category: "feature", year: 2009 },
      { title: "Ice Age: Continental Drift", video: "https://vdkzfuwkpzz7q.meadowpathlearningcenter.space/m2q5ea5w42hk/hls3/01/02841/uwotpqqngdke_n/master.txt", image: "https://f.woowoowoowoo.net/resize/250x400/71/96/719613f39bd4da24aee94ce64e77013a/719613f39bd4da24aee94ce64e77013a.jpg", category: "sequel", year: 2012 },
      { title: "Ice Age: Collision Course", video: "https://s6mb.celestiorstudio.cyou:443/v4/tab/ayuks/index-f2-v1-a1.txt", image: "https://f.woowoowoowoo.net/resize/250x400/5b/6a/5b6a7ee08efe0d91bcd7a9d4b7f6c61b/5b6a7ee08efe0d91bcd7a9d4b7f6c61b.jpg", category: "short", year: 2016 },
      { title: "Ice Age: A Mammoth Christmas", video: "https://snq.ambercrestdigital.online:443/v4/luy/oa3r3/index-f2-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/ue5417HaDcvgMDusryenwwwZARq.jpg", category: "short", year: 2011 },
      { title: "The Ice Age Adventures of Buck Wild", video: "https://sy6.nordivisnetwork.store:443/v4/pk8/txzos/index-f1-v1-a1.txt", image: "https://image.tmdb.org/t/p/w500/zzXFM4FKDG7l1ufrAkwQYv2xvnh.jpg", category: "short", year: 2022 },
      


    ];

  // DOM references
  const container = document.getElementById('movies');
  const searchBar = document.getElementById('searchBar');
  const clearSearch = document.getElementById('clearSearch');
  const loadingEl = document.getElementById('loading');
  const noResults = document.getElementById('noResults');

  // Modal & playback elements (Hawkeye-style)
  const playbackModal = document.getElementById('playback-modal');
  const closePlaybackBtn = document.getElementById('close-playback');
  const modalPlayer = document.getElementById('modal-player');
  const progressBarFill = document.getElementById('progress-bar-fill');
  const loadingSpinner = document.getElementById('loading-spinner');
  const modalTitle = document.getElementById('modal-title');
  const modalDescription = document.getElementById('modal-description');
  const playBtn = document.getElementById('play-btn');
  const watchlistCheckbox = document.getElementById('watchlist-checkbox');
  const modalMeta = document.getElementById('modal-meta');

  // Playback state
  let currentHls = null;
  let currentIndex = null;
  const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const playPauseBtn = document.getElementById('playPauseBtn');
const muteBtn = document.getElementById('muteBtn');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const closeBtn = document.getElementById('closeBtn');


  // Helper: always return the current <video> element
  function getModalVideo() {
    return document.getElementById('modal-video');
  }

  // Type detection helpers (taken from Hawkeye logic). :contentReference[oaicite:4]{index=4}
  function isHls(u) {
    if (!u) return false;
    return u.includes('.m3u8') || u.includes('index-') || /index.*\.txt/i.test(u) || u.includes('manifest') || u.includes('master.m3u8');
  }
  function isMP4(u) {
    return /\.mp4($|\?)/i.test(u || '');
  }
  function isYouTube(u) {
    return !!(u && (u.includes('youtube.com') || u.includes('youtu.be') || u.includes('youtube-nocookie.com') || u.includes('/embed/')));
  }

  // Reset player container to a fresh <video> (destroy Hls if present). :contentReference[oaicite:5]{index=5}
  function resetPlayerContainer() {
    if (currentHls) {
      try { currentHls.destroy(); } catch(e) {}
      currentHls = null;
    }
    modalPlayer.innerHTML = `
      <video id="modal-video" class="w-full" controls playsinline>
        Your browser does not support the video tag.
      </video>
    `;
  }

  // Attach listeners to the video element for progress updates and ended state.
  function attachVideoListeners() {
    const videoEl = getModalVideo();
    if (!videoEl) return;
    // timeupdate for progress bar
    videoEl.addEventListener('timeupdate', () => {
      if (!videoEl.duration) return;
      const progress = (videoEl.currentTime / videoEl.duration) * 100;
      progressBarFill.style.width = progress + '%';
    });
    videoEl.addEventListener('ended', () => {
      playBtn.innerHTML = '<i class="fas fa-redo mr-2"></i> Replay';
    });
  }

  // Play / Pause
playPauseBtn.addEventListener('click', () => {
  const video = getModalVideo();
  if (!video) return;
  if (video.paused) {
    video.play();
    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
  } else {
    video.pause();
    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
  }
});

// Previous
prevBtn.addEventListener('click', () => {
  if (currentIndex === null || currentIndex === 0) return;
  const prevMovie = movies[currentIndex - 1];
  loadingSpinner.classList.remove('hidden');
  playInModal(prevMovie.title, prevMovie.video, prevMovie, currentIndex - 1);
});

// Next
nextBtn.addEventListener('click', () => {
  if (currentIndex === null || currentIndex >= movies.length - 1) return;
  const nextMovie = movies[currentIndex + 1];
  loadingSpinner.classList.remove('hidden');
  playInModal(nextMovie.title, nextMovie.video, nextMovie, currentIndex + 1);
});

// Mute / Unmute
muteBtn.addEventListener('click', () => {
  const video = getModalVideo();
  if (!video) return;
  video.muted = !video.muted;
  muteBtn.innerHTML = video.muted
    ? '<i class="fas fa-volume-mute"></i>'
    : '<i class="fas fa-volume-up"></i>';
});

// Fullscreen
fullscreenBtn.addEventListener('click', () => {
  const player = document.getElementById('modal-player');
  if (player.requestFullscreen) player.requestFullscreen();
});

// Close
closeBtn.addEventListener('click', closeModalHandler);


  // Close modal and cleanup (destroy HLS, pause & unload). :contentReference[oaicite:6]{index=6}
  function closeModalHandler() {
    const videoEl = getModalVideo();
    if (currentHls) { try { currentHls.destroy(); } catch(e){} currentHls = null; }
    if (videoEl) {
      try { videoEl.pause(); } catch(e){}
      try { videoEl.removeAttribute('src'); videoEl.load(); } catch(e){}
    }
    resetPlayerContainer();
    playbackModal.classList.remove('active');
    document.body.style.overflow = '';
    currentIndex = null;
    playBtn.innerHTML = '<i class="fas fa-play mr-2"></i> Play';
    progressBarFill.style.width = '0%';
  }

  // Core playInModal function (supports iframe hosts, YouTube, HLS, MP4; fallback to player.html redirect). :contentReference[oaicite:7]{index=7}
  function playInModal(title, url, movie = {}, index = null) {
    currentIndex = index;
    modalTitle.textContent = movie.title || title || 'Playback';
    modalDescription.textContent = movie.description || '';
    modalMeta.textContent = (movie.year ? movie.year + ' • ' : '') + (movie.duration ? movie.duration : '');
    watchlistCheckbox.checked = !!movie.inWatchlist;
    progressBarFill.style.width = '0%';
    resetPlayerContainer();

    if (!url) {
      modalTitle.textContent = (title || 'Unknown') + ' — No playable URL provided';
      playbackModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      return;
    }

    // Hosts that are best embedded as iframe (streamtape, dood, etc.)
    const iframeHosts = ['streamtape.com','openload.co','vidcdn','dood.', 'sbembed', 'drive.google.com'];
    if (iframeHosts.some(h => url.includes(h))) {
      modalPlayer.innerHTML = `<iframe src="${url}" width="100%" height="100%" allowfullscreen allow="autoplay; encrypted-media" frameborder="0"></iframe>`;
      playbackModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      loadingSpinner.classList.add('hidden');
      return;
    }

    // YouTube handling
    if (isYouTube(url)) {
      let embedUrl = url;
      try {
        if (url.includes('watch') && url.includes('v=')) {
          const vid = new URLSearchParams(url.split('?')[1]).get('v');
          if (vid) embedUrl = `https://www.youtube.com/embed/${vid}`;
        } else if (url.includes('youtu.be/')) {
          const parts = url.split('youtu.be/');
          if (parts[1]) {
            const vid = parts[1].split(/[?&]/)[0];
            embedUrl = `https://www.youtube.com/embed/${vid}`;
          }
        }
      } catch(e){}
      modalPlayer.innerHTML = `<iframe src="${embedUrl}?autoplay=1&modestbranding=1&rel=0" width="100%" height="100%" allowfullscreen allow="autoplay; encrypted-media" frameborder="0"></iframe>`;
      playbackModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      loadingSpinner.classList.add('hidden');
      return;
    }

    // Use the <video> element for HLS or MP4
    const videoEl = getModalVideo();

    // HLS
    if (isHls(url)) {
      if (Hls.isSupported()) {
        currentHls = new Hls();
        currentHls.loadSource(url);
        currentHls.attachMedia(videoEl);
        currentHls.on(Hls.Events.MANIFEST_PARSED, () => {
          playbackModal.classList.add('active');
          document.body.style.overflow = 'hidden';
          loadingSpinner.classList.add('hidden');
          videoEl.play().catch(()=>{});
        });
      } else {
        // native support (Safari)
        videoEl.src = url;
        playbackModal.classList.add('active');
        document.body.style.overflow = 'hidden';
        loadingSpinner.classList.add('hidden');
        videoEl.play().catch(()=>{});
      }
      attachVideoListeners();
      return;
    }

    // MP4
    if (isMP4(url)) {
      videoEl.src = url;
      playbackModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      loadingSpinner.classList.add('hidden');
      videoEl.play().catch(()=>{});
      attachVideoListeners();
      return;
    }

    // Unknown type — redirect to player.html (fallback)
    loadingSpinner.classList.add('hidden');
    window.location.href = `player.html?title=${encodeURIComponent(title)}&video=${encodeURIComponent(url)}`;
  }

  // Play/pause button
  playBtn.addEventListener('click', () => {
    const videoEl = getModalVideo();
    if (!videoEl) return;
    if (videoEl.paused) {
      videoEl.play();
      playBtn.innerHTML = '<i class="fas fa-pause mr-2"></i> Pause';
    } else {
      videoEl.pause();
      playBtn.innerHTML = '<i class="fas fa-play mr-2"></i> Play';
    }
  });

  // watchlist toggle (simple client-side example)
  watchlistCheckbox.addEventListener('change', function(){
    if (currentIndex == null) return;
    // implement your watchlist logic (e.g., update movies[currentIndex].inWatchlist)
  });

  // Close modal handlers
  closePlaybackBtn.addEventListener('click', closeModalHandler);
  playbackModal.addEventListener('click', (e) => {
    if (e.target === playbackModal) closeModalHandler();
  });

  // Utility: create cards when movies list is present (kept from Sony code)
  function displayMovies(list) {
    container.innerHTML = '';
    if (!list || list.length === 0) {
      noResults.classList.remove('hidden');
      return;
    }
    noResults.classList.add('hidden');
    list.forEach((movie, idx) => {
      const div = document.createElement('div');
      div.className = 'movie-card fade-in';
      div.innerHTML = `
        <div class="relative overflow-hidden rounded-xl h-full cursor-pointer">
          <img src="${movie.image || ''}" alt="${movie.title || 'Untitled'}" class="movie-poster w-full h-80 object-cover rounded-xl" loading="lazy">
          <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-2 sm:p-4 pt-6 sm:pt-10">
            <h3 class="text-sm sm:text-lg font-bold text-white">${movie.title || 'Untitled'}</h3>
            <div class="flex items-center text-xs sm:text-sm text-gray-300 mt-1">
              <span class="bg-gray-800 px-2 py-1 rounded mr-2">${movie.year || ''}</span>
              <span class="bg-gray-800 px-2 py-1 rounded">${movie.category || 'Feature'}</span>
            </div>
          </div>
          <div class="absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-300 bg-black bg-opacity-40">
            <i class="fas fa-play text-4xl text-yellow-400"></i>
          </div>
        </div>`;
      div.addEventListener('click', () => {
        loadingSpinner.classList.remove('hidden');
        playInModal(movie.title, movie.video, movie, idx);
      });
      container.appendChild(div);
    });
  }

  // Simple search and filter placeholders (keep behavior similar)
  searchBar.addEventListener('input', () => {
    // simple client filter; because movies array is empty now, this will show no results
    const q = searchBar.value.trim().toLowerCase();
    const filtered = movies.filter(m => (m.title||'').toLowerCase().includes(q));
    displayMovies(filtered);
  });
  clearSearch.addEventListener('click', () => { searchBar.value=''; displayMovies(movies); });

  // Initialize page (simulate load)
  window.addEventListener('DOMContentLoaded', () => {
    // Hide initial loader and render (with empty movies array you'll see "no results")
    setTimeout(() => {
      loadingEl.classList.add('hidden');
      displayMovies(movies);
    }, 400);
  });

  // Expose a small helper for debugging: open playback with a URL
  // Example usage from console:
  // playInModal('Test', 'https://path/to/your/playlist.m3u8', {title:'Test',description:'desc',year:'2024',duration:'1:20'});
  window.playInModal = playInModal;
</script>
 

</body>
</html>
