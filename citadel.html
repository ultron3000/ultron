<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Citadel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FontAwesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- HLS.js (Required for m3u8 streaming) -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    /* Custom UI */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #111; }
    ::-webkit-scrollbar-thumb { background: #ffcc00; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #ffdd33; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn .5s ease-out forwards; }

    .gradient-text {
      background: linear-gradient(90deg, #ffcc00, #ff9900);
      -webkit-background-clip: text;
      color: transparent;
    }

    #sparkCanvasPage {
      position: fixed; top:0;left:0;width:100%;height:100%;
      pointer-events:none; z-index:10000;
    }

    /* Spinner */
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #555;
      border-top: 4px solid #ffcc00;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: auto;
      margin-top: 80px;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>

<body class="bg-black text-gray-100 min-h-screen">

<!-- HEADER -->
<header class="sticky top-0 z-50 bg-black bg-opacity-90 backdrop-blur-sm border-b border-yellow-600/20">
  <div class="container mx-auto px-4 py-4 flex justify-between items-center">
    <div class="flex items-center space-x-2">
      <div class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center">
        <i class="fas fa-shield-alt text-black text-xl"></i>
      </div>
      <h1 class="text-2xl font-bold gradient-text">Citadel</h1>
    </div>

    <div class="flex items-center space-x-4">
      <!-- Season 1 Button -->
      <button id="season1-btn" class="p-2 rounded-full hover:bg-gray-800 transition">
        <span class="text-yellow-500">Season 1</span>
      </button>

      <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-800 transition">
        <i class="fas fa-moon text-yellow-500"></i>
      </button>

      <button id="search-btn" class="p-2 rounded-full hover:bg-gray-800 transition">
        <i class="fas fa-search text-yellow-500"></i>
      </button>
    </div>
  </div>

  <div id="search-bar" class="hidden px-4 pb-4">
    <div class="relative">
      <input type="text" placeholder="Search episodes..."
        class="w-full bg-gray-900 border border-yellow-600/30 rounded-full py-2 px-4 pl-10 text-white">
      <i class="fas fa-search absolute left-3 top-3 text-yellow-500"></i>
    </div>
  </div>
</header>

<!-- MAIN -->
<main class="container mx-auto px-4 py-8">

  <!-- Banner -->
  <section class="mb-12 relative overflow-hidden rounded-xl">
    <div class="absolute inset-0 bg-gradient-to-r from-black via-black/70 to-transparent z-10"></div>
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQxuPcHkU5d4MoL3SIGG26jAOgBV3eDlobjbQ&s" 
         class="w-full h-64 md:h-96 object-cover">

    <div class="absolute bottom-0 left-0 z-20 p-6 md:p-8">
      <h2 class="text-3xl md:text-5xl font-bold mb-2 gradient-text"></h2>
      <p class="text-gray-300 max-w-xl mb-4">
        Global spy agency Citadel has fallen, and its agents' memories were wiped clean. Now the powerful syndicate, Manticore, is rising in the void. Can the Citadel agents recollect their past and summon the strength to fight back?
      </p>
    </div>
  </section>

  <!-- Episodes -->
  <section>
    <h3 class="text-xl font-semibold mb-6 flex items-center">
      <i class="fas fa-list-ul text-yellow-500 mr-2"></i> Episodes
    </h3>

    <div id="movies" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"></div>
  </section>

</main>

<!-- FOOTER -->
<footer class="bg-gray-900 border-t border-gray-800 mt-12 py-8">
  <div class="container mx-auto px-4 text-center text-gray-400 text-sm">
    ©  Citadel Productions. All rights reserved.
  </div>
</footer>

<!-- VIDEO MODAL -->
<div id="video-modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-90 flex items-center justify-center">
  <div class="relative w-full max-w-4xl bg-gray-900 rounded-xl overflow-hidden">

    <!-- Close -->
    <button id="close-video-modal"
      class="absolute top-4 right-4 z-50 text-white hover:text-yellow-500 text-2xl">
      <i class="fas fa-times"></i>
    </button>

    <!-- Video Container -->
    <div class="modal-player w-full" style="aspect-ratio:16/9;">
      <div id="loading-spinner" class="spinner hidden"></div>
      <video id="modal-video" class="w-full h-full" controls playsinline></video>
    </div>

    <!-- Player Info -->
    <div class="p-6">
      <h3 id="modal-title" class="text-2xl font-bold mb-2"></h3>
      <p id="modal-description" class="text-gray-300 mb-4"></p>
      <button id="next-episode-btn"
        class="hidden bg-yellow-600 hover:bg-yellow-700 text-black font-semibold py-2 px-4 rounded-full">
        Next Episode →
      </button>
    </div>
  </div>
</div>

<!-- SPARK EFFECT -->
<canvas id="sparkCanvasPage"></canvas>

<!-- JAVASCRIPT -->
<script>
/* MOVIE DATA */
const movies = [
{ 
        title: "The Human Enigma", 
        video: "https://s3ae.evergreenconstruction.store/v4/il/hde6j/cf-master.txt?v=1730755972", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/7cf708aacfcd9cf0afc502de08cceedb147b9360bc339863382d908e6175c229._BR-6_AC_SX720_FMwebp_.jpg",
        description: "A former Citadel agent is pulled back into the world of espionage when a mysterious figure from his past resurfaces with critical information.",
        duration: "48 min"
      },
      { 
        title: "Spies Appear In Night Time", 
        video: "https://sunl.aurorapathcreative.space/v4/il/ty38g/index-f1-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/ec29785457e5f3d56591cf719a52f2214f56c1b5e73a8008eb1a19403b3a5fe7._BR-6_AC_SX720_FMwebp_.jpg",
        description: "Under the cover of darkness, agents from rival factions converge on a single location, each with their own hidden agenda.",
        duration: "52 min"
      },
      { 
        title: "Infinite Shadows", 
        video: "https://sbi6.marvellaholdings.sbs/v4/il/k89pz/cf-master.txt?v=1730756078", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/419b4b78422a757495927075fa7937109e1afcb5ecd822195b848616eb6eaa3b._BR-6_AC_SX720_FMwebp_.jpg",
        description: "As the web of deception grows more complex, our agents must navigate a maze of shifting alliances where nothing is as it seems.",
        duration: "49 min"
      },
      { 
        title: "Tell Her Everything", 
        video: "https://s5zt.viatrixartstudio.space/v4/ty/3fcqs/index-f2-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/0bc6a90b9ed854667c73f00b061c7c2f11c945f753ac9ba274487388c994f882._BR-6_AC_SX720_FMwebp_.jpg",
        description: "A critical decision must be made - reveal the truth and risk everything, or maintain the lie and lose what matters most.",
        duration: "51 min"
      },
      { 
        title: "Time Renders Us Enemies", 
        video: "https://s6sy.silverpathway.sbs/v4/ty/id661/cf-master.txt?v=1731438121", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/58bd4313c91e6769a7399a3c22ee3692dd008c38a972c8984654e2d22725af45._BR-6_AC_SX720_FMwebp_.jpg",
        description: "Past actions come back to haunt our agents as former allies become adversaries in a high-stakes confrontation.",
        duration: "47 min"
      },
      { 
        title: "Secrets In Night Need Early Rains", 
        video: "https://sxix.skylineforge.space/v4/ty/hde6b/index-f2-v1-a1.txt", 
        image: "https://m.media-amazon.com/images/S/pv-target-images/3c1ed5d5eb7012b8a83a09fee5523cb733fdc3bb4db8ff3ae0c1476c406b28df._BR-6_AC_SX720_FMwebp_.jpg",
        description: "The season finale brings all the threads together as hidden truths are revealed and loyalties are put to the ultimate test.",
        duration: "58 min"
      },
      
     
    ];

/* DOM References */
const container = document.getElementById('movies');
const videoModal = document.getElementById('video-modal');
const modalTitle = document.getElementById('modal-title');
let currentHls = null;

function showModal(){ videoModal.classList.remove('hidden'); document.body.style.overflow='hidden'; }
function hideModal(){ videoModal.classList.add('hidden'); document.body.style.overflow=''; }

function isHls(u){return u.includes('.m3u8')||u.includes('index-')||/index.*\.txt/i.test(u);}
function isMP4(u){return /\.mp4($|\?)/i.test(u);}
function isYouTube(u){return u.includes('youtu');}

function playInModal(title, url) {
  if (currentHls) {
    try { currentHls.destroy(); } catch (e) {}
    currentHls = null;
  }
  const playerContainer = document.querySelector('.modal-player');
  const modalVideo = document.getElementById('modal-video');
  modalTitle.textContent = title || '';

  // Streamtape
  if (url.includes('streamtape.com')) {
    playerContainer.innerHTML = `<iframe src="${url}" width="100%" height="100%" allowfullscreen allowtransparency allow="autoplay" scrolling="no" frameborder="0"></iframe>`;
    showModal();
    return;
  }

  // YouTube
  if (isYouTube(url)) {
    playerContainer.innerHTML = `
      <iframe src="${url}?autoplay=1&modestbranding=1&rel=0"
              width="100%" height="100%"
              allowfullscreen
              allow="autoplay; encrypted-media"
              frameborder="0"></iframe>`;
    showModal();
    return;
  }

  // HLS
  if (isHls(url)) {
    if (Hls.isSupported()) {
      currentHls = new Hls();
      currentHls.loadSource(url);
      currentHls.attachMedia(modalVideo);
      currentHls.on(Hls.Events.MANIFEST_PARSED, () => { showModal(); modalVideo.play().catch(() => {}); });
    } else {
      modalVideo.src = url;
      showModal();
      modalVideo.play().catch(() => {});
    }
    return;
  }

  // MP4
  if (isMP4(url)) {
    modalVideo.src = url;
    showModal();
    modalVideo.play().catch(() => {});
    return;
  }

  // Redirect to player.html for other formats
  window.location.href = `player.html?title=${encodeURIComponent(title)}&video=${encodeURIComponent(url)}`;
}

function closePlayer(){
  if(currentHls){try{currentHls.destroy();}catch(e){}currentHls=null;}
  const playerContainer=document.querySelector('.modal-player');
  playerContainer.innerHTML=`<video id="modal-video" class="w-full h-full" controls playsinline></video>`;
  hideModal();
}

document.getElementById('close-video-modal').addEventListener('click',closePlayer);
videoModal.addEventListener('click',e=>{if(e.target===videoModal)closePlayer();});

function renderMovies(list){
  container.innerHTML='';
  list.forEach((movie,i)=>{
    const div=document.createElement('div');
    div.className=`movie-card animate-fade-in rounded-xl overflow-hidden bg-gray-800 hover:bg-gray-700 cursor-pointer relative group`;
    div.innerHTML=`
      <div class="relative overflow-hidden rounded-t-lg">
        <img src="${movie.image}" alt="${movie.title}" class="w-full h-full object-cover movie-poster">
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4">
          <button class="bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold py-2 px-4 rounded-full transition transform hover:scale-105">
            <i class="fas fa-play mr-2"></i> Watch Now
          </button>
        </div>
      </div>
      <div class="p-4">
        <h3 class="font-semibold text-lg truncate">${movie.title}</h3>
        <div class="flex justify-between items-center mt-2 text-sm text-gray-400"><span>${movie.year||''}</span></div>
      </div>`;
    div.addEventListener('click',()=>playInModal(movie.title,movie.video));
    container.appendChild(div);
  });
}
renderMovies(movies);
</script>

<canvas id="sparkCanvasPage"></canvas>
<style>
#sparkCanvasPage{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10000;}
</style>
<script>
const canvas=document.getElementById('sparkCanvasPage');const ctx=canvas.getContext('2d');const sparks=[];
function resizeCanvas(){canvas.width=innerWidth;canvas.height=innerHeight;}window.addEventListener('resize',resizeCanvas);resizeCanvas();
const easing=t=>t*(2-t);const dur=300,count=6,size=8,radius=12,color='#00f2ff';
function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);const now=performance.now();
for(let i=sparks.length-1;i>=0;i--){const s=sparks[i];const el=now-s.t;if(el>=dur){sparks.splice(i,1);continue;}
const p=el/dur;const e=easing(p);const d=e*radius;const l=size*(1-e);const x1=s.x+d*Math.cos(s.a),y1=s.y+d*Math.sin(s.a);
const x2=s.x+(d+l)*Math.cos(s.a),y2=s.y+(d+l)*Math.sin(s.a);ctx.strokeStyle=color;ctx.lineWidth=1.5;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();}
requestAnimationFrame(draw);}requestAnimationFrame(draw);
document.addEventListener('click',e=>{for(let i=0;i<count;i++){sparks.push({x:e.clientX,y:e.clientY,a:(2*Math.PI*i)/count,t:performance.now()});}});
</script>
</body>
</html>
